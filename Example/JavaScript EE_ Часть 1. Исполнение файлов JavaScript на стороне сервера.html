<!DOCTYPE html>
<!-- saved from url=(0059)https://www.ibm.com/developerworks/ru/library/wa-aj-javaee/ -->
<html lang="ru-RU" style="" class="applicationcache geolocation history postmessage svg websockets localstorage sessionstorage websqldatabase webworkers hashchange pointerevents canvas audio canvastext video webgl cssgradients multiplebgs opacity rgba inlinesvg hsla supports svgclippaths smil no-touchevents fontface no-generatedcontent textshadow cssanimations backgroundsize borderimage borderradius boxshadow csscolumns csscolumns-width csscolumns-span csscolumns-fill csscolumns-gap csscolumns-rule csscolumns-rulecolor csscolumns-rulestyle csscolumns-rulewidth csscolumns-breakbefore csscolumns-breakafter csscolumns-breakinside flexbox flexboxlegacy cssreflections csstransforms csstransforms3d csstransitions indexeddb indexeddb-deletedatabase js ibm-v18 ibm-cxtype-4g hires win chrome chrome6 webkit webkit5 ibm-grid-xlarge cee-imt"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
<meta name="viewport" content="width=device-width, initial-scale=1">      
<link rel="icon" href="https://www.ibm.com/favicon.ico">
<link rel="canonical" href="http://www.ibm.com/developerworks/ru/library/wa-aj-javaee/index.html">
<meta name="geo.country" content="RU">
<meta name="dcterms.rights" content="© Copyright IBM Corporation 2010">
<meta name="dcterms.date" content="2010-06-28">
<meta name="description" content="В этих статьях показано, как исполнять файлы JavaScript со стороны сервера, вызывать функции JavaScript с помощью Ajax и использовать API Java Scripting с технологией JavaServer Pages (JSP).">	
<meta name="keywords" content="Java, EE, JavaScript, ECMAScript, javax, script, ScriptEngine, Invocable, Compilable, CompiledScript, ScriptContext, servlet, tttwaca, tttjca">
<meta name="robots" content="index,follow">
<title>JavaScript EE: Часть 1. Исполнение файлов JavaScript на стороне сервера</title>
    
<script type="text/javascript" async="" charset="utf-8" id="utag_19" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/hotjar-42920.js"></script><script type="text/javascript" async="" charset="utf-8" id="demandbase_js_lib" src="https://scripts.demandbase.com/ab057a07.min.js"></script><script type="text/javascript" async="" charset="utf-8" id="utag_53" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/js"></script><script type="text/javascript" async="" charset="utf-8" id="tealium_cormetrics2" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/eluminate.js"></script><script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/analytics-marketing.js" type="text/javascript" async=""></script><script type="text/javascript" async="" charset="utf-8" id="dle_api_0b6ee75830f94385a5863a6e0fdb96715ddadba8f9758be16a769ae29a1e70d3" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/p_0b6ee75830f94385a5863a6e0fdb96715ddadba8f9758be16a769ae29a1e70d3.js"></script><script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/p_devwrks.js" type="application/javascript" async=""></script><script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/p_devwrks.js" type="application/javascript" async=""></script><script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/bluemix-analytics.min.js" type="application/javascript" async=""></script><script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/callback=_dl.fn.lotameApi.callback" type="application/javascript" async=""></script><script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/utag.js" type="application/javascript" async=""></script><script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/notice-prefs" type="application/javascript" async=""></script><script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/saved_resource" type="application/javascript" async=""></script><script> 
    digitalData = {
        "page":{
            "category":{
                "primaryCategory":"SOFDCDEVRU"
            },
            "pageInfo":{
                "effectiveDate":"2010-06-28",
                "language":"ru-RU",
                "publishDate":"2010-06-28",
                "publisher":"IBM Corporation",
                "version":"v18",
                "ibm":{ 
                    "contentDelivery":"IBM developerWorks template",
                    "contentProducer":"IBM developerWorks",
                    "country":"RU",
                    "owner":"RuAdmin DeveloperWorks/Russia/IBM",
                    "siteID":"DEVWRKS",
                    "subject":"TTA00",
                    "type":"CT316",
                    "topic":"Разработка приложений,Технология Java",
                    "topicId":"263,9",
                    "contentArea":"web,java",
                    "contentAreaId":"5,1",
                    "contentType":"article",
                    "contentId":"498259",
                },
                "keywords":"Java, EE, JavaScript, ECMAScript, javax, script, ScriptEngine, Invocable, Compilable, CompiledScript, ScriptContext, servlet, tttwaca, tttjca",
                "description":"В этих статьях показано, как исполнять файлы JavaScript со стороны сервера, вызывать функции JavaScript с помощью Ajax и использовать API Java Scripting с технологией JavaServer Pages (JSP)."
            }
        }
    };
    window._analytics = {
        "coremetrics": false,
        "optimizely": false,
        "googleAddServices": false,
        "addRoll": false,
        "intercom": false,
        "fullStory": false,
        "hotjar": false,
        "tealeaf": false,
        "nps": false,
        "segment_key": 'HU3dbkAG5wE0F1IkRf9S1RexlAqo3jby'
    };
</script>
	
    <meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@developerworks">
<meta property="og:title" content="Часть 1. Исполнение файлов JavaScript на стороне сервера">
<meta property="og:description" content="В этих статьях показано, как исполнять файлы JavaScript со стороны сервера, вызывать функции JavaScript с помощью Ajax и использовать API Java Scripting с технологией JavaServer Pages (JSP).">
    <meta property="og:image" content="http://www.ibm.com/developerworks/i/dw-social-201508.png">
<!-- Segment meta tag -->
<meta name="segment" property="developerWorks (developerWorks)" producttitle="developerWorks" value="Web Development Russian (developerWorks)">      
<!-- SITE MON : START (DO NOT DELETE) -->
<!-- developerWorks monitoring token -->
<!-- SITE MON : END (DO NOT DELETE) -->

<!-- HEADER_SCRIPTS_AND_CSS_INCLUDE -->
<!-- <script src="//cdn.optimizely.com/js/5399420604.js"></script> -->
<!-- BEGIN: Use this section to set page specific variables for the Page Tag -->
<script language="JavaScript">var NTPT_PGEXTRA="ibmSkillLevel=3&ibmCmaId=498259&ibmContentAreas=web,java";</script>
<!--END -->
<script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/ida_stats.js"></script>
<link href="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/www.css" rel="stylesheet">
<link href="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/syntaxhighlighter.css" rel="stylesheet">
<script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/www.js"></script><style></style>
<script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/syntaxhighlighter.js"></script>    
<link href="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/tables.css" rel="stylesheet">
<script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/tables.js"></script>   
<!--  Masthead/footer  -->
<link href="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/dw-mf-v18.css" rel="stylesheet">
<!-- <link href="//dw1.s81c.com/developerworks/css/dw-mf/v18/alt-signedin-ux.css" rel="stylesheet" /> -->   
<!--[if lt IE 9]>
    <link href="//dw1.s81c.com/developerworks/css/dw-mf/v18/dw-mf-ie8fix.css?v=022216" rel="stylesheet" />
<![endif]-->
<link href="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/dw-article.css" rel="stylesheet">
<script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/dw-auth-properties.js"></script>
<script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/dw-auth.js"></script>
<script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/dw-mf.js"></script>
<script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/dw-include.js"></script>     
<script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/dw-article.js"></script>
<script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/dw-auto-links.js"></script>     
<script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/tactic.js"></script>
<script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/tacticbindlinks.js"></script>

<!-- 
<PageMap>
    <DataObject type="document">
        <Attribute name="topic">Разработка приложений,Технология Java</Attribute>
        <Attribute name="topicId">263,9</Attribute>
        <Attribute name="contentArea">web,java</Attribute>
        <Attribute name="contentAreaId">5,1</Attribute>
        <Attribute name="abstract">В этих статьях показано, как исполнять файлы JavaScript со стороны сервера, вызывать функции JavaScript с помощью Ajax и использовать API Java Scripting с технологией JavaServer Pages (JSP).</Attribute>
        <Attribute name="pub.date">2010-06-28</Attribute>
        <Attribute name="contentType">article</Attribute>
    </DataObject>
</PageMap>
-->        

<style id="ibm-masthead-hidelinks">@media screen and (max-width: 626px) { .ibm-masthead-categories,#ibm-megamenu-sections{display:none} }@media screen and (max-width: 626px) { .ibm-mh-marketplace-link{display:none} }</style><style id="ibm-sitenav-menu-hidelinks">@media screen and (max-width: 848.3624877929688px) {.ibm-sitenav-menu-container .ibm-sitenav-menu-list > ul > li {display:none}.ibm-sitenav-menu-list > ul > .ibm-sitenav-menu-item-right {display:block}}@media screen and (min-width: 849.3624877929688px) {.ibm-mobilemenu-sitenavmenu > ul > li {display:none}}@media screen and (max-width: 286px) {.ibm-sitenav-menu-list > ul > .ibm-sitenav-menu-item-right {display:none}}@media screen and (min-width: 287px) {.ibm-mobilemenu-sitenavmenu > ul > .ibm-sitenav-menu-item-right {display:none}}</style><style type="text/css" class="jquery-comments-css">.jquery-comments ul.navigation li.active:after {background: #2793e6 !important;</style><style type="text/css" class="jquery-comments-css">.jquery-comments ul.navigation ul.dropdown li.active {background: #2793e6 !important;</style><style type="text/css" class="jquery-comments-css">.jquery-comments .highlight-background {background: #2793e6 !important;</style><style type="text/css" class="jquery-comments-css">.jquery-comments .highlight-font {color: #2793e6 !important;}</style><style type="text/css" class="jquery-comments-css">.jquery-comments .highlight-font-bold {color: #2793e6 !important;font-weight: bold;}</style><script type="text/javascript" async="" charset="utf-8" id="utag_ibm.web_53" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/utag.53.js"></script><script type="text/javascript" async="" charset="utf-8" id="utag_ibm.web_94" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/utag.94.js"></script><script type="text/javascript" async="" charset="utf-8" id="tiqapp" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/utag.v.js"></script><script type="text/javascript" async="" charset="utf-8" id="utag_ibm.web_28" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/utag.28.js"></script><script type="text/javascript" async="" charset="utf-8" id="utag_ibm.web_19" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/utag.19.js"></script><script type="text/javascript" async="" charset="utf-8" id="LOTCC_10026" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/cc.js"></script><script type="text/javascript" async="" charset="utf-8" id="utag_ibm.web_45" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/utag.45.js"></script><style type="text/css">@media only screen and (max-width:480px){.truste_box_overlay{width: 100%!important;margin: 0px!important;max-width: 100%!important;box-shadow: rgb(0,0,0,0.2) 0px 0px 16px 2px!important;}}@media only screen and (min-width:481px){.truste_box_overlay{width: 80%!important;margin: 20px auto!important;max-width: 800px!important;box-shadow: rgb(0,0,0,0.2) 0px 0px 16px 2px!important;}}</style><style type="text/css">@font-face {font-family: "ibm-plex-sans"; src: url("https://1.www.s81c.com/common/fonts/plex/v1/ibmplexsans-regular.woff2") format("woff2");font-family: "ibm-plex-sans"; src: url("https://1.www.s81c.com/common/fonts/plex/v1/ibmplexsans-regular.woff") format("woff");}</style><script language="javascript" type="text/javascript" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/50200000.js"></script><script language="javascript" type="text/javascript" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/cookie-id.js"></script><script language="javascript" type="text/javascript" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/rules_50200000.js"></script><script language="javascript" type="text/javascript" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/dispatcher-v3.js"></script><script type="text/javascript" async="" charset="utf-8" id="tealium_visitor_service_45main" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/01635dedd01a0012ee952eabc1ad06094003b08c00978"></script><script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/yahoo-min.js" type="text/javascript"></script><script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/cp-v3.js" type="text/javascript"></script><script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/json-min.js" type="text/javascript"></script><script async="" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/modules-bc9233e6eda7ce1b46e135a312414ff7.js"></script><style type="text/css">iframe#_hjRemoteVarsFrame {display: none !important; width: 1px !important; height: 1px !important; opacity: 0 !important; pointer-events: none !important;}</style><script type="text/javascript" async="" charset="utf-8" id="tealium_visitor_service_45main" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/01635dedd01a0012ee952eabc1ad06094003b08c00978(1)"></script></head>
<body id="ibm-com" class="ibm-type ibm-sitenav-menu ibm-sitenav-menu-sticky ibm-masthead-sticky ibm-masthead-sticky-showing">
	
<div id="ibm-top" class="ibm-landing-page">

<!-- MASTHEAD_BEGIN -->
<div id="ibm-masthead" role="banner" aria-label="IBM" class="ibm-mhtype-minimal hastransition">
    <div id="ibm-universal-nav" class="">    
  
        <nav role="navigation" aria-label="IBM">
            <div id="ibm-home"><a href="https://www.ibm.com/ru/ru/?lnk=m">IBM®</a></div>
            <ul id="ibm-menu-links" role="toolbar" aria-label="Site map" class="ibm-hide">
                <li><a href="https://www.ibm.com/sitemap/ru/ru/">Карта сайта</a></li>
            </ul><div class="ibm-masthead-rightside"><p class="ibm-mh-marketplace-link ibm-button-link ibm-fleft ibm-padding-bottom-0"><a class="ibm-btn-small ibm-btn-sec ibm-btn-blue-50" href="https://www.ibm.com/marketplace/?lnk=mp">Интернет-магазин</a></p><div id="ibm-search-module" role="search" aria-labelledby="ibm-masthead" class="ibm-has-scope">
            <div class="ibm-masthead-search-close"><p class="ibm-ind-link ibm-icononly ibm-padding-bottom-0"><a href="https://www.ibm.com/developerworks/ru/library/wa-aj-javaee/#" class="ibm-close-link ibm-nospacing">Закрыть окно</a></p></div><form id="ibm-search-form" action="https://www.ibm.com/Search/" method="get" aria-labelledby="ibm-masthead">
                <p>
                    <label for="q">IBM</label>
                    <input type="text" maxlength="100" value="" placeholder="Поиск" name="q" id="q" aria-label="Поиск developerWorks" autocomplete="off" role="combobox" aria-autocomplete="list" aria-expanded="false" aria-owns="ibm-search-typeahead-container"><input name="lnk" type="hidden" value="mhsrch">
                    <input type="hidden" value="18" name="v">
                    <input type="hidden" value="utf" name="en">
                    <input type="hidden" value="ru" name="lang">
                    <input type="hidden" value="ru" name="cc">
                    <input type="hidden" name="sn" value="dw">
                    <input type="hidden" name="dws" value="rudw">
                    <input type="hidden" name="hpp" value="20">
                    <span class="ibm-search-scope ibm-fadeout" aria-expanded="true"><input class="ibm-styled-checkbox" data-init="false" type="checkbox" name="sn" value="" id="ibm-mh-scopeoption"> <label for="ibm-mh-scopeoption">In Marketplace</label></span><button role="button" type="submit" id="ibm-search" class="ibm-search-link" value="Отправить"><span class="ibm-access">Отправить</span></button>
                </p>
            </form><form class="ibm-hide" id="ibm-default-scope-form" action="https://www.ibm.com/marketplace/search/ru/ru-ru" method="get"><input name="terms" type="text"><input name="lnk" type="hidden" value="mhmpsrch"></form>
        </div><div id="ibm-search-typeahead-container" aria-expanded="true" class="ibm-search-typeahead-container ibm-fadeout"></div><ul aria-label="Tools" role="menubar" class="ibm-masthead-iconsonly"><li role="presentation" class="ibm-masthead-item-signin"><button role="button" aria-haspopup="true" aria-owns="ibm-signin-minimenu-container" class="ibm-profile-link">Мой IBM</button><ul id="ibm-signin-minimenu-container" role="menu" aria-label="Profile" class="ibm-dropdown-menu">    <li class="ibm-dropdown-menu-primary" role="presentation" data-linktype="notifications">       <a class="" href="https://myibm.ibm.com/dashboard/?lnk=mmi" tabindex="0">Мой IBM</a>     </li>    <li class="ibm-dropdown-menu-primary menu-heading" role="presentation">       <span tabindex="0">developerWorks</span>     </li>   <li class="ibm-dropdown-menu-primary ibm-signin-alt" role="presentation">     <a href="https://www.ibm.com/developerworks/dwwi/jsp/ssologin.jsp?d=https%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fru%2Flibrary%2Fwa-aj-javaee%2F&amp;lang=ru&amp;a=dwmav" role="menuitem">Войти</a>   </li>   <li class="ibm-dropdown-menu-primary dw-register-alt" role="presentation">     <a href="https://www.ibm.com/developerworks/dwwi/jsp/ssoregister.jsp?d=https%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fru%2Flibrary%2Fwa-aj-javaee%2F&amp;lang=ru&amp;a=dwmav" role="menuitem">Зарегистрироваться</a>   </li></ul></li><li role="presentation" class="ibm-masthead-item-menu"><button role="button" aria-haspopup="true" aria-owns="ibm-burger-menu-container" class="ibm-menu-link">Навигация по сайту</button></li></ul></div> 
        </nav>
  
        
       
    </div>
</div><div class="ibm-mobilemenu ibm-hide" id="ibm-burger-menu-container" aria-labelledby="ibm-burgermenu-a11y" role="dialog" tabindex="0"><p class="ibm-hide" id="ibm-burgermenu-a11y">Навигация по сайту</p><div class="ibm-mobilemenu-close"><p class="ibm-icononly ibm-fright ibm-ind-link ibm-nospacing"><a class="ibm-close-link" href="https://www.ibm.com/developerworks/ru/library/wa-aj-javaee/?lnk=hm#">Закрыть окно</a></p></div><div class="ibm-mobilemenu-section ibm-mobilemenu-sitenavmenu"><ul role="menubar"><li class="ibm-mobile-section-heading ibm-mobile-sitename">
        <a href="https://www.ibm.com/developerworks/ru/?lnk=hm">
            <img width="186" height="24" alt="developerWorks®" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/dw-mf-wordmark.svg">
        </a>
    </li>
                            <li class="dw-navpage-learn" role="presentation">
                    <a href="https://www.ibm.com/developerworks/ru/topics/?lnk=hm" role="menuitem" tabindex="0">Изучайте</a>
                </li>
                    
                <li class="dw-navpage-develop" role="presentation">
                    <a href="https://www.ibm.com/developerworks/ru/downloads/?lnk=hm" role="menuitem" tabindex="-1">Разрабатывайте</a>
                </li>                    

                <li class="dw-navpage-connect" role="presentation">
                    <a href="https://www.ibm.com/developerworks/ru/community/?lnk=hm" role="menuitem" tabindex="-1">Подключайтесь</a>
                </li>  
        </ul></div><div class="ibm-mobilemenu-section"><ul class="ibm-mobilemenu-mhlinks" aria-label="Ознакомьтесь срешениями IBM"><li><a href="https://www.ibm.com/marketplace/?lnk=hmmp">Интернет-магазин</a></li><li><div data-widget="showhide" data-type="panel" class="ibm-show-hide ibm-widget-processed"><h2><a href="javascript:void();">Продукты</a></h2><div class="ibm-container-body" style="display: none;"><ul><li><a href="https://www.ibm.com/products/ru/ru/?lnk=hm"><span>Продукты</span></a></li><li><a href="https://www.ibm.com/analytics/ru/ru/?lnk=hm"><span>Аналитика</span></a></li><li><a href="https://www.ibm.com/cloud-computing/ru-ru/?lnk=hm"><span>Облако</span></a></li><li><a href="https://www.ibm.com/cognitive/ru-ru/?lnk=hm"><span>Когнитивные технологии</span></a></li><li><a href="https://www.ibm.com/commerce/ru-ru/?lnk=hm"><span>Коммерция</span></a></li><li><a href="https://www.ibm.com/internet-of-things/?lnk=hm"><span>Интернет вещей (US)</span></a></li><li><a href="https://www.ibm.com/solutions/ru/ru/?lnk=hm"><span>Отраслевые решения</span></a></li><li><a href="https://www.ibm.com/it-infrastructure/ru-ru/?lnk=hm"><span>ИТ-инфраструктура</span></a></li><li><a href="https://www.ibm.com/mobilefirst/ru/ru/?lnk=hm"><span>Мобильные приложения</span></a></li><li><a href="https://www.ibm.com/security/ru/ru/index.html?lnk=hm"><span>Безопасность</span></a></li><li><a href="https://www.ibm.com/ru/watson/?lnk=hm"><span>Watson</span></a></li></ul></div></div></li><li><div data-widget="showhide" data-type="panel" class="ibm-show-hide ibm-widget-processed"><h2><a href="javascript:void();">Услуги</a></h2><div class="ibm-container-body" style="display: none;"><ul><li><a href="https://www.ibm.com/services/ru/ru/it-services/gts-it-service-home-page-1.html?lnk=hm"><span>Бизнес-консалтинг</span></a></li><li><a href="https://www.ibm.com/services/ru/ru/it-services/gts-it-service-home-page-1.html?lnk=hm"><span>Технологические услуги</span></a></li><li><a href="https://www.ibm.com/financing/us-en/?lnk=hm"><span>Финансирование (US)</span></a></li><li><a href="https://www.ibm.com/solutions/ru/ru/?lnk=hm"><span>Отраслевой опыт</span></a></li><li><a href="https://www.ibm.com/training/?lnk=hm"><span>Обучение и навыки (US)</span></a></li></ul></div></div></li><li><div data-widget="showhide" data-type="panel" class="ibm-show-hide ibm-widget-processed"><h2><a href="javascript:void();">Разработчики</a></h2><div class="ibm-container-body" style="display: none;"><ul><li><a href="https://www.ibm.com/developerworks/ru/?lnk=hm"><span>developerWorks</span></a></li><li><a href="https://www.ibm.com/ru/startups/index.html?lnk=hm"><span>для стартапов</span></a></li><li><a href="https://www.ibm.com/ru/partners/?lnk=hm"><span>PartnerWorld</span></a></li></ul></div></div></li><li><a href="https://www.ibm.com/support/ru/ru/?lnk=hm">Поддержка</a></li><li><a href="http://www.ibm.com/employment/ru-ru/?lnk=hm">Возможности карьеры</a></li></ul></div></div><div class="ibm-mhplaceholder"></div><!-- MASTHEAD_END -->
	    
<!-- LAYOUT -->
<div id="ibm-content-wrapper">
    <!-- LEADSPACE_BEGIN -->
    <header role="banner" aria-labelledby="ibm-pagetitle-h1">
        
        <!-- MASTHEAD_SITENAV_BEGIN -->
        <div class="ibm-sitenav-menu-container" data-widgetprocessed="true">
    <div class="ibm-sitenav-menu-name">
        <a href="https://www.ibm.com/developerworks/ru/">
            <img width="186" height="24" alt="developerWorks®" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/dw-mf-wordmark.svg">
        </a>
    </div>
    <div class="ibm-sitenav-menu-list">
        <ul role="menubar">
                            <li class="dw-navpage-learn" role="presentation">
                    <a href="https://www.ibm.com/developerworks/ru/topics/" role="menuitem" tabindex="0">Изучайте</a>
                </li>
                    
                <li class="dw-navpage-develop" role="presentation">
                    <a href="https://www.ibm.com/developerworks/ru/downloads/" role="menuitem" tabindex="-1">Разрабатывайте</a>
                </li>                    

                <li class="dw-navpage-connect" role="presentation">
                    <a href="https://www.ibm.com/developerworks/ru/community/" role="menuitem" tabindex="-1">Подключайтесь</a>
                </li>  
        </ul>
    </div>
</div>        <!-- MASTHEAD_SITENAV_END -->
        
        <!-- NAVIGATION_TRAIL_BEGIN -->
        <div id="ibm-leadspace-head" class="ibm-alternate">
            <div id="ibm-leadspace-body">
                <nav aria-label="Breadcrumb" role="navigation">                     
                                <ul id="dw-navigation-trail" itemscope="" itemtype="http://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><a itemprop="item" href="https://www.ibm.com/developerworks/ru/topics/"><span itemprop="name">Изучайте</span></a><meta itemprop="position" content="1"></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><a itemprop="item" href="https://www.ibm.com/developerworks/ru/web/"><span itemprop="name">Web-архитектура</span></a><meta itemprop="position" content="2"></li></ul>
                </nav>
            </div>
        </div>
        <!-- NAVIGATION_TRAIL_END -->
        
    </header>
    <!-- LEADSPACE_END -->
    
    <!-- MAIN_CONTENT_BEGIN -->
    <main role="main" aria-label=""> 
        <div id="ibm-pcon">
            <!-- BEGIN_IBM-CONTENT -->
            <div id="ibm-content">
                <!-- BEGIN_IBM-CONTENT-BODY -->
                <div id="ibm-content-body">
                    <!-- BEGIN_IBM-CONTENT-MAIN -->
                    <div id="ibm-content-main" class="dw-article">                        
                        <!-- BEGIN_INTERIOR-COLUMNS -->
                                <div class="ibm-columns dw-article-toc">
                                    <!-- LEFT_6_2_CONTENT_COLUMN_BEGIN -->  
                                    <div id="dw-article-toc-container" class="ibm-col-6-2">
                                        <div id="dw-article-toc-body" data-widget="scrollable" data-height="518" style="width: 460px; height: 518px;" class="ibm-widget-processed"><div class="nano-content" tabindex="-1" style="right: -17px;">
                                            <h2>Содержание</h2><div class="ibm-alternate-rule"><hr></div><ul role="directory" aria-label="Содержание" class="ibm-plain-list"><li class=""><a onclick="tocLink(&#39;#ibm-pagetitle-h1&#39;)" role="link" tabindex="0">Введение</a></li><li class="dw-highlight"><a onclick="tocLink(&#39;#N1006C&#39;)" role="link" tabindex="0">Применение API javax.script</a></li><li><a onclick="tocLink(&#39;#N101C1&#39;)" role="link" tabindex="0">Построение исполнителя сценариев</a></li><li><a onclick="tocLink(&#39;#N10304&#39;)" role="link" tabindex="0">Разработка сценариев на стороне сервера</a></li><li><a onclick="tocLink(&#39;#N10407&#39;)" role="link" tabindex="0">Заключение</a></li><li><a onclick="tocLink(&#39;#artdownload&#39;)" role="link" tabindex="0">Ресурсы для скачивания</a></li><li><a onclick="tocLink(&#39;#artrelatedtopics&#39;)" role="link" tabindex="0">Похожие темы</a></li><li><a onclick="tocLink(&#39;#icomments&#39;)" role="link" tabindex="0">Комментарии</a></li></ul>
                                        </div><div class="nano-pane" style="display: none; opacity: 1; visibility: visible;"><div class="nano-slider" style="height: 502px; transform: translate(0px, 0px);"></div></div></div>
                                    </div>
                                    <!-- LEFT_6_2_CONTENT_COLUMN_END -->
                                    
                                    <!-- CENTER_6_4_CONTENT_COLUMN_BEGIN -->
                                    <div class="ibm-col-6-4">
                                            <p class="dw-article-series-head">JavaScript EE</p>
                                        <h1 id="ibm-pagetitle-h1" class="ibm-h1">Часть 1. Исполнение файлов JavaScript на стороне сервера</h1><p class="dw-article-subhead">Учимся применять API javax.script в приложениях Ajax и Java ЕЕ</p>
                                        <!-- Article Top Bar -->
                                                <div class="ibm-columns dw-article-topbar">
                                                    <!-- Author and article info. -->
                                                    <div class="ibm-col-6-2 ibm-col-medium-6-4 dw-article-metadata">
                                                        <div class="dw-article-avatar"><img width="42" height="42" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/dw-author.png" alt=""></div><div class="dw-article-authordate">Андрей Чиорояну<br><span class="dw-article-pubdate">Опубликовано 28.06.2010</span></div>
                                                    </div>
                                                    <!-- Social -->
                                                    <div class="ibm-col-6-2 ibm-col-medium-6-4 ibm-col-small-6-2 dw-article-social">
                                                        <!-- Sharing links -->
                                                        <div id="dw-article-share-inline">
                                                            <div class="dw-article-sharelink-inline">
                                                                <div class="ibm-sharethispage"><h4 class="ibm-bold">Поделиться этой страницей</h4><p class="ibm-icononly"><a class="ibm-digg-encircled-link" href="http://digg.com/submit?phase=2&amp;url=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fru%2Flibrary%2Fwa-aj-javaee%2Findex.html&amp;title=JavaScript%20EE%3A%20%D0%A7%D0%B0%D1%81%D1%82%D1%8C%201.%20%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%20JavaScript%20%D0%BD%D0%B0%20%D1%81%D1%82%D0%BE%D1%80%D0%BE%D0%BD%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0" data-id="digg" onclick="return IBMCore.common.module.sharethispage.gotoUrl(window.open(), this);">Digg</a><a class="ibm-facebook-encircled-link" href="http://www.facebook.com/sharer.php?u=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fru%2Flibrary%2Fwa-aj-javaee%2Findex.html&amp;t=JavaScript%20EE%3A%20%D0%A7%D0%B0%D1%81%D1%82%D1%8C%201.%20%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%20JavaScript%20%D0%BD%D0%B0%20%D1%81%D1%82%D0%BE%D1%80%D0%BE%D0%BD%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0" data-id="facebook" onclick="return IBMCore.common.module.sharethispage.gotoUrl(window.open(), this);">Facebook</a><a class="ibm-twitter-encircled-link" href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fibm.co%2F2hakBBe&amp;text=JavaScript%20EE%3A%20%D0%A7%D0%B0%D1%81%D1%82%D1%8C%201.%20%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%20JavaScript%20%D0%BD%D0%B0%20%D1%81%D1%82%D0%BE%D1%80%D0%BE%D0%BD%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0&amp;via=developerWorks" data-id="twitter" onclick="return IBMCore.common.module.sharethispage.gotoUrl(window.open(), this);">Twitter</a><a class="ibm-delicious-encircled-link" href="http://delicious.com/post?url=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fru%2Flibrary%2Fwa-aj-javaee%2Findex.html&amp;title=JavaScript%20EE%3A%20%D0%A7%D0%B0%D1%81%D1%82%D1%8C%201.%20%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%20JavaScript%20%D0%BD%D0%B0%20%D1%81%D1%82%D0%BE%D1%80%D0%BE%D0%BD%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0" data-id="delicious" onclick="return IBMCore.common.module.sharethispage.gotoUrl(window.open(), this);">Delicious</a><a class="ibm-linkedin-encircled-link" href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fru%2Flibrary%2Fwa-aj-javaee%2Findex.html&amp;title=JavaScript%20EE%3A%20%D0%A7%D0%B0%D1%81%D1%82%D1%8C%201.%20%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%20JavaScript%20%D0%BD%D0%B0%20%D1%81%D1%82%D0%BE%D1%80%D0%BE%D0%BD%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0" data-id="linkedin" onclick="return IBMCore.common.module.sharethispage.gotoUrl(window.open(), this);">Linked In</a><a class="ibm-googleplus-encircled-link" href="https://plus.google.com/share?url=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fru%2Flibrary%2Fwa-aj-javaee%2Findex.html&amp;t=JavaScript%20EE%3A%20%D0%A7%D0%B0%D1%81%D1%82%D1%8C%201.%20%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%20JavaScript%20%D0%BD%D0%B0%20%D1%81%D1%82%D0%BE%D1%80%D0%BE%D0%BD%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0" data-id="googleplus" onclick="return IBMCore.common.module.sharethispage.gotoUrl(window.open(), this);">Google+</a><a class="ibm-email-encircled-link" href="mailto:?subject=JavaScript%20EE%3A%20%D0%A7%D0%B0%D1%81%D1%82%D1%8C%201.%20%D0%98%D1%81%D0%BF%D0%BE%D0%BB%D0%BD%D0%B5%D0%BD%D0%B8%D0%B5%20%D1%84%D0%B0%D0%B9%D0%BB%D0%BE%D0%B2%20JavaScript%20%D0%BD%D0%B0%20%D1%81%D1%82%D0%BE%D1%80%D0%BE%D0%BD%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%B0&amp;body=http%3A%2F%2Fwww.ibm.com%2Fdeveloperworks%2Fru%2Flibrary%2Fwa-aj-javaee%2Findex.html" data-id="email" onclick="">Отправить эту страницу по электронной почте</a></p></div>
                                                            </div>
                                                        </div>
                                                        <!-- Number of comments and link to comments -->
                                                        <div id="dw-article-cmts">
                                                            <div class="dw-article-cmtslink">
                                                                <a onclick="tocLink(&#39;#icomments&#39;)" href="https://www.ibm.com/developerworks/ru/library/wa-aj-javaee/#icomments" role="link" tabindex="0" aria-label="Comments">
                                                                    <img src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/dw-article-cmt-icon.png" width="29" height="29" alt="Comments">
                                                                </a>
                                                            </div>
                                                            <div class="dw-article-cmtslink">
                                                                <a onclick="tocLink(&#39;#icomments&#39;)" href="https://www.ibm.com/developerworks/ru/library/wa-aj-javaee/#icomments" role="link" tabindex="0">
                                                                    <div id="nCmts">0</div>
                                                                </a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
<div id="dw-series-container" style="display: block;"><h3 class="ibm-h3" id="dw-series-heading">Серия контента:</h3><div data-widget="showhide" data-type="panel" class="ibm-show-hide ibm-widget-processed"><h2 id="dw-series-show-hide"><a href="javascript:void();">Этот контент является частью  серии:<span id="dw-series-title-alt">JavaScript EE</span></a></h2><div class="ibm-container-body" id="dw-series-links" style="display: none;"><ul id="dw-series-list"><li class="dw-series-item">Часть 1. Исполнение файлов JavaScript на стороне сервера</li><li class="dw-series-item"><a href="http://www.ibm.com/developerworks/ru/library/wa-aj-javaee2/index.html?ca=drs-" class="dw-series-article-link">Часть 2. Вызов удаленных функций JavaScript с помощью Ajax</a></li></ul></div></div></div>
                                        <!-- Article Body -->
                                        
                                        <p>На стороне клиента типичные приложения Ajax используют JavaScript, а на стороне сервера — другие языки, такие как Java. В результате разработчикам приходится создавать некоторые программы дважды, используя для Web-браузера JavaScript, а для сервера другой язык. Этой двойной работы можно избежать, воспользовавшись на стороне сервера языком JavaScript в сочетании с Java, чтобы получить полную поддержку языков сценариев через API  <code>javax.script</code>. К тому же Java SE Development Kit (JDK) 6 уже содержит механизм JavaScript Rhino от Mozilla, поэтому дополнительно устанавливать ничего не нужно. </p><p>В этой первой статье данной серии мы воспользуемся простым сценарием, который позволяет исполнять файлы JavaScript внутри приложений Java ЕЕ. Сценарии будут иметь доступ к так называемым "неявным объектам" (implicit objects), которые используются в страницах JSP, таким как <code>application</code>, <code>session</code>, <code>request</code> и <code>response</code>. Большинство примеров состоит из многократно используемого кода, так что вам будет легко перейти к применению JavaScript на сервере в своих собственных приложениях. </p><h2 id="N1006C" class="ibm-h2">Применение API javax.script</h2><p>В этом разделе содержится обзор API <code>javax.script</code>. Вы научитесь исполнять сценарии, которые обращаются к объектам Java, вызывают функции JavaScript из кода Java и реализуют механизм кэширования для скомпилированных сценариев. </p><h3 id="N10077" class="ibm-h3">Исполнение сценариев</h3><p>API  <code>javax.script</code> чрезвычайно прост. Начнем с создания экземпляра <code>ScriptEngineManager</code>, который позволяет получить объект <code>ScriptEngine</code> (см. листинг 1) посредством одного из следующих методов: </p><ul class="ibm-bullet-list"><li><code>getEngineByName()</code></li><li><code>getEngineByExtension()</code></li><li><code>getEngineByMimeType()</code></li></ul><h5 id="N10094" class="ibm-h5">Листинг 1. Получение экземпляра ScriptEngine </h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_912635" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">import javax.script.*;</code></div><div class="line number2 index1 alt1"><code class="htmlscript plain">...</code></div><div class="line number3 index2 alt2"><code class="htmlscript plain">ScriptEngineManager manager = new ScriptEngineManager();</code></div><div class="line number4 index3 alt1"><code class="htmlscript plain">ScriptEngine engine = manager.getEngineByName("JavaScript");</code></div><div class="line number5 index4 alt2"><code class="htmlscript plain">...</code></div><div class="line number6 index5 alt1"><code class="htmlscript plain">engine.eval(...);</code></div></div></td></tr></tbody></table></div></div></div></span><p>Список доступных механизмов сценариев можно получить также с помощью <code>getEngineFactories()</code> В настоящее время в JDK 6 входит только механизм <code>JavaScript</code>, но <code>ScriptEngineManager</code> реализует функцию поиска сторонних механизмов, поддерживающих <em>JSR-223 Scripting for the Java Platform</em> (см. <a href="https://www.ibm.com/developerworks/ru/library/wa-aj-javaee/#artrelatedtopics">Ресурсы </a>). Нужно просто включить файлы JAR соответствующих механизмов сценариев в свой CLASSPATH. </p><p>Создав экземпляр <code>javax.script.ScriptEngine</code>, можно вызвать <code>eval()</code> для исполнения сценариев. Можно также экспортировать объекты Java в качестве переменных сценария, передав объект <code>Bindings</code> методу  <code>eval()</code>. В листинге 2 приведен пример кода ScriptDemo.java, который экспортирует две переменные с именами <code>demoVar</code> и  <code>strBuf</code>, исполняет сценарий с именем DemoScript.js, а затем получает переменные для вывода их измененных значений.  </p><h5 id="N100C1" class="ibm-h5">Листинг 2. Пример ScriptDemo.java.</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_946819" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">package jsee.demo;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="htmlscript plain">import javax.script.*;</code></div><div class="line number4 index3 alt1"><code class="htmlscript plain">import java.io.*;</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="htmlscript plain">public class ScriptDemo {</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">public static void main(String args[]) throws Exception {</code></div><div class="line number9 index8 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">// Get the JavaScript engine</code></div><div class="line number10 index9 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">ScriptEngineManager manager = new ScriptEngineManager();</code></div><div class="line number11 index10 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">ScriptEngine engine = manager.getEngineByName("JavaScript");</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">// Set JavaScript variables</code></div><div class="line number14 index13 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">Bindings vars = new SimpleBindings();</code></div><div class="line number15 index14 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">vars.put("demoVar", "value set in ScriptDemo.java");</code></div><div class="line number16 index15 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">vars.put("strBuf", new StringBuffer("string buffer"));</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">// Run DemoScript.js</code></div><div class="line number19 index18 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">Reader scriptReader = new InputStreamReader(</code></div><div class="line number20 index19 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">ScriptDemo.class.getResourceAsStream("DemoScript.js"));</code></div><div class="line number21 index20 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">try {</code></div><div class="line number22 index21 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">engine.eval(scriptReader, vars);</code></div><div class="line number23 index22 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">} finally {</code></div><div class="line number24 index23 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">scriptReader.close();</code></div><div class="line number25 index24 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number26 index25 alt1">&nbsp;</div><div class="line number27 index26 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">// Get JavaScript variables</code></div><div class="line number28 index27 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">Object demoVar = vars.get("demoVar");</code></div><div class="line number29 index28 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">System.out.println("[Java] demoVar: " + demoVar);</code></div><div class="line number30 index29 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">System.out.println("&nbsp;&nbsp;&nbsp; Java object: " + demoVar.getClass().getName());</code></div><div class="line number31 index30 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">System.out.println();</code></div><div class="line number32 index31 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">Object strBuf = vars.get("strBuf");</code></div><div class="line number33 index32 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">System.out.println("[Java] strBuf: " + strBuf);</code></div><div class="line number34 index33 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">System.out.println("&nbsp;&nbsp;&nbsp; Java object: " + strBuf.getClass().getName());</code></div><div class="line number35 index34 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">System.out.println();</code></div><div class="line number36 index35 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">Object newVar = vars.get("newVar");</code></div><div class="line number37 index36 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">System.out.println("[Java] newVar: " + newVar);</code></div><div class="line number38 index37 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">System.out.println("&nbsp;&nbsp;&nbsp; Java object: " + newVar.getClass().getName());</code></div><div class="line number39 index38 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">System.out.println();</code></div><div class="line number40 index39 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number41 index40 alt2">&nbsp;</div><div class="line number42 index41 alt1"><code class="htmlscript plain">}</code></div></div></td></tr></tbody></table></div></div></div></span><p>Файл DemoScript.js (приведен в листинге 3) содержит функцию <code> printType()</code>, которая используется для вывода типа каждой переменной сценария. Пример вызывает метод <code>append()</code> объекта <code>strBuf</code>, изменяет значение <code>demoVar</code> и создает новую переменную сценария с именем <code>newVar</code>.</p><p>Если объект, переданный <code>printType()</code>, содержит метод <code>getClass()</code>, он должен быть объектом Java, имя класса которого получается с помощью <code>obj.getClass().name</code>. Это выражение JavaScript вызывает метод <code>getName()</code> экземпляра объекта <code>java.lang.Class</code>. Если объект не содержит члена <code>getClass</code>, то <code>printType()</code> вызывает метод <code>toSource()</code>, который должен содержать все объекты JavaScript.  </p><h5 id="N100F3" class="ibm-h5">Листинг 3. 
Пример DemoScript.js</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_603689" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">println("Start script \r\n");</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="htmlscript plain">// Output the type of an object</code></div><div class="line number4 index3 alt1"><code class="htmlscript plain">function printType(obj) {</code></div><div class="line number5 index4 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">if (obj.getClass)</code></div><div class="line number6 index5 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">println("&nbsp;&nbsp;&nbsp; Java object: " + obj.getClass().name);</code></div><div class="line number7 index6 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">else</code></div><div class="line number8 index7 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">println("&nbsp;&nbsp;&nbsp; JS object: " + obj.toSource());</code></div><div class="line number9 index8 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">println("");</code></div><div class="line number10 index9 alt1"><code class="htmlscript plain">}</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="htmlscript plain">// Print variable</code></div><div class="line number13 index12 alt2"><code class="htmlscript plain">println("[JS] demoVar: " + demoVar);</code></div><div class="line number14 index13 alt1"><code class="htmlscript plain">printType(demoVar);</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="htmlscript plain">// Call method of Java object</code></div><div class="line number17 index16 alt2"><code class="htmlscript plain">strBuf.append(" used in DemoScript.js");</code></div><div class="line number18 index17 alt1"><code class="htmlscript plain">println("[JS] strBuf: " + strBuf);</code></div><div class="line number19 index18 alt2"><code class="htmlscript plain">printType(strBuf);</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="htmlscript plain">// Modify variable</code></div><div class="line number22 index21 alt1"><code class="htmlscript plain">demoVar = "value set in DemoScript.js";</code></div><div class="line number23 index22 alt2"><code class="htmlscript plain">println("[JS] demoVar: " + demoVar);</code></div><div class="line number24 index23 alt1"><code class="htmlscript plain">printType(demoVar);</code></div><div class="line number25 index24 alt2">&nbsp;</div><div class="line number26 index25 alt1"><code class="htmlscript plain">// Set a new variable</code></div><div class="line number27 index26 alt2"><code class="htmlscript plain">var newVar = { x: 1, y: { u: 2, v: 3 } }</code></div><div class="line number28 index27 alt1"><code class="htmlscript plain">println("[JS] newVar: " + newVar);</code></div><div class="line number29 index28 alt2"><code class="htmlscript plain">printType(newVar);</code></div><div class="line number30 index29 alt1">&nbsp;</div><div class="line number31 index30 alt2"><code class="htmlscript plain">println("End script \r\n");</code></div></div></td></tr></tbody></table></div></div></div></span><p>В листинге 4 приведен результат исполнения примера ScriptDemo.java. Первое, что бросается в глаза, это то, что переменная <code>demoVar</code> экспортирована как <code>строка</code> JavaScript, тогда как тип <code>strBuf</code> остался прежним: <code>java.lang.StringBuffer</code>. Простые переменные и строки Java экспортируются как стандартные объекты JavaScript. Любые другие объекты Java (включая массивы) экспортируются неизменными. </p><h5 id="N10108" class="ibm-h5">Листинг 4. 
Результат ScriptDemo.java</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_313987" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">Start script</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="htmlscript plain">[JS] demoVar: value set in ScriptDemo.java</code></div><div class="line number4 index3 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">JS object: (new String("value set in ScriptDemo.java"))</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="htmlscript plain">[JS] strBuf: string buffer used in DemoScript.js</code></div><div class="line number7 index6 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">Java object: java.lang.StringBuffer</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="htmlscript plain">[JS] demoVar: value set in DemoScript.js</code></div><div class="line number10 index9 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">JS object: (new String("value set in DemoScript.js"))</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="htmlscript plain">[JS] newVar: [object Object]</code></div><div class="line number13 index12 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">JS object: ({x:1, y:{u:2, v:3}})</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="htmlscript plain">End script</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="htmlscript plain">[Java] demoVar: value set in DemoScript.js</code></div><div class="line number18 index17 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">Java object: java.lang.String</code></div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="htmlscript plain">[Java] strBuf: string buffer used in DemoScript.js</code></div><div class="line number21 index20 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">Java object: java.lang.StringBuffer</code></div><div class="line number22 index21 alt1">&nbsp;</div><div class="line number23 index22 alt2"><code class="htmlscript plain">[Java] newVar: [object Object]</code></div><div class="line number24 index23 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">Java object: sun.org.mozilla.javascript.internal.NativeObject</code></div></div></td></tr></tbody></table></div></div></div></span><p>После исполнения сценария механизм берет все переменные (в том числе новые) и выполняет обратное преобразование, превращая примитивы и строки JavaScript в объекты Java. Другие объекты JavaScript внедряются в объекты Java с использованием  специфического для данного механизма внутреннего API, такого как <code>sun.org.mozilla.javascript.internal.NativeObject</code>. </p><p>Так как желательно использовать только стандартные API, весь обмен данными между кодом Java и исполняемым сценарием должен осуществляться посредством простых переменных, строк и объектов Java (например, компонентов), к свойствам и методам которых можно легко обращаться в коде JavaScript. Попросту говоря, не пытайтесь обращаться к стандартным объектам JavaScript в своем коде Java. Вместо этого используйте объекты Java в коде JavaScript. </p><h3 id="N10114" class="ibm-h3">Обращение к функциям</h3><p>Из предыдущего примера видно, что методы Java можно вызывать из JavaScript. Теперь посмотрим, как обращаться к функциям JavaScript из кода Java. Прежде всего нужно выполнить сценарий, содержащий нужную функцию. Затем экземпляр  <code>ScriptEngine</code> преобразуется в <code>javax.script.Invocable</code>, что дает <code>invokeFunction()</code> и <code>invokeMethod()</code>. Если ваш сценарий реализует все методы интерфейса Java, можно также воспользоваться <code>getInterface()</code> для получения объекта Java, методы которого запрограммированы на языке сценариев. </p><p>Пример InvDemo.java (приведен в листинге 5) выполняет сценарий с именем InvScript.js, содержащий подпрограмму  <code>demoFunction()</code>. После преобразования экземпляра <code>ScriptEngine</code> в  <code>Invocable</code> пример Java передает имя и параметры функции методу  <code>invokeFunction()</code> механизма, который возвращает значение, полученное от <code>demoFunction()</code>.</p><h5 id="N1013E" class="ibm-h5">Листинг 5. 
Пример InvDemo.java</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_865398" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">package jsee.demo;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="htmlscript plain">import javax.script.*;</code></div><div class="line number4 index3 alt1"><code class="htmlscript plain">import java.io.*;</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="htmlscript plain">public class InvDemo {</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">public static void main(String args[]) throws Exception {</code></div><div class="line number9 index8 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">// Get the JavaScript engine</code></div><div class="line number10 index9 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">ScriptEngineManager manager = new ScriptEngineManager();</code></div><div class="line number11 index10 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">ScriptEngine engine = manager.getEngineByName("JavaScript");</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">// Run InvScript.js</code></div><div class="line number14 index13 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">Reader scriptReader = new InputStreamReader(</code></div><div class="line number15 index14 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">InvDemo.class.getResourceAsStream("InvScript.js"));</code></div><div class="line number16 index15 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">try {</code></div><div class="line number17 index16 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">engine.eval(scriptReader);</code></div><div class="line number18 index17 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">} finally {</code></div><div class="line number19 index18 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">scriptReader.close();</code></div><div class="line number20 index19 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">// Invoke a JavaScript function</code></div><div class="line number23 index22 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">if (engine instanceof Invocable) {</code></div><div class="line number24 index23 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">Invocable invEngine = (Invocable) engine;</code></div><div class="line number25 index24 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">Object result = invEngine.invokeFunction("demoFunction", 1, 2.3);</code></div><div class="line number26 index25 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">System.out.println("[Java] result: " + result);</code></div><div class="line number27 index26 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">System.out.println("&nbsp;&nbsp;&nbsp; Java object: "</code></div><div class="line number28 index27 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">+ result.getClass().getName());</code></div><div class="line number29 index28 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">System.out.println();</code></div><div class="line number30 index29 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">} else</code></div><div class="line number31 index30 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">System.out.println("NOT Invocable");</code></div><div class="line number32 index31 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number33 index32 alt2">&nbsp;</div><div class="line number34 index33 alt1"><code class="htmlscript plain">}</code></div></div></td></tr></tbody></table></div></div></div></span><p>Файл InvScript.js (см. листинг 6) содержит подпрограмму <code>demoFunction()</code> и ту же функцию  <code>printType()</code>, которая использовалась в предыдущем примере сценария. </p><h5 id="N1014D" class="ibm-h5">Листинг 6. 
Пример InvScript.js</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_384077" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">println("Start script \r\n");</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="htmlscript plain">function printType(obj) {</code></div><div class="line number4 index3 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">if (obj.getClass)</code></div><div class="line number5 index4 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">println("&nbsp;&nbsp;&nbsp; Java object: " + obj.getClass().name);</code></div><div class="line number6 index5 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">else</code></div><div class="line number7 index6 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">println("&nbsp;&nbsp;&nbsp; JS object: " + obj.toSource());</code></div><div class="line number8 index7 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">println("");</code></div><div class="line number9 index8 alt2"><code class="htmlscript plain">}</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="htmlscript plain">function demoFunction(a, b) {</code></div><div class="line number12 index11 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">println("[JS] a: " + a);</code></div><div class="line number13 index12 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">printType(a);</code></div><div class="line number14 index13 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">println("[JS] b: " + b);</code></div><div class="line number15 index14 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">printType(b);</code></div><div class="line number16 index15 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">var c = a + b;</code></div><div class="line number17 index16 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">println("[JS] c: " + c);</code></div><div class="line number18 index17 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">printType(c);</code></div><div class="line number19 index18 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">return c;</code></div><div class="line number20 index19 alt1"><code class="htmlscript plain">}</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="htmlscript plain">println("End script \r\n");</code></div></div></td></tr></tbody></table></div></div></div></span><p>Если посмотреть на результат InvDemo.java (показан в листинге 7), видно, что числовые параметры преобразованы в объекты JavaScript, а значения, возвращаемые функцией <code>demoFunction()</code>, получены как объекты Java. Эти преобразования выполняются только для примитивов и строк. Любые другие объекты передаются между JVM и механизмом JavaScript неизменными. </p><h5 id="N10159" class="ibm-h5">Листинг 7. 
Результат InvDemo.java</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_101479" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">Start script</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="htmlscript plain">End script</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="htmlscript plain">[JS] a: 1</code></div><div class="line number6 index5 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">JS object: (new Number(1))</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="htmlscript plain">[JS] b: 2.3</code></div><div class="line number9 index8 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">JS object: (new Number(2.3))</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="htmlscript plain">[JS] c: 3.3</code></div><div class="line number12 index11 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">JS object: (new Number(3.3))</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="htmlscript plain">[Java] result: 3.3</code></div><div class="line number15 index14 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">Java object: java.lang.Double</code></div></div></td></tr></tbody></table></div></div></div></span><p>Обратите внимание на то, что <code>javax.script.Invocable</code> - это необязательный интерфейс, который может быть реализован не во всех механизмов сценариев. Механизм JavaScript, поставляемый с JDK 6, не поддерживает этот интерфейс. </p><h3 id="N10163" class="ibm-h3">Компиляция сценариев</h3><p>Интерпретация сценариев при каждом их исполнении приводит к расходу ресурсов процессора. Если одни и те же сценарии выполняются много раз, время их исполнения можно существенно сократить, скомпилировав эти сценарии с использованием методов, предоставляемых другим необязательным интерфейсом с именем <code>javax.script.Compilable</code>, который поддерживается механизмом JavaScript из JDK 6. </p><p>Класс <code>CachedScript</code> (см. листинг 8) берет файл сценария и перекомпилирует его заново только в случае изменения исходного кода. Метод  <code>getCompiledScript()</code> вызывает метод <code>compile()</code> из механизма сценариев, который возвращает объект <code>javax.script.CompiledScript</code>, методы <code>eval()</code> которого исполняют сценарий.  </p><h5 id="N10181" class="ibm-h5">Листинг 8. 
Класс CachedScript</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_371540" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">package jsee.cache;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="htmlscript plain">import javax.script.*;</code></div><div class="line number4 index3 alt1"><code class="htmlscript plain">import java.io.*;</code></div><div class="line number5 index4 alt2"><code class="htmlscript plain">import java.util.*;</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="htmlscript plain">public class CachedScript {</code></div><div class="line number8 index7 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">private Compilable scriptEngine;</code></div><div class="line number9 index8 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">private File scriptFile;</code></div><div class="line number10 index9 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">private CompiledScript compiledScript;</code></div><div class="line number11 index10 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">private Date compiledDate;</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">public CachedScript(Compilable scriptEngine, File scriptFile) {</code></div><div class="line number14 index13 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">this.scriptEngine = scriptEngine;</code></div><div class="line number15 index14 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">this.scriptFile = scriptFile;</code></div><div class="line number16 index15 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number17 index16 alt2">&nbsp;</div><div class="line number18 index17 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">public CompiledScript getCompiledScript()</code></div><div class="line number19 index18 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">throws ScriptException, IOException {</code></div><div class="line number20 index19 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">Date scriptDate = new Date(scriptFile.lastModified());</code></div><div class="line number21 index20 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">if (compiledDate == null || scriptDate.after(compiledDate)) {</code></div><div class="line number22 index21 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">Reader reader = new FileReader(scriptFile);</code></div><div class="line number23 index22 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">try {</code></div><div class="line number24 index23 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">compiledScript = scriptEngine.compile(reader);</code></div><div class="line number25 index24 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">compiledDate = scriptDate;</code></div><div class="line number26 index25 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">} finally {</code></div><div class="line number27 index26 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">reader.close();</code></div><div class="line number28 index27 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number29 index28 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number30 index29 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">return compiledScript;</code></div><div class="line number31 index30 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number32 index31 alt1">&nbsp;</div><div class="line number33 index32 alt2"><code class="htmlscript plain">}</code></div></div></td></tr></tbody></table></div></div></div></span><p>Класс  <code>ScriptCache</code> (показан в листинге 9) организует репозиторий для скомпилированных сценариев, используя объект <code>java.util.LinkedHashMap</code>. Первоначальная емкость map-таблицы устанавливается равной максимальному числу сохраненных в кэше сценариев, а коэффициент загрузки равен 1. Эти два параметра гарантируют, что <code>cacheMap</code> никогда не придется хешировать заново. </p><p>По умолчанию класс <code>LinkedHashMap</code> использует для своих записей порядок вставки (insert-order). Третий параметр конструктора <code>LinkedHashMap()</code> должен иметь значение  <code>true</code>, чтобы вместо порядка по умолчанию для записей map-таблицы использовать порядок доступа (access-order). </p><p>После достижения максимальной емкости кэша метод <code>removeEldestEntry()</code> начинает выдавать значение <code>true</code>, так что всякий раз, когда в кэш добавляется новый сценарий, из  <code>cacheMap</code> автоматически удаляется запись.  </p><p>Применяя механизм автоматического удаления <code>LinkedHashMap</code> в сочетании с порядком доступа,  <code>ScriptCache</code> гарантирует, что при добавлении нового сценария из кэша будет удаляться сценарий с наиболее длительным отсутствием обращений (Least Recently Used - LRU).  </p><h5 id="N101B1" class="ibm-h5">Листинг 9. Класс ScriptCache</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_707664" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">package jsee.cache;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="htmlscript plain">import javax.script.*;</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="htmlscript plain">import java.io.*;</code></div><div class="line number6 index5 alt1"><code class="htmlscript plain">import java.util.*;</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="htmlscript plain">public abstract class ScriptCache {</code></div><div class="line number9 index8 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">public static final String ENGINE_NAME = "JavaScript";</code></div><div class="line number10 index9 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">private Compilable scriptEngine;</code></div><div class="line number11 index10 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">private LinkedHashMap&lt;</code><code class="htmlscript plain">String</code><code class="htmlscript plain">, CachedScript&gt; cacheMap;</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">public ScriptCache(final int maxCachedScripts) {</code></div><div class="line number14 index13 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">ScriptEngineManager manager = new ScriptEngineManager();</code></div><div class="line number15 index14 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">scriptEngine = (Compilable) manager.getEngineByName(ENGINE_NAME);</code></div><div class="line number16 index15 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">cacheMap = new LinkedHashMap&lt;</code><code class="htmlscript plain">String</code><code class="htmlscript plain">, CachedScript&gt;(</code></div><div class="line number17 index16 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">maxCachedScripts, 1, true) {</code></div><div class="line number18 index17 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">protected boolean removeEldestEntry(Map.Entry eldest) {</code></div><div class="line number19 index18 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">return size() &gt; maxCachedScripts;</code></div><div class="line number20 index19 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number21 index20 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">};</code></div><div class="line number22 index21 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number23 index22 alt2">&nbsp;</div><div class="line number24 index23 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">public abstract File getScriptFile(String key);</code></div><div class="line number25 index24 alt2">&nbsp;</div><div class="line number26 index25 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">public synchronized CompiledScript getScript(String key)</code></div><div class="line number27 index26 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">throws ScriptException, IOException {</code></div><div class="line number28 index27 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">CachedScript script = cacheMap.get(key);</code></div><div class="line number29 index28 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">if (script == null) {</code></div><div class="line number30 index29 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">script = new CachedScript(scriptEngine, getScriptFile(key));</code></div><div class="line number31 index30 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">cacheMap.put(key, script);</code></div><div class="line number32 index31 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number33 index32 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">return script.getCompiledScript();</code></div><div class="line number34 index33 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number35 index34 alt2">&nbsp;</div><div class="line number36 index35 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">public ScriptEngine getEngine() {</code></div><div class="line number37 index36 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">return (ScriptEngine) scriptEngine;</code></div><div class="line number38 index37 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number39 index38 alt2">&nbsp;</div><div class="line number40 index39 alt1"><code class="htmlscript plain">}</code></div></div></td></tr></tbody></table></div></div></div></span><p>В следующем разделе используется класс  <code>ScriptCache</code>, который реализует абстрактный метод <code>getScriptFile()</code> и использует <code>getScript()</code> для извлечения из кэша скомпилированных сценариев. </p><h2 id="N101C1" class="ibm-h2">Построение исполнителя сценариев</h2><p>В этом разделе мы покажем, как создать простой сервлет Java, реализующий отображение URL-сценарий, что позволяет запускать сценарии на стороне сервера из Web-браузера. Кроме этого, сервлет будет представлять несколько объектов Java ЕЕ как переменные, которые можно использовать в коде JavaScript. Мы покажем также, как использовать контексты сценария, которые позволяют одному механизму JavaScript исполнять несколько сценариев одновременно.  </p><h3 id="N101C9" class="ibm-h3">Инициализация сервлета</h3><p>Класс сервлетов называется <code>JSServlet</code>. Его метод <code>init()</code> (см. листинг 10) получает несколько параметров конфигурации и создает объект <code>ScriptCache</code>. Кэш сценариев сервлета посредством <code>getRealPath()</code> получает путь к файлу сценария, который отображается на данный URI.  </p><h5 id="N101DF" class="ibm-h5">Листинг 10. 
Метод init() JSServlet</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_283815" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">package jsee.servlet;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="htmlscript plain">import javax.script.*;</code></div><div class="line number4 index3 alt1"><code class="htmlscript plain">import javax.servlet.*;</code></div><div class="line number5 index4 alt2"><code class="htmlscript plain">import javax.servlet.http.*;</code></div><div class="line number6 index5 alt1"><code class="htmlscript plain">import java.io.*;</code></div><div class="line number7 index6 alt2"><code class="htmlscript plain">import jsee.cache.*;</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="htmlscript plain">public class JSServlet extends HttpServlet {</code></div><div class="line number10 index9 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">private String cacheControlHeader;</code></div><div class="line number11 index10 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">private String contentTypeHeader;</code></div><div class="line number12 index11 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">private ScriptCache scriptCache;</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">public void init() throws ServletException {</code></div><div class="line number15 index14 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">ServletConfig config = getServletConfig();</code></div><div class="line number16 index15 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">cacheControlHeader = config.getInitParameter("Cache-Control");</code></div><div class="line number17 index16 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">contentTypeHeader = config.getInitParameter("Content-Type");</code></div><div class="line number18 index17 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">int maxCachedScripts = Integer.parseInt(</code></div><div class="line number19 index18 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">config.getInitParameter("Max-Cached-Scripts"));</code></div><div class="line number20 index19 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">scriptCache = new ScriptCache(maxCachedScripts) {</code></div><div class="line number21 index20 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">public File getScriptFile(String uri) {</code></div><div class="line number22 index21 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">return new File(getServletContext().getRealPath(uri));</code></div><div class="line number23 index22 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number24 index23 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">};</code></div><div class="line number25 index24 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number26 index25 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">...</code></div><div class="line number27 index26 alt2"><code class="htmlscript plain">}</code></div></div></td></tr></tbody></table></div></div></div></span><p>В листинге 11 приведены параметры сервлета, который описан в файле web.xml. Заголовок <code>Cache-Control</code> не имеет никакого отношения к кэшу сценариев. Оба заголовка войдут в состав ответов HTTP, возвращаемых сервлетом. Значение <code>no-cache</code> указывает браузеру, что ответ сервлета, который следует рассматривать как <code>text/plain</code>, не надо помещать в кэш.</p><h5 id="N101F1" class="ibm-h5">Листинг 11. 
Файл web.xml</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_266974" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">&lt;</code><code class="htmlscript plain">web-app</code> <code class="htmlscript plain">...&gt;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">&lt;</code><code class="htmlscript plain">servlet</code><code class="htmlscript plain">&gt;</code></div><div class="line number4 index3 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">&lt;</code><code class="htmlscript plain">servlet-name</code><code class="htmlscript plain">&gt;JSServlet&lt;/</code><code class="htmlscript plain">servlet-name</code><code class="htmlscript plain">&gt;</code></div><div class="line number5 index4 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">&lt;</code><code class="htmlscript plain">servlet-class</code><code class="htmlscript plain">&gt;jsee.servlet.JSServlet&lt;/</code><code class="htmlscript plain">servlet-class</code><code class="htmlscript plain">&gt;</code></div><div class="line number6 index5 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">&lt;</code><code class="htmlscript plain">init-param</code><code class="htmlscript plain">&gt;</code></div><div class="line number7 index6 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">&lt;</code><code class="htmlscript plain">param-name</code><code class="htmlscript plain">&gt;Cache-Control&lt;/</code><code class="htmlscript plain">param-name</code><code class="htmlscript plain">&gt;</code></div><div class="line number8 index7 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">&lt;</code><code class="htmlscript plain">param-value</code><code class="htmlscript plain">&gt;no-cache&lt;/</code><code class="htmlscript plain">param-value</code><code class="htmlscript plain">&gt;</code></div><div class="line number9 index8 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">&lt;/</code><code class="htmlscript plain">init-param</code><code class="htmlscript plain">&gt;</code></div><div class="line number10 index9 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">&lt;</code><code class="htmlscript plain">init-param</code><code class="htmlscript plain">&gt;</code></div><div class="line number11 index10 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">&lt;</code><code class="htmlscript plain">param-name</code><code class="htmlscript plain">&gt;Content-Type&lt;/</code><code class="htmlscript plain">param-name</code><code class="htmlscript plain">&gt;</code></div><div class="line number12 index11 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">&lt;</code><code class="htmlscript plain">param-value</code><code class="htmlscript plain">&gt;text/plain&lt;/</code><code class="htmlscript plain">param-value</code><code class="htmlscript plain">&gt;</code></div><div class="line number13 index12 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">&lt;/</code><code class="htmlscript plain">init-param</code><code class="htmlscript plain">&gt;</code></div><div class="line number14 index13 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">&lt;</code><code class="htmlscript plain">init-param</code><code class="htmlscript plain">&gt;</code></div><div class="line number15 index14 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">&lt;</code><code class="htmlscript plain">param-name</code><code class="htmlscript plain">&gt;Max-Cached-Scripts&lt;/</code><code class="htmlscript plain">param-name</code><code class="htmlscript plain">&gt;</code></div><div class="line number16 index15 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">&lt;</code><code class="htmlscript plain">param-value</code><code class="htmlscript plain">&gt;1000&lt;/</code><code class="htmlscript plain">param-value</code><code class="htmlscript plain">&gt;</code></div><div class="line number17 index16 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">&lt;/</code><code class="htmlscript plain">init-param</code><code class="htmlscript plain">&gt;</code></div><div class="line number18 index17 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">&lt;</code><code class="htmlscript plain">load-on-startup</code><code class="htmlscript plain">&gt;1&lt;/</code><code class="htmlscript plain">load-on-startup</code><code class="htmlscript plain">&gt;</code></div><div class="line number19 index18 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">&lt;/</code><code class="htmlscript plain">servlet</code><code class="htmlscript plain">&gt;</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">&lt;</code><code class="htmlscript plain">servlet-mapping</code><code class="htmlscript plain">&gt;</code></div><div class="line number22 index21 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">&lt;</code><code class="htmlscript plain">servlet-name</code><code class="htmlscript plain">&gt;JSServlet&lt;/</code><code class="htmlscript plain">servlet-name</code><code class="htmlscript plain">&gt;</code></div><div class="line number23 index22 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">&lt;</code><code class="htmlscript plain">url-pattern</code><code class="htmlscript plain">&gt;*.jss&lt;/</code><code class="htmlscript plain">url-pattern</code><code class="htmlscript plain">&gt;</code></div><div class="line number24 index23 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">&lt;/</code><code class="htmlscript plain">servlet-mapping</code><code class="htmlscript plain">&gt;</code></div><div class="line number25 index24 alt2">&nbsp;</div><div class="line number26 index25 alt1"><code class="htmlscript plain">&lt;/</code><code class="htmlscript plain">web-app</code><code class="htmlscript plain">&gt;</code></div></div></td></tr></tbody></table></div></div></div></span><p>Как видно из листинга 11, в сервлет передается шаблон *.jss.  Это означает, что <code>JSServlet</code> будет обрабатывать все запросы, URL которых оканчивается расширением .jss. Когда пользователь вводит в Web-браузер такой URL или нажимает на ссылку .jss, браузер направляет запрос HTTP Web-серверу (например, Apache), который должен быть настроен на его передачу в контейнер сервлетов (например, Tomcat). Если контейнер сервлетов тоже действует как Web-сервер, никакого дополнительного конфигурирования не требуется. </p><p>Когда контейнер сервлетов получает запрос с URL, оканчивающимся на .jss, он обращается к методу <code>service()</code>, который наследует  <code>JSServlet</code> у <code>javax.servlet.http.HttpServlet</code>. В зависимости от метода запроса HTTP этот метод вызывает либо <code>doGet()</code>, либо <code>doPost()</code>. Как будет показано далее в этой главе, оба метода отменяются методом <code>JSServlet</code>. </p><h3 id="N1020F" class="ibm-h3">Использование контекстов сценария</h3><div class="dw-article-sidebar ibm-background-cool-white-20"><h5>Модели многопоточной обработки для механизмов сценариев</h5><p>Спецификация <em>JSR-223 Scripting for the Java Platform</em> (см. <a href="https://www.ibm.com/developerworks/ru/library/wa-aj-javaee/#artrelatedtopics">Ресурсы</a>) определяет три типа механизмов сценариев: </p><ul class="ibm-bullet-list"><li>Многопоточные механизмы, способные одновременно исполнять сценарии, которые могут модифицировать переменные, видимые из других потоков</li><li>Механизмы с изолированными потоками, которые тоже выполняют несколько потоков, но каждый из них работает только с собственными переменными</li><li>Механизмы без запоминания состояния, которые определяются как механизмы изолированного потока, что позволяет после выполнения любого сценария оставлять область действия механизма неизменной.   </li></ul><p>Тип механизма сценария можно определить с помощью метода <code>engine.getFactory().getParameter("THREADING")</code>, который возвращает значения  <code>"MULTITHREADED"</code>, <code>"THREAD-ISOLATED"</code> или <code>"STATELESS"</code>.</p></div><p>Каждый экземпляр механизма сценариев имеет контекст по умолчанию, куда можно класть переменные методом  <code>put()</code>, а выход любого выполненного сценария по умолчанию направляется на <code>System.out</code>. В среде сервера хотелось бы исполнять сценарии одновременно, чтобы у каждого из них при этом был собственный контекст. API <code>javax.script</code> выполняет это требование, предоставляя интерфейс <code>ScriptContext</code> и реализацию <code>SimpleScriptContext</code>.  </p><p>Механизм JavaScript Rhino от Mozilla представляет собой многопоточный механизм (см. врезку), позволяя одновременно исполнять сценарии, разделяющие один общий контекст. Однако в нашем случае нужно изолировать друг от друга области действия механизма и выход сценариев, работающих в разных потоках, а это значит, что для каждого запроса HTTP нужно создавать новый экземпляр  <code>ScriptContext</code>. </p><p>В листинге 12 показан метод <code>createScriptContext()</code> класса <code>JSServlet</code>. Этот метод устанавливает свойство контекста <code>writer</code>, чтобы при выполнении сценария направлять его выход на вход объекта <code>response</code>. Это означает, что все, что вы передаете в своем сценарии методам <code>print()</code>  или <code>println()</code>, будет включено в ответ сервлета. </p><p>Кроме того, <code>createScriptContext()</code> определяет следующие переменные сценария с помощью метода контекста сценария <code>setAttribute()</code>:  </p><h5 id="table1" class="ibm-h5">Таблица 1. Переменные сценариев, выполняемых сервлетом JSServlet</h5><div id="DataTables_Table_0_wrapper" class="dataTables_wrapper no-footer"><table border="0" cellpadding="0" cellspacing="0" class="ibm-data-table display dataTable no-footer dtr-inline ibm-widget-processed" data-widget="datatable" summary="Table 1. Script variables with the setAttribute() method" width="100%" id="DataTables_Table_0" role="grid" style="width: 100%;"><thead xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><tr role="row"><th class="ibm-background-neutral-white-30 sorting_disabled" scope="col" rowspan="1" colspan="1" style="width: 204px;">Переменная сценария</th><th class="ibm-background-neutral-white-30 sorting_disabled" scope="col" rowspan="1" colspan="1" style="width: 657px;">Описание</th></tr></thead><tbody xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><tr role="row" class="odd"><td tabindex="0"><code>config</code></td><td>экземпляр сервлета <code>javax.servlet.ServletConfig</code></td></tr><tr role="row" class="even"><td tabindex="0"><code>application</code></td><td>экземпляр Web-приложения <code>javax.servlet.ServletContext</code></td></tr><tr role="row" class="odd"><td tabindex="0"><code>session</code></td><td>объект <code>javax.servlet.http.HttpSession</code></td></tr><tr role="row" class="even"><td tabindex="0"><code>request</code></td><td>объект <code>javax.servlet.http.HttpServletRequest</code></td></tr><tr role="row" class="odd"><td tabindex="0"><code>response</code></td><td>объект <code>javax.servlet.http.HttpServletResponse</code></td></tr><tr role="row" class="even"><td tabindex="0"><code>out</code></td><td>объект <code>java.io.PrintWriter</code>, который используется для вывода результатов</td></tr><tr role="row" class="odd"><td tabindex="0"><code>factory</code></td><td><code>javax.script.ScriptEngineFactory</code> механизма сценария</td></tr></tbody></table></div><p>Переменная <code>factory</code> может использоваться для получения сведений о механизме JavaScript, таких как версия языка или версия самого механизма. Остальные переменные выполняют те же функции, что и в страницах JSP.  </p><h5 id="N102C0" class="ibm-h5">Листинг 12. Метод createScriptContext() JSServlet</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_124538" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">public class JSServlet extends HttpServlet {</code></div><div class="line number2 index1 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">...</code></div><div class="line number3 index2 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">protected ScriptContext createScriptContext(</code></div><div class="line number4 index3 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">HttpServletRequest request, HttpServletResponse response)</code></div><div class="line number5 index4 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">throws IOException {</code></div><div class="line number6 index5 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">ScriptContext scriptContext = new SimpleScriptContext();</code></div><div class="line number7 index6 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">scriptContext.setWriter(response.getWriter());</code></div><div class="line number8 index7 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">int scope = ScriptContext.ENGINE_SCOPE;</code></div><div class="line number9 index8 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">scriptContext.setAttribute("config", getServletConfig(), scope);</code></div><div class="line number10 index9 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">scriptContext.setAttribute("application", getServletContext(), scope);</code></div><div class="line number11 index10 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">scriptContext.setAttribute("session", request.getSession(), scope);</code></div><div class="line number12 index11 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">scriptContext.setAttribute("request", request, scope);</code></div><div class="line number13 index12 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">scriptContext.setAttribute("response", response, scope);</code></div><div class="line number14 index13 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">scriptContext.setAttribute("out", response.getWriter(), scope);</code></div><div class="line number15 index14 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">scriptContext.setAttribute("factory",</code></div><div class="line number16 index15 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">scriptCache.getEngine().getFactory(), scope);</code></div><div class="line number17 index16 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">return scriptContext;</code></div><div class="line number18 index17 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number19 index18 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">...</code></div><div class="line number20 index19 alt1"><code class="htmlscript plain">}</code></div></div></td></tr></tbody></table></div></div></div></span><p>Метод  <code>runScript()</code> (см. листинг 13) получает из кэша скомпилированный сценарий и вызывает метод <code>eval()</code>, передавая в качестве параметра контекст данного сценария. </p><h5 id="N102CF" class="ibm-h5">Листинг 13.
 Метод runScript() JSServlet </h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_117021" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">public class JSServlet extends HttpServlet {</code></div><div class="line number2 index1 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">...</code></div><div class="line number3 index2 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">protected void runScript(String uri, ScriptContext scriptContext)</code></div><div class="line number4 index3 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">throws ScriptException, IOException {</code></div><div class="line number5 index4 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">scriptCache.getScript(uri).eval(scriptContext);</code></div><div class="line number6 index5 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number7 index6 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">...</code></div><div class="line number8 index7 alt1"><code class="htmlscript plain">}</code></div></div></td></tr></tbody></table></div></div></div></span><h3 id="N102D4" class="ibm-h3">Управление запросами</h3><p>Чтобы исполнить сценарий, соответствующий URL из запроса HTTP, можно просто вызывать приведенный выше метод  <code>runScript()</code>. Однако в реальном приложении перед выполнением сценария, обычно нужно выполнить некоторую инициализацию, а после его выполнения — некоторые завершающие действия. </p><p>В одном и том же контексте можно последовательно выполнить несколько сценариев. Например, один сценарий может определять набор переменных и функций. Затем другой сценарий производит обработку, используя переменные и функции предыдущего сценария, который выполнялся в том же контексте. </p><p>Метод сервлета <code>handleRequest()</code> (показан в листинге 14) устанавливает заголовки HTTP, исполняет сценарий init.jss, удаляет путь контекста из URI запроса, исполняет сценарий с полученным URI, а затем исполняет другой сценарий с именем finalize.jss.  </p><h5 id="N102EA" class="ibm-h5">Листинг 14.
 Метод handleRequest() сервлета JSServlet </h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_467150" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">public class JSServlet extends HttpServlet {</code></div><div class="line number2 index1 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">...</code></div><div class="line number3 index2 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">protected void handleRequest(</code></div><div class="line number4 index3 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">HttpServletRequest request, HttpServletResponse response)</code></div><div class="line number5 index4 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">throws ServletException, IOException {</code></div><div class="line number6 index5 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">if (cacheControlHeader != null)</code></div><div class="line number7 index6 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">response.setHeader("Cache-Control", cacheControlHeader);</code></div><div class="line number8 index7 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">if (contentTypeHeader != null)</code></div><div class="line number9 index8 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">response.setContentType(contentTypeHeader);</code></div><div class="line number10 index9 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">ScriptContext scriptContext = createScriptContext(request, response);</code></div><div class="line number11 index10 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">try {</code></div><div class="line number12 index11 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">runScript("/init.jss", scriptContext);</code></div><div class="line number13 index12 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">String uri = request.getRequestURI();</code></div><div class="line number14 index13 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">uri = uri.substring(request.getContextPath().length());</code></div><div class="line number15 index14 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">try {</code></div><div class="line number16 index15 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">runScript(uri, scriptContext);</code></div><div class="line number17 index16 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">} catch (FileNotFoundException x) {</code></div><div class="line number18 index17 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">response.sendError(404, request.getRequestURI());</code></div><div class="line number19 index18 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number20 index19 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">runScript("/finalize.jss", scriptContext);</code></div><div class="line number21 index20 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">} catch (ScriptException x) {</code></div><div class="line number22 index21 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">x.printStackTrace(response.getWriter());</code></div><div class="line number23 index22 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">throw new ServletException(x);</code></div><div class="line number24 index23 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number25 index24 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number26 index25 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">...</code></div><div class="line number27 index26 alt2"><code class="htmlscript plain">}</code></div></div></td></tr></tbody></table></div></div></div></span><p>Методы  <code>doGet()</code> и <code>doPost()</code>  (см. листинг 15) сервлета <code>JSServlet</code> вызывают <code>handleRequest()</code>.</p><h5 id="N102FF" class="ibm-h5">Листинг 15.
 Методы doGet() и doPost() сервлета JSServlet</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_559334" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">public class JSServlet extends HttpServlet {</code></div><div class="line number2 index1 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">...</code></div><div class="line number3 index2 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">public void doGet(HttpServletRequest request, HttpServletResponse response)</code></div><div class="line number4 index3 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">throws ServletException, IOException {</code></div><div class="line number5 index4 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">handleRequest(request, response);</code></div><div class="line number6 index5 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">public void doPost(HttpServletRequest request, HttpServletResponse response)</code></div><div class="line number9 index8 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">throws ServletException, IOException {</code></div><div class="line number10 index9 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">handleRequest(request, response);</code></div><div class="line number11 index10 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="htmlscript plain">}</code></div></div></td></tr></tbody></table></div></div></div></span><h2 id="N10304" class="ibm-h2">Разработка сценариев на стороне сервера</h2><p>В этом разделе содержатся несколько примеров сценариев на стороне сервера, которые иллюстрируют, как можно получать параметры запроса, обращаться к свойствам компонентов JavaBean и генерировать ответы JSON. </p><h3 id="N1030C" class="ibm-h3">Предварительная обработка и пост-обработка</h3><p>В предыдущем разделе мы видели, что, прежде чем выполнить требуемый сценарий, <code>JSServlet</code> вызывает init.jss (показан в листинге 16). Если нужно измерить, как много времени требуется на выполнение сценариев, можно записать время запуска в переменную, как показано ниже.  </p><h5 id="N10319" class="ibm-h5">Листинг 16. 
Сценарий init.jss</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_96320" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">var debug = true;</code></div><div class="line number2 index1 alt1"><code class="htmlscript plain">var debugStartTime = java.lang.System.nanoTime();</code></div></div></td></tr></tbody></table></div></div></div></span><p>Затем время исполнения вычисляется в finalize.jss (см. листинг 17). Время распечатывается как комментарий JavaScript, так что <code>JSServlet</code> может генерировать правильные ответы JSON. </p><h5 id="N10325" class="ibm-h5">Листинг 17. 
Сценарий finalize.jss</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_616576" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">var debugEndTime = java.lang.System.nanoTime();</code></div><div class="line number2 index1 alt1"><code class="htmlscript plain">if (debug)</code></div><div class="line number3 index2 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">println("// Time: " + (debugEndTime - debugStartTime) + " ns");</code></div></div></td></tr></tbody></table></div></div></div></span><p>По ходу этих статей мы будем добавлять в сценарии init.jss и finalize.jss новый код. </p><h3 id="N1032C" class="ibm-h3">Получение параметров запроса</h3><p>Сценарии, запускаемые с помощью  <code>JSServlet</code>, могут обращаться к параметрам запроса с помощью методов <code>request.getParameter()</code> и <code>request.getParameterValues()</code>, которые возвращают объекты Java. Вы можете предпочесть более короткий синтаксис и работу с объектами JavaScript вместо строк и массивов Java. Это делается очень легко путем добавления в сценарий init.jss следующих строк (см. листинг 18).  </p><h5 id="N1033F" class="ibm-h5">Листинг 18. 
Получение параметров запроса в init.jss</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_931119" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">var param = new Object();</code></div><div class="line number2 index1 alt1"><code class="htmlscript plain">var paramValues = new Object();</code></div><div class="line number3 index2 alt2">&nbsp;</div><div class="line number4 index3 alt1"><code class="htmlscript plain">function initParams() {</code></div><div class="line number5 index4 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">var paramNames = request.getParameterNames();</code></div><div class="line number6 index5 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">while (paramNames.hasMoreElements()) {</code></div><div class="line number7 index6 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">var name = paramNames.nextElement();</code></div><div class="line number8 index7 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">param[name] = String(request.getParameter(name));</code></div><div class="line number9 index8 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">paramValues[name] = new Array();</code></div><div class="line number10 index9 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">var values = request.getParameterValues(name);</code></div><div class="line number11 index10 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">for (var i = 0; i &lt; values.length; i++)</code></div><div class="line number12 index11 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">paramValues[name][i] = String(values[i]);</code></div><div class="line number13 index12 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number14 index13 alt1"><code class="htmlscript plain">}</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="htmlscript plain">initParams();</code></div></div></td></tr></tbody></table></div></div></div></span><p>Допустим, вы обращаетесь к сценарию с именем ParamDemo.jss по URL, приведенному в листинге 19.   </p><h5 id="N10348" class="ibm-h5">Листинг 19.
 Пример URL для обращения к сценарию</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_551799" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">http://localhost:8080/jsee/ParamDemo.jss?firstName=John&amp;lastName=Smith</code></div></div></td></tr></tbody></table></div></div></div></span><p>В сценарии ParamDemo.jss (см. листинг 20) можно получить два параметра запроса с помощью  <code>param.firstName</code> и <code>param.lastName</code>.</p><h5 id="N10357" class="ibm-h5">Листинг 20.
 Пример ParamDemo.jss</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_247973" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">println("Hello " + param.firstName + " " + param.lastName);</code></div></div></td></tr></tbody></table></div></div></div></span><h3 id="N1035C" class="ibm-h3">Доступ к компонентам JavaBeans</h3><p>Компоненты Web-приложения <code>application</code>, <code>session</code> и <code>request</code> содержат экземпляры, которые можно извлечь и заменить методами  <code>getAttribute()</code> и <code>setAttribute()</code> соответственно  <code>ServletContext</code>,  <code>HttpSession</code> и <code>HttpServletRequest</code>. Можно воспользоваться также функциями <code>getBean()</code> и <code>setBean()</code> (см. листинг 21), которые нужно поместить в файл init.jss, чтобы их мог вызывать любой сценарий. Параметр <code>scope</code> должен представлять собой одну из следующих строк: </p><ul class="ibm-bullet-list"><li><code>"application"</code></li><li><code>"session"</code></li><li><code>"request"</code></li></ul><h5 id="N10391" class="ibm-h5">Листинг 21. 
Функции init.jss getBean() и setBean()</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_47985" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">function getBean(scope, id) {</code></div><div class="line number2 index1 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">return eval(scope).getAttribute(id);</code></div><div class="line number3 index2 alt2"><code class="htmlscript plain">}</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="htmlscript plain">function setBean(scope, id, bean) {</code></div><div class="line number6 index5 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">if (!bean)</code></div><div class="line number7 index6 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">bean = eval(id);</code></div><div class="line number8 index7 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">return eval(scope).setAttribute(id, bean);</code></div><div class="line number9 index8 alt2"><code class="htmlscript plain">}</code></div></div></td></tr></tbody></table></div></div></div></span><p>Теперь допустим, что вам нужно хранить экземпляр <code>DemoBean</code> (см. листинг 22) в поле действия сеанса <code>session</code>. </p><h5 id="N103A0" class="ibm-h5">Листинг 22. 
Пример DemoBean.java</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_650007" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">package jsee.demo;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="htmlscript plain">public class DemoBean {</code></div><div class="line number4 index3 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">private int counter;</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">public int getCounter() {</code></div><div class="line number7 index6 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">return counter;</code></div><div class="line number8 index7 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">public void setCounter(int counter) {</code></div><div class="line number11 index10 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">this.counter = counter;</code></div><div class="line number12 index11 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="htmlscript plain">}</code></div></div></td></tr></tbody></table></div></div></div></span><p>Сценарий BeanDemo.jss (показан в листинге 23) импортирует содержимое пакета JavaBean с помощью  <code>importPackage(Packages.jsee.demo)</code>. Затем он пытается получить экземпляр компонента из области <code>session</code> с помощью <code>getBean()</code>. Если компонент не найден, BeanDemo.jss создает объект и помещает его в область <code>session</code> с помощью  <code>setBean()</code>. Наконец, сценарий наращивает и распечатывает свойство счетчика <code>counter</code> компонента. </p><h5 id="N103BB" class="ibm-h5">Листинг 23. 
Пример BeanDemo.jss</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_66389" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">importPackage(Packages.jsee.demo);</code></div><div class="line number2 index1 alt1"><code class="htmlscript plain">var bean = getBean("session", "demo");</code></div><div class="line number3 index2 alt2"><code class="htmlscript plain">if (!bean) {</code></div><div class="line number4 index3 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">bean = new DemoBean();</code></div><div class="line number5 index4 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">setBean("session", "demo", bean);</code></div><div class="line number6 index5 alt1"><code class="htmlscript plain">}</code></div><div class="line number7 index6 alt2"><code class="htmlscript plain">bean.counter++;</code></div><div class="line number8 index7 alt1"><code class="htmlscript plain">println(bean.counter);</code></div></div></td></tr></tbody></table></div></div></div></span><p>При импорте пакета, который начинается с <code>java</code>, <code>javax</code>, <code>org</code>, <code>edu</code>, <code>com</code> или <code>net</code>, в <code>importPackage()</code> не нужно использовать префикс <code>Packages</code>. Можно также импортировать отдельные классы с помощью  <code>importClass()</code>.</p><h3 id="N103DD" class="ibm-h3">Возвращение ответа JSON</h3><p>В листинге 24 приведен пример, который генерирует ответ JSON, содержащий некоторые сведения о механизме JavaScript и URI сценария. В примере используется синтаксис JavaScript для создания объекта <code>json</code>, исходный код которого получен в форме <code>String</code> методом <code>toSource()</code>.  </p><h5 id="N103F0" class="ibm-h5">Листинг 24.
 Пример JsonDemo.jss</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_373460" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">var json = {</code></div><div class="line number2 index1 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">engine: { </code></div><div class="line number3 index2 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">name: String(factory.engineName),</code></div><div class="line number4 index3 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">version: String(factory.engineVersion),</code></div><div class="line number5 index4 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">threading: String(factory.getParameter("THREADING"))</code></div><div class="line number6 index5 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}, </code></div><div class="line number7 index6 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">language: { </code></div><div class="line number8 index7 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">name: String(factory.languageName),</code></div><div class="line number9 index8 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">version: String(factory.languageVersion)</code></div><div class="line number10 index9 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">},</code></div><div class="line number11 index10 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">script: {</code></div><div class="line number12 index11 alt1"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">uri: String(request.requestURI)</code></div><div class="line number13 index12 alt2"><code class="htmlscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="htmlscript plain">}</code></div><div class="line number14 index13 alt1"><code class="htmlscript plain">};</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="htmlscript plain">println(json.toSource());</code></div></div></td></tr></tbody></table></div></div></div></span><p>Чтобы обеспечить правильную работу  <code>toSource()</code>, все объекты Java, полученные из свойств  <code>factory</code> и <code>request</code> в этом примере, нужно преобразовать в объекты JavaScript.  Результат работы сценария приведен в листинге 25: </p><h5 id="N10402" class="ibm-h5">Листинг 25. 
Выход JsonDemo.jss</h5><span class="dw-code-nohighlight"><div class="ibm-syntax-container"><div><div id="highlighter_129241" class="syntaxhighlighter  htmlscript"><table border="0" cellpadding="0" cellspacing="0" role="none"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="htmlscript plain">({language:{name:"ECMAScript", version:"1.6"}, </code></div><div class="line number2 index1 alt1"><code class="htmlscript plain">engine:{name:"Mozilla Rhino", threading:"MULTITHREADED", </code></div><div class="line number3 index2 alt2"><code class="htmlscript plain">version:"1.6 release 2"}, script:{uri:"/jsee/JsonDemo.jss"}})</code></div></div></td></tr></tbody></table></div></div></div></span><h2 id="N10407" class="ibm-h2">Заключение</h2><p>Из этой статьи вы узнали, как компилировать и исполнять файлы JavaScript  с помощью API  <code>javax.script</code>. Вы также научились создавать кэш LRU на базе  <code>java.util.LinkedHashMap</code>, экспортировать объекты Java как переменные сценария, обеспечивать отображение URL на сценарий и создавать файлы JavaScript, выполняемые на стороне сервера. В следующей части этой серии мы научимся обращаться к удаленным функциям JavaScript с помощью Ajax.  </p><!--CMA ID: 498259--><!--Site ID: 40--><!--XSLT stylesheet used to transform this file:
        dw-document-html-8.0.xsl-->
                                        <!-- Article Quiz -->
                                        
                                        <!-- Article Resources -->
                                        <div class="ibm-alternate-rule"><hr></div><h4 id="artdownload" class="ibm-h4">Ресурсы для скачивания</h4><ul class="ibm-link-list"><li><a class="ibm-document-link" href="https://www.ibm.com/developerworks/ru/library/wa-aj-javaee/wa-aj-javaee-pdf.pdf">этот контент в PDF</a></li><li><a class="ibm-download-link" href="http://www.ibm.com/developerworks/apps/download/index.jsp?contentid=498259&amp;filename=jsee_part1_src.zip&amp;method=http&amp;locale=ru_RU">Пример приложения для этой статьи</a> (jsee_part1_src.zip | 25 КБ)</li></ul><div class="ibm-alternate-rule"><hr></div><h4 id="artrelatedtopics" class="ibm-h4">Похожие темы</h4><ul><li><a href="http://www.ibm.com/developerworks/java/library/wa-aj-javaee/index.html?S_TACT=105AGX99&amp;S_CMP=CP">Оригинал статьи</a> (EN).</li><li><a href="http://jcp.org/en/jsr/detail?id=223">JSR-223 Scripting for the Java Platform</a>— спецификация со всеми подробностями по использованию языков сценариев в Java-приложениях. </li><li><a href="http://java.sun.com/javase/6/docs/technotes/guides/scripting/programmer_guide/index.html"> Java Scripting Programmer's Guide</a>— описание Java Scripting API с примерами кода. </li><li><a href="http://java.sun.com/javase/6/docs/api/javax/script/package-summary.html">javax.script</a>— полный набор классов и интерфейсов Java Scripting API. </li><li><a href="http://www.ibm.com/developerworks/ajax/?S_TACT=105AGX99&amp;S_CMP=CP">Центр ресурсов по Ajax</a> developerWorks с растущей библиотекой материалов по Ajax, а также полезные ресурсы для тех, кто только приступает к разработке Ajax-приложений. </li><li><a href="http://www.mozilla.org/rhino/">Mozilla Rhino</a>— механизм JavaScript вместе с <a href="http://java.sun.com/javase/downloads/index.jsp">Java SE Development Kit (JDK) 6</a>. </li></ul>
                                        <!-- Commenting -->
<!-- INLINE_COMMENTS_BEGIN: -->
<div class="ibm-alternate-rule"><hr></div>
<div id="dw-article-cmts-top" class="ibm-columns">
    <div class="ibm-col-6-2">
        <h4 id="icomments" class="ibm-h4">Комментарии</h4>
        <div id="dw-article-cmts-login">
            <p><a onclick="window.location=userLinks[0].url;" tabindex="0" role="link">Войдите</a> или 
                <a onclick="window.location=userLinks[1].url;" tabindex="0" role="link">зарегистрируйтесь</a> для того чтобы оставлять комментарии или подписаться на них.</p>
        </div>
    </div>    
    <div class="ibm-col-6-2" id="dw-notify"> 
        <input type="checkbox" value="1" name="comment_notification" id="comment_notification" disabled="">
        <label for="comment_notification" style="color: rgb(204, 204, 204);">Подпишите меня на уведомления к комментариям</label>	   
    </div>
</div>

<div class="dw-article-cmts-container">       
    <div class="ibm-no-print jquery-comments read-only" id="dw-icomments-container"><div class="commenting-field main"><img src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/user-icon.png" alt="" class="profile-picture round by-current-user"><div class="textarea-wrapper"><span class="close" style="display: none;"><span class="left"></span><span class="right"></span></span><div class="textarea" data-placeholder="Добавить комментарий" contenteditable="true" style="height: 3.65em;"></div><div class="control-row" style="display: none;"><span class="send save highlight-background">Отправить</span></div></div></div><ul class="navigation"><div class="navigation-wrapper"><li data-sort-key="newest" data-container-name="comments" class="active">Новейший</li><li data-sort-key="oldest" data-container-name="comments">Старейший</li><li data-sort-key="popularity" data-container-name="comments">Популярный</li></div><div class="navigation-wrapper responsive"><li class="title active"><header>Новейший</header></li><ul class="dropdown"><li data-sort-key="newest" data-container-name="comments" class="active">Новейший</li><li data-sort-key="oldest" data-container-name="comments">Старейший</li><li data-sort-key="popularity" data-container-name="comments">Популярный</li></ul></div></ul><div class="data-container" data-container="comments"><ul id="comment-list" class="main"></ul><div class="no-comments no-data"><i class="fa fa-comments fa-2x"></i><br>Нет комментариев</div></div></div>
</div>
<!-- INLINE_COMMENTS_END -->                                        <!-- CENTER_6_4_CONTENT_COLUMN_END -->
                                    </div>   
                                </div>
                        <!--Rating_Meta_BEGIN--><div class="metavalue">static.content.url=http://www.ibm.com/developerworks/js/artrating/</div><div class="metavalue">SITE_ID=40</div><div class="metavalue">Zone=Web-архитектура, Технология Java</div><div class="metavalue">ArticleID=498259</div><div class="metavalue">ArticleTitle=JavaScript EE: Часть 1. Исполнение файлов JavaScript на стороне сервера</div><div class="metavalue">publish-date=06282010</div><script language="javascript" type="text/javascript">document.write('<div class="metavalue">url='+location.href.replace(/</g,  '%3C')+'</div>');</script><div class="metavalue">url=https://www.ibm.com/developerworks/ru/library/wa-aj-javaee/</div><!--Rating_Meta_END-->
                    </div>
                    <!-- END_IBM-CONTENT-MAIN -->
                </div>
                <!-- END_IBM-CONTENT-BODY -->
            </div>
            <!-- END_IBM-CONTENT -->
        </div>
        <!-- END_IBM-PCON -->
    </main>
    <!-- MAIN_CONTENT_END -->
    
    <!-- END_CONTENT-WRAPPER -->	
</div>
<!-- FOOTER_BEGIN -->
<footer role="contentinfo" aria-label="IBM developerWorks">
    <div id="dw-footer-module" class="dw-footer-home">
        <section aria-label="Ресурсы" role="contentinfo">
            <div class="ibm-columns">
                <div class="ibm-col-6-1 dw-footer-col-1">
                    <ul>
                        <li class="dw-footer-heading" aria-label="developerWorks">developerWorks</li>
                        <li><a href="https://www.ibm.com/developerworks/secure/feedback.jsp?domain=dwrussia">Помощь</a></li>
                        <li class="dw-footer-newline"><a href="https://www.ibm.com/developerworks/community/report?lang=ru">Сообщить о нарушениях</a></li>
                        <li class="dw-footer-newline"><a href="https://www.ibm.com/developerworks/ru/community/terms/thirdparty/">Уведомить сторонние ресурсы</a></li>
                    </ul>
                </div>
                <div class="ibm-col-6-1 dw-footer-col-2">
                    <ul class="dw-footer-lang" aria-label="Выбрать язык">
                        <li class="dw-footer-heading">Выбрать язык</li>
                        <li><a href="https://www.ibm.com/developerworks/">English</a></li>
                        <li><a href="https://www.ibm.com/developerworks/cn/" lang="zh">中文</a></li>
                        <li><a href="https://www.ibm.com/developerworks/jp/" lang="ja">日本語</a></li>
                        <li><a href="https://www.ibm.com/developerworks/ru/" lang="ru">Русский</a></li>
                        <li class="dw-footer-newline"><a href="https://www.ibm.com/developerworks/br/" lang="pt">Português (Brasil)</a></li>
                        <li><a href="https://www.ibm.com/developerworks/ssa/" lang="es">Español</a></li>
                        <li><a href="https://developer.ibm.com/kr/" lang="kr">한글</a></li>
                    </ul>
                </div>
                <div class="ibm-col-6-1 dw-footer-col-3"> </div>
                <div class="ibm-col-6-1 dw-footer-col-4">
                    <ul class="dw-footer-categories">
                        <li class="dw-footer-category">
                            <a href="https://www.ibm.com/developerworks/ru/rss/">Ленты</a>  
                        </li>
                        <li class="dw-footer-category">
                            <a href="https://www.ibm.com/developerworks/ru/doc/">Библиотека документов</a>  
                        </li>
                    </ul>
                </div>
                <div class="ibm-col-6-1 dw-footer-col-5">
                    <ul class="dw-footer-categories">
                        <li class="dw-footer-category">
                            <a href="https://www.ibm.com/developerworks/newsletter/">Рассылка (Английский)</a>  
                        </li>
                    </ul>
                </div>
                <div class="ibm-col-6-1 dw-footer-col-6">
                    <ul class="dw-footer-categories">
                        <li class="dw-footer-category">
                            <a href="https://www.ibm.com/developerworks/ru/downloads/">Пробное ПО</a>  
                        </li>
                    </ul>
                </div>
            </div>
        </section>
    </div>
    <div id="dw-footer" class="ibm-padding-normal ibm-alternate">
        <div class="ibm-columns">
            <div class="ibm-col-1-1">
                <div class="dw-footer-corporate-links">
                    <ul>
                        <li><a href="https://www.ibm.com/contact/ru/ru/">Контактная информация</a></li>
                        <li><a href="https://www.ibm.com/privacy/ru/ru/">Конфиденциальность</a></li>
                        <li><a href="https://www.ibm.com/developerworks/community/terms?lang=ru">Условия использования</a></li>
                        <li><a href="https://www.ibm.com/accessibility/ru/ru/">Специальные возможности</a></li>
                        <li class="ibm-feedbacklink"><a href="https://www.ibm.com/developerworks/ru/library/wa-aj-javaee/#">Комментарии</a></li>
                        <li id="ibm-truste-cp"><a onclick="truste.eu.clickListener();return false;" href="https://www.ibm.com/developerworks/ru/library/wa-aj-javaee/#">Настройки файлов cookie</a></li>
                    </ul>                 
                </div>
                <div id="ibm-footer-locale-selector"><h3 class="ibm-bold">Выберите страну/регион</h3><select class="ibm-fullwidth select2-hidden-accessible ibm-widget-processed" aria-label="Select a country/region" tabindex="-1" aria-hidden="true" style="width: 401px;"><optgroup label="Страницы ibm.com для разных стран"><option data-localecode="ru-ru" value="http://www.ibm.com/ru-ru/?lnk=fcc">Russian Federation - Russian</option><option data-localecode="en-af" value="http://www.ibm.com/af-en/?lnk=fcc">Afghanistan - English</option><option data-localecode="fr-dz" value="http://www.ibm.com/dz-fr/?lnk=fcc">Algeria - French</option><option data-localecode="pt-ao" value="http://www.ibm.com/ao-pt/?lnk=fcc">Angola - Portuguese</option><option data-localecode="en-ai" value="http://www.ibm.com/ai-en/?lnk=fcc">Anguilla - English</option><option data-localecode="en-ag" value="http://www.ibm.com/ag-en/?lnk=fcc">Antigua and Barbuda - English</option><option data-localecode="es-ar" value="http://www.ibm.com/ar-es/?lnk=fcc">Argentina - Spanish</option><option data-localecode="en-aw" value="http://www.ibm.com/aw-en/?lnk=fcc">Aruba - English</option><option data-localecode="en-au" value="http://www.ibm.com/au-en/?lnk=fcc">Australia - English</option><option data-localecode="de-at" value="http://www.ibm.com/at-de/?lnk=fcc">Austria - German</option><option data-localecode="en-bs" value="http://www.ibm.com/bs-en/?lnk=fcc">Bahamas - English</option><option data-localecode="en-bh" value="http://www.ibm.com/bh-en/?lnk=fcc">Bahrain - English</option><option data-localecode="en-bd" value="http://www.ibm.com/bd-en/?lnk=fcc">Bangladesh - English</option><option data-localecode="en-bb" value="http://www.ibm.com/bb-en/?lnk=fcc">Barbados - English</option><option data-localecode="nl-be" value="http://www.ibm.com/be-nl/?lnk=fcc">Belgium/Luxembourg - Dutch</option><option data-localecode="en-be" value="http://www.ibm.com/be-en/?lnk=fcc">Belgium/Luxembourg - English</option><option data-localecode="fr-be" value="http://www.ibm.com/be-fr/?lnk=fcc">Belgium/Luxembourg - French</option><option data-localecode="en-bm" value="http://www.ibm.com/bm-en/?lnk=fcc">Bermuda - English</option><option data-localecode="es-bo" value="http://www.ibm.com/bo-es/?lnk=fcc">Bolivia - Spanish</option><option data-localecode="en-bw" value="http://www.ibm.com/bw-en/?lnk=fcc">Botswana - English</option><option data-localecode="pt-br" value="http://www.ibm.com/br-pt/?lnk=fcc">Brazil - Portuguese</option><option data-localecode="en-bn" value="http://www.ibm.com/bn-en/?lnk=fcc">Brunei Darussalam - English</option><option data-localecode="bg-bg" value="http://www.ibm.com/bg-bg/?lnk=fcc">Bulgaria - Bulgarian</option><option data-localecode="fr-bf" value="http://www.ibm.com/bf-fr/?lnk=fcc">Burkina Faso - French</option><option data-localecode="en-kh" value="http://www.ibm.com/kh-en/?lnk=fcc">Cambodia - English</option><option data-localecode="en-cm" value="http://www.ibm.com/cm-en/?lnk=fcc">Cameroon - English</option><option data-localecode="fr-cm" value="http://www.ibm.com/cm-fr/?lnk=fcc">Cameroon - French</option><option data-localecode="en-ca" value="http://www.ibm.com/ca-en/?lnk=fcc">Canada - English</option><option data-localecode="fr-ca" value="http://www.ibm.com/ca-fr/?lnk=fcc">Canada - French</option><option data-localecode="en-ky" value="http://www.ibm.com/ky-en/?lnk=fcc">Cayman Islands - English</option><option data-localecode="fr-td" value="http://www.ibm.com/td-fr/?lnk=fcc">Chad - French</option><option data-localecode="es-cl" value="http://www.ibm.com/cl-es/?lnk=fcc">Chile - Spanish</option><option data-localecode="zh-cn" value="http://www.ibm.com/cn-zh/?lnk=fcc">China - Chinese (Simplified)</option><option data-localecode="es-co" value="http://www.ibm.com/co-es/?lnk=fcc">Colombia - Spanish</option><option data-localecode="fr-cg" value="http://www.ibm.com/cg-fr/?lnk=fcc">Congo - French</option><option data-localecode="fr-cd" value="http://www.ibm.com/cd-fr/?lnk=fcc">Congo, The Democratic Republic of the - French</option><option data-localecode="es-cr" value="http://www.ibm.com/cr-es/?lnk=fcc">Costa Rica - Spanish</option><option data-localecode="hr-hr" value="http://www.ibm.com/hr-hr/?lnk=fcc">Croatia - Croatian</option><option data-localecode="en-cw" value="http://www.ibm.com/cw-en/?lnk=fcc">Curacao - English</option><option data-localecode="en-cy" value="http://www.ibm.com/cy-en/?lnk=fcc">Cyprus - English</option><option data-localecode="cs-cz" value="http://www.ibm.com/cz-cs/?lnk=fcc">Czech Republic - Czech</option><option data-localecode="da-dk" value="http://www.ibm.com/dk-da/?lnk=fcc">Denmark - Danish</option><option data-localecode="en-dm" value="http://www.ibm.com/dm-en/?lnk=fcc">Dominica - English</option><option data-localecode="es-ec" value="http://www.ibm.com/ec-es/?lnk=fcc">Ecuador - Spanish</option><option data-localecode="en-eg" value="http://www.ibm.com/eg-en/?lnk=fcc">Egypt - English</option><option data-localecode="et-ee" value="http://www.ibm.com/ee-et/?lnk=fcc">Estonia - Estonian</option><option data-localecode="en-et" value="http://www.ibm.com/et-en/?lnk=fcc">Ethiopia - English</option><option data-localecode="fi-fi" value="http://www.ibm.com/fi-fi/?lnk=fcc">Finland - Finnish</option><option data-localecode="fr-fr" value="http://www.ibm.com/fr-fr/?lnk=fcc">France - French</option><option data-localecode="fr-ga" value="http://www.ibm.com/ga-fr/?lnk=fcc">Gabon - French</option><option data-localecode="de-de" value="http://www.ibm.com/de-de/?lnk=fcc">Germany - German</option><option data-localecode="en-gh" value="http://www.ibm.com/gh-en/?lnk=fcc">Ghana - English</option><option data-localecode="el-gr" value="http://www.ibm.com/gr-el/?lnk=fcc">Greece - Greek</option><option data-localecode="en-gd" value="http://www.ibm.com/gd-en/?lnk=fcc">Grenada - English</option><option data-localecode="en-gy" value="http://www.ibm.com/gy-en/?lnk=fcc">Guyana - English</option><option data-localecode="en-hk" value="http://www.ibm.com/hk-en/?lnk=fcc">Hong Kong S.A.R. of China - English</option><option data-localecode="hu-hu" value="http://www.ibm.com/hu-hu/?lnk=fcc">Hungary - Hungarian</option><option data-localecode="en-in" value="http://www.ibm.com/in-en/?lnk=fcc">India - English</option><option data-localecode="en-id" value="http://www.ibm.com/id-en/?lnk=fcc">Indonesia - English</option><option data-localecode="en-iq" value="http://www.ibm.com/iq-en/?lnk=fcc">Iraq - English</option><option data-localecode="en-ie" value="http://www.ibm.com/ie-en/?lnk=fcc">Ireland - English</option><option data-localecode="he-il" value="http://www.ibm.com/il-he/?lnk=fcc">Israel - Hebrew</option><option data-localecode="it-it" value="http://www.ibm.com/it-it/?lnk=fcc">Italy - Italian</option><option data-localecode="fr-ci" value="http://www.ibm.com/ci-fr/?lnk=fcc">Ivory Coast - French</option><option data-localecode="en-jm" value="http://www.ibm.com/jm-en/?lnk=fcc">Jamaica - English</option><option data-localecode="ja-jp" value="http://www.ibm.com/jp-ja/?lnk=fcc">Japan - Japanese</option><option data-localecode="en-jo" value="http://www.ibm.com/jo-en/?lnk=fcc">Jordan - English</option><option data-localecode="kk-kz" value="http://www.ibm.com/kz-kk/?lnk=fcc">Kazakhstan - Kazakh</option><option data-localecode="en-ke" value="http://www.ibm.com/ke-en/?lnk=fcc">Kenya - English</option><option data-localecode="ko-kr" value="http://www.ibm.com/kr-ko/?lnk=fcc">Korea, Republic of - Korean</option><option data-localecode="en-kw" value="http://www.ibm.com/kw-en/?lnk=fcc">Kuwait - English</option><option data-localecode="lv-lv" value="http://www.ibm.com/lv-lv/?lnk=fcc">Latvia - Latvian</option><option data-localecode="en-lb" value="http://www.ibm.com/lb-en/?lnk=fcc">Lebanon - English</option><option data-localecode="en-ly" value="http://www.ibm.com/ly-en/?lnk=fcc">Libya - English</option><option data-localecode="lt-lt" value="http://www.ibm.com/lt-lt/?lnk=fcc">Lithuania - Lithuanian</option><option data-localecode="fr-mg" value="http://www.ibm.com/mg-fr/?lnk=fcc">Madagascar - French</option><option data-localecode="en-mw" value="http://www.ibm.com/mw-en/?lnk=fcc">Malawi - English</option><option data-localecode="en-my" value="http://www.ibm.com/my-en/?lnk=fcc">Malaysia - English</option><option data-localecode="en-mu" value="http://www.ibm.com/mu-en/?lnk=fcc">Mauritius - English</option><option data-localecode="fr-mu" value="http://www.ibm.com/mu-fr/?lnk=fcc">Mauritius - French</option><option data-localecode="es-mx" value="http://www.ibm.com/mx-es/?lnk=fcc">Mexico - Spanish</option><option data-localecode="en-ms" value="http://www.ibm.com/ms-en/?lnk=fcc">Montserrat - English</option><option data-localecode="fr-ma" value="http://www.ibm.com/ma-fr/?lnk=fcc">Morocco - French</option><option data-localecode="pt-mz" value="http://www.ibm.com/mz-pt/?lnk=fcc">Mozambique - Portuguese</option><option data-localecode="en-na" value="http://www.ibm.com/na-en/?lnk=fcc">Namibia - English</option><option data-localecode="en-np" value="http://www.ibm.com/np-en/?lnk=fcc">Nepal - English</option><option data-localecode="nl-nl" value="http://www.ibm.com/nl-nl/?lnk=fcc">Netherlands - Dutch</option><option data-localecode="en-nz" value="http://www.ibm.com/nz-en/?lnk=fcc">New Zealand - English</option><option data-localecode="fr-ne" value="http://www.ibm.com/ne-fr/?lnk=fcc">Niger - French</option><option data-localecode="en-ng" value="http://www.ibm.com/ng-en/?lnk=fcc">Nigeria - English</option><option data-localecode="no-no" value="http://www.ibm.com/no-no/?lnk=fcc">Norway - Norwegian</option><option data-localecode="en-om" value="http://www.ibm.com/om-en/?lnk=fcc">Oman - English</option><option data-localecode="en-pk" value="http://www.ibm.com/pk-en/?lnk=fcc">Pakistan - English</option><option data-localecode="es-py" value="http://www.ibm.com/py-es/?lnk=fcc">Paraguay - Spanish</option><option data-localecode="es-pe" value="http://www.ibm.com/pe-es/?lnk=fcc">Peru - Spanish</option><option data-localecode="en-ph" value="http://www.ibm.com/ph-en/?lnk=fcc">Philippines - English</option><option data-localecode="pl-pl" value="http://www.ibm.com/pl-pl/?lnk=fcc">Poland - Polish</option><option data-localecode="pt-pt" value="http://www.ibm.com/pt-pt/?lnk=fcc">Portugal - Portuguese</option><option data-localecode="en-qa" value="http://www.ibm.com/qa-en/?lnk=fcc">Qatar - English</option><option data-localecode="ro-ro" value="http://www.ibm.com/ro-ro/?lnk=fcc">Romania - Romanian</option><option data-localecode="en-kn" value="http://www.ibm.com/kn-en/?lnk=fcc">Saint Kitts and Nevis - English</option><option data-localecode="en-lc" value="http://www.ibm.com/lc-en/?lnk=fcc">Saint Lucia - English</option><option data-localecode="en-vc" value="http://www.ibm.com/vc-en/?lnk=fcc">Saint Vincent and the Grenadines - English</option><option data-localecode="en-sa" value="http://www.ibm.com/sa-en/?lnk=fcc">Saudi Arabia - English</option><option data-localecode="fr-sn" value="http://www.ibm.com/sn-fr/?lnk=fcc">Senegal - French</option><option data-localecode="sr-rs" value="http://www.ibm.com/rs-sr/?lnk=fcc">Serbia - Serbian</option><option data-localecode="fr-sc" value="http://www.ibm.com/sc-fr/?lnk=fcc">Seychelles - French</option><option data-localecode="en-sl" value="http://www.ibm.com/sl-en/?lnk=fcc">Sierra Leone - English</option><option data-localecode="en-sg" value="http://www.ibm.com/sg-en/?lnk=fcc">Singapore - English</option><option data-localecode="sk-sk" value="http://www.ibm.com/sk-sk/?lnk=fcc">Slovakia - Slovak</option><option data-localecode="sl-si" value="http://www.ibm.com/si-sl/?lnk=fcc">Slovenia - Slovenian</option><option data-localecode="en-za" value="http://www.ibm.com/za-en/?lnk=fcc">South Africa - English</option><option data-localecode="es-es" value="http://www.ibm.com/es-es/?lnk=fcc">Spain - Spanish</option><option data-localecode="en-lk" value="http://www.ibm.com/lk-en/?lnk=fcc">Sri Lanka - English</option><option data-localecode="en-sr" value="http://www.ibm.com/sr-en/?lnk=fcc">Suriname - English</option><option data-localecode="sv-se" value="http://www.ibm.com/se-sv/?lnk=fcc">Sweden - Swedish</option><option data-localecode="fr-ch" value="http://www.ibm.com/ch-fr/?lnk=fcc">Switzerland - French</option><option data-localecode="de-ch" value="http://www.ibm.com/ch-de/?lnk=fcc">Switzerland - German</option><option data-localecode="zh-tw" value="http://www.ibm.com/tw-zh/?lnk=fcc">Taiwan - Chinese (Traditional)</option><option data-localecode="en-tz" value="http://www.ibm.com/tz-en/?lnk=fcc">Tanzania, United Republic of - English</option><option data-localecode="en-th" value="http://www.ibm.com/th-en/?lnk=fcc">Thailand - English</option><option data-localecode="en-tt" value="http://www.ibm.com/tt-en/?lnk=fcc">Trinidad and Tobago - English</option><option data-localecode="fr-tn" value="http://www.ibm.com/tn-fr/?lnk=fcc">Tunisia - French</option><option data-localecode="tr-tr" value="http://www.ibm.com/tr-tr/?lnk=fcc">Turkey - Turkish</option><option data-localecode="en-tc" value="http://www.ibm.com/tc-en/?lnk=fcc">Turks and Caicos Islands - English</option><option data-localecode="en-ug" value="http://www.ibm.com/ug-en/?lnk=fcc">Uganda - English</option><option data-localecode="uk-ua" value="http://www.ibm.com/ua-uk/?lnk=fcc">Ukraine - Ukrainian</option><option data-localecode="en-ae" value="http://www.ibm.com/ae-en/?lnk=fcc">United Arab Emirates - English</option><option data-localecode="en-uk" value="http://www.ibm.com/uk-en/?lnk=fcc">United Kingdom - English</option><option data-localecode="en-us" value="http://www.ibm.com/us-en/?lnk=fcc">United States - English</option><option data-localecode="es-uy" value="http://www.ibm.com/uy-es/?lnk=fcc">Uruguay - Spanish</option><option data-localecode="uz-uz" value="http://www.ibm.com/uz-uz/?lnk=fcc">Uzbekistan - Uzbek</option><option data-localecode="es-ve" value="http://www.ibm.com/ve-es/?lnk=fcc">Venezuela - Spanish</option><option data-localecode="en-vn" value="http://www.ibm.com/vn-en/?lnk=fcc">Vietnam - English</option><option data-localecode="vi-vn" value="http://www.ibm.com/vn-vi/?lnk=fcc">Vietnam - Vietnamese</option><option data-localecode="en-vg" value="http://www.ibm.com/vg-en/?lnk=fcc">Virgin Islands, British - English</option><option data-localecode="en-ye" value="http://www.ibm.com/ye-en/?lnk=fcc">Yemen - English</option><option data-localecode="en-zm" value="http://www.ibm.com/zm-en/?lnk=fcc">Zambia - English</option><option data-localecode="en-zw" value="http://www.ibm.com/zw-en/?lnk=fcc">Zimbabwe - English</option></optgroup></select><span class="select2 select2-container select2-container--default" dir="ltr" style="width: 100%;"><span class="selection"><span class="select2-selection select2-selection--single" role="combobox" aria-haspopup="true" aria-expanded="false" tabindex="0" aria-labelledby="select2-t8g2-container"><span class="select2-selection__rendered" id="select2-t8g2-container" title="Russian Federation - Russian">Russian Federation - Russian</span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span></span></span><span class="dropdown-wrapper" aria-hidden="true"></span></span></div>
            </div>
        </div>
    </div>        
</footer> <!-- FOOTER_END -->

<!-- END_IBM-TOP -->
</div>

<!-- SCRIPTS_INCLUDE_BEGIN -->
<!-- Styles -->
<link rel="stylesheet" type="text/css" href="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/jquery-comments.css">
<link rel="stylesheet" href="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/font-awesome.min.css">

<!-- Libraries -->
<script type="text/javascript" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/jquery-comments.min.js"></script>
<script type="text/javascript" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/moment-with-locales.js"></script>
<script type="text/javascript" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/ContentComments.js"></script>
<script type="text/javascript" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/ContentCommentsFormatter.js"></script>
<script type="text/javascript" language="JavaScript">

	IBMCore.common.module.masthead.subscribe("ready", "customjs", setupCommentsPlugin).runAsap(setupCommentsPlugin);

	function setupCommentsPlugin(){
		//debugger;
			//alert(userLinks);
			var commentsInitInfo = {
				contentId : $("div[class=metavalue]:contains('ArticleID=')").text().split("=")[1],
				siteId :  $("div[class=metavalue]:contains('SITE_ID=')").text().split("=")[1],
				pluginDivId : '#dw-icomments-container',
				notifyElementId : "#comment_notification",
				loginMessageDivId : "#dw-article-cmts-login",
				totalCommentsDivId : "#nCmts",
						isIdea:false

			};				
								
			ContentComments.Setup(commentsInitInfo);
	}
</script>

<!-- SCRIPTS_INCLUDE_END -->



<div id="ibm-overlay-backdrop"></div><div id="ibm-mobilemenu-screen"></div><div id="teconsent" class="truste_cookie_prefs" style="position: fixed; display: none; height: 40px; background-color: #ffffff; z-index: 9999999999; bottom: 0; right: 0; margin: 0; padding: 0 16px; line-height: 40px; vertical-align: middle; box-shadow:0 0 10px 3px rgba(0,0,0,.1)"><script type="text/javascript" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/notice"></script></div><iframe id="LOTCCFrameSat Jun 16 2018 20:41:42 GMT+0300 (RTZ 2 (зима))" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/rt=ifr.html" title="empty" tabindex="-1" role="presentation" style="border: 0px; width: 0px; height: 0px; display: block;"></iframe><script src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/js(1)" id="mm_pp_background"></script><iframe src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/iframe.html" id="mm_batch_supply_background" style="visibility: hidden; display: none;"></iframe><iframe src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/iframe(1).html" id="mm_sync_back_ground" style="visibility: hidden; display: none;"></iframe><iframe name="_hjRemoteVarsFrame" title="_hjRemoteVarsFrame" id="_hjRemoteVarsFrame" style="display: none !important; width: 1px !important; height: 1px !important; opacity: 0 !important; pointer-events: none !important;" src="./JavaScript EE_ Часть 1. Исполнение файлов JavaScript на стороне сервера_files/rcj-99d43ead6bdf30da8ed5ffcb4f17100c.html"></iframe><div id="ads"></div></body></html>