TEMPLATE

[comments]
descr= Общие секции HRLHEP. 
author=Семашко
[end]

[description]
[end]

[parameters]
title=HR LHEP
request_name=User:test
LOG=ON
[end]
[criteria]
where lab_id = 100000
and sotr.FIO like '#fio#%'  ??fio
and sotr.history_cont like '#history_contract#%' ??history_contract
and sotr.subTopParent_name like '#otdel#%' ??otdel
and sotr.TopParent_name like '#otdelenie#%' ??otdelenie
and sotr.division like '#division#%' ??division
and sotr.tab_n like '#tab_n#%'  ??tab_n
and sotr.post like '#post#'  ??post
and sotr.category like '#category#'  ??category
and sotr.stepen like '#stepen#'  ??stepen
and sotr.grazhdan like '#grazhdan#'  ??grazhdan
and sotr.nachalo_rab like '#calendar#'  ??calendar
and sotr.okonch_rab like '#calendarik#'  ??calendarik
and sotr.sovmeshenie like '#sovmeshenie#'  ??sovmeshenie
and sotr.shtat like '%дирекции%'  ??shtat_direct
and ((YEAR(CURRENT_DATE)-YEAR(sotr.dr))-(DATE_FORMAT(CURRENT_DATE, '%m%d') < DATE_FORMAT(sotr.dr, '%m%d'))) >= '#ot#' ??ot
and ((YEAR(CURRENT_DATE)-YEAR(sotr.dr))-(DATE_FORMAT(CURRENT_DATE, '%m%d') < DATE_FORMAT(sotr.dr, '%m%d'))) <= '#do#' ??do
[end]

[personal filters]
    $GET_DATA utils.cfg[dropdowns]
    <tr>
        <td class="label nowrap" nowrap>
            ФИО:
        </td><td> 
            <input type="text" size=45 name="fio" value="#fio#">
        </td>
    </tr><tr>
        <td class="label nowrap" nowrap>
            Табельный номер:</td><td>
            <input size=15 name="tab_n">
        </td>
     </tr><tr>
        <td class="label nowrap" nowrap>
            Ученая степень: 
        </td><td>
            <select name="stepen" class=norm>
                <option value="">любая</option>
                #STEPEN#
        <option value="">Кандидат наук</option> ??
        <option value="">Доктор наук</option> ??
            </select>
        </td>
    </tr><tr> 
        <td class="label nowrap" nowrap> 
            Отделение:
        </td><td> 
            <select name=otdelenie id=otdelenie_select class=norm onchange="otdelenie_change();"> 
                <option value="">любое</option> 
                #OTDELENIE# 
            </select> 
        </td>
    </tr><tr>
        <td class="label nowrap" nowrap> 
            Отдел:
        </td><td id=otdel_select> 
            $CALL_SERVICE c=fill_otdel
        </td>
    </tr><tr>
        <td class="label nowrap" nowrap>
            Возраст: </td>
        <td>
            от: <input type="text" name="ot" size=5 value="#ot#"> по: <input type="text" name="do" size=5 value="#do#">
        </td>
    </tr><tr>
        <td class="label nowrap" nowrap>
            Категория: 
        </td><td>
           <select name="category" class=norm>
            <option value="">все</option>
            #CATEGORIES#
            </select>
        </td>
    </tr><tr>
        <td class="label nowrap" nowrap>
            Должность1: 
        </td><td>
            <select name="post" class=norm>
            <option value="">любая</option>
            #POST#
    </tr><tr>
        <td class="label nowrap" nowrap>
            Начало работы:
        </td><td> 
            <input type="date" name="calendar">
            Окончание работы: <input type="date" name="calendarik">
        </td> 
    </tr> <tr>
        <td class="label nowrap" nowrap>
            Гражданство:
        </td><td>
        <select name="grazhdan" class=norm>
            <option value="">любое</option>
            #GRAZHDAN#
        </select>
    </td><td class="label nowrap" nowrap>Штат:</td><td>
        <p><input type="radio" name="shtat_direct" value="">Все</p></td><td>
        <p><input type="radio" name="shtat_direct" value="shtat_direct">Штат дирекции</p></td><td>
        <p><input type="radio" name="shtat_direct" value="">Кроме штата дирекции</p>
    </td>

[end]
[dropdowns]
    select distinct concat('<option value="', post, '" '
    , case when post='#post#' then 'selected' else '' end
    , '>' , post, '</option>') as POST
    from sotrudniki
    where lab_id = 100000
    order by post
    ; 
    select distinct concat('<option value="', category, '" ' 
    , case when category='#category#' then 'selected' else '' end 
    , '>' , category, '</option>')as CATEGORIES
    from sotrudniki
    where lab_id = 100000
    ;
    select distinct concat('<option value="', stepen, '" ' 
    , case when stepen='#stepen#' then 'selected' else '' end 
    , '>' , stepen, '</option>')as STEPEN
    from sotrudniki
    where lab_id = 100000
    ;
    select distinct concat('<option value="', grazhdan, '" ' 
    , case when grazhdan='#grazhdan#' then 'selected' else '' end 
    , '>' , grazhdan, '</option>')as GRAZHDAN
    from sotrudniki
    where lab_id = 100000
    order by grazhdan
    ;
    select distinct concat('<option value="', short_name, '" ' 
    , case when short_name='#otdel#' then 'selected' else '' end 
    , '>' , short_name, '</option>')as OTDEL
    from struktura str
    where str.pid  in (select id from struktura where pid = 100000)
    and pid in (select id from struktura where short_name like "#otdelenie#%") ??otdelenie    
    order by otdel
    ;
    select distinct concat('<option value="', short_name, '" ' 
    , case when short_name='#otdelenie#' then 'selected' else '' end 
    , '>' , short_name, '</option>')as OTDELENIE
    from struktura
    where pid = 100000
    order by OTDELENIE
[end]

