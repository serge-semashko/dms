tab_fte_table.cfg

[comments]
descr=Таб "FTE"
input=none
output=HTML таблица объектов
parents=
childs=admin/monitor/docs_list_table.cfg
testURL=?c=admin/monitor/docs_list
author:Фуряева М.Т.
[end]

[parameters]
service=dubna.walt.service.TableServiceSpecial
request_name=U:Список документов
LOG=ON 
tableCfg=table_no
$INCLUDE dat/common.dat[rowLinks]
[end]

[report header]

<table class="tlist tgreen" cellspacing=0 border=1>

    <tr>
        <th colspan="7" style="text-align:center"></th>
        <th colspan="222" style="text-align:center">FTE по темам</th>
    </tr><tr>
        <th class="srh" sr="sotr.tab_n">Таб.№</th>
        <th class="srh" sr="sotr.FIO">ФИО</th>
        <th class="srh"  sr="sotr.TopParent_name" >Отделение</th>
        <th class="srh"  sr="sotr.subTopParent_name" >Подразделение</th>
        <th class="srh" sr="sotr.post">Должность</th> 
        <th class="srh" sr="sotr.category">Категория</th>  
        <th class="srh" sr="sotr.shtat_direct">Штат</th> 
        <th  sr="fte">FTE</th>
        $GET_DATA [fte topics header] 
        #topics_header# 
    </tr><tr>
        <th colspan="7" style="text-align:center"> </th>
        <th  >FTE</th>
        #projects_header# 
    </tr>    
[end]

[add tema to header]
 select 
[end]

[fte topics header]
select concat("<th colspan=",
ifnull((select count(topic_id) as cnt from projects where topic_id=tpc.id group by topic_id),1),
  ">",short_number,"</th>") as topics_header
from topics  tpc
order by  short_number
;

select 
 concat("<th>",ifnull(prj.short_name,""),"</th>") as projects_header 
  from  topics tpc left join projects prj on prj.Topic_id = tpc.ID
  order by tpc.short_name, prj.short_name ;      
[end]

[item]
    ++++++++++++++++++ Строка таблицы - 1 документ +++++++++++++++++++++ ??
    <tr 
    class="pt oddRow" ??oddRow=1 
    
    onClick="ShowDialog(true); AjaxCall('popupCont', 'c=edit/fte&tab_n=#tab_n#', true);"  ??
    > 
    <td style="border-left: none;border-right: none;border-bottom: none">#tab_n#</td> 
    <td style="border-left: none;border-right: none;border-bottom: none">#F# #I# #O#</td> 
    <td style="border-left: none;border-right: none;border-bottom: none">#otdel#</td>
    <td style="border-left: none;border-right: none;border-bottom: none">#division#</td>
    <td style="border-left: none;border-right: none;border-bottom: none">#post#</td>
    <td style="border-left: none;border-right: none;border-bottom: none">#category#</td>
    <td style="border-left: none;border-right: none;border-bottom: none">#shtat_direct#</td>
    <td style="border-left: none;border-right: none;border-bottom: none">#fte#</td> 
    $GET_DATA [get fte for tab_n]  
    #tab_n_projects_fte# 
    </tr>
[end]

[get fte for tab_n]
select 
 concat("<td ",
  "onClick=""ShowDialog(true); AjaxCall('popupCont', 'c=edit/fte&tab_n=#tab_n#&project_id=",
    ifnull(prj.id,-1),
  "', true);"" ",
 ">",
 ifnull(ft.percent,0),"</td>") as tab_n_projects_fte 
  from  topics tpc left join projects prj on prj.Topic_id = tpc.ID left join FTE ft on prj.ID=ft.project_id and ft.tab_n = #tab_n#
  order by tpc.short_name, prj.short_name ;      

[end]

[report footer]
$SET_PARAMETERS NumTableCols=24;

<tr><td colspan=#NumTableCols# class="pager last">
$INCLUDE dat/common.dat[rpp]  ??!NumTableRows=0
<input type=hidden name="rpp" value="#rpp#"> ??NumTableRows=0
</td></tr>
</table>

<script type="text/javascript">
showSrt("#srt#","sup"); ??!desc
showSrt("#srt#","sdown"); ??desc
</script>
[end]

[SQL]
    select sotr.person_id, sotr.tab_n, sotr.F, sotr.I, sotr.O, sotr.FIO, sotr.otdel, sotr.post
    , sotr.division, sotr.category,  sotr.shtat_direct 
    from sotrudniki sotr
    $INCLUDE utils.cfg[criteria] 
    order by #srt# #desc# ??srt
[end]