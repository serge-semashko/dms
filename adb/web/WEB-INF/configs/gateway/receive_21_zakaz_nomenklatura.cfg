gateway/receive_21_zakaz_tabl.cfg


[parameters]
request_name=S:заказ поставщику - табл.ч.
LOG=ON
[end]


[report]
$SET_PARAMETERS LIST=;

$GET_DATA [delete existing records]   ??!ERROR

$EXECUTE_LOOP item; #Номенклатура_Ref.items#; [receive item];    ??!ERROR
$GET_DATA [update parent] ??!ERROR
[end]


[receive item]
$SET_PARAMETERS p1=Номенклатура_Ref.#item#.Сумма; p2=Номенклатура_Ref.#item#.Цена; p3=Номенклатура_Ref.#item#.Количество; 
$SET_PARAMETERS Сумма=^#p1#; Цена=^#p2#; Количество=^#p3#; 

$SET_PARAMETERS p1=Номенклатура_Ref.#item#.СтавкаНДС; p2=Номенклатура_Ref.#item#.Номенклатура; p3=Номенклатура_Ref.#item#.Номенклатура_Ref; 
$SET_PARAMETERS СтавкаНДС=^#p1#; Номенклатура=^#p2#; Номенклатура_Ref=^#p3#; 

$SET_PARAMETERS p1=Номенклатура_Ref.#item#.ХарактеристикаНоменклатуры; 
$SET_PARAMETERS ХарактеристикаНоменклатуры=^#p1#; 

$SET_PARAMETERS p1=Номенклатура_Ref.#item#.Коэффициент; p2=Номенклатура_Ref.#item#.СуммаНДС; p3=Номенклатура_Ref.#item#.ЕдиницаИзмерения; 
$SET_PARAMETERS Коэффициент=^#p1#; СуммаНДС=^#p2#; ЕдиницаИзмерения=^#p3#; NDS=null;
$SET_PARAMETERS СуммаНДС=null;  ??!СуммаНДС
$SET_PARAMETERS NDS=0; СуммаНДС=0; ??СтавкаНДС=Без НДС; 

$SET_PARAMETERS ERROR=Отсутствует Сумма; ??!Сумма
$SET_PARAMETERS Коэффициент=null; ??!Коэффициент

$GET_DATA [insert record]   ??Command=PutObject&!ERROR
$SET_PARAMETERS LIST=#LIST#, #Номенклатура#;  ??!Номенклатура=Номенклатура_Ref
[end]

[delete existing records]
delete from C3_ZAKAZ_TABL where ZAKAZ_REF='#Элемент_Ref#'
[end]
 
[insert record]
select substr('#СтавкаНДС#', 1, INSTR('#СтавкаНДС#','%')-1) as NDS from dual; ??СтавкаНДС&!СтавкаНДС=Без НДС

insert into C3_ZAKAZ_TABL (ZAKAZ_REF, NOMENKLATURA, NOMENKLATURA_REF, NOMENKLATURA_DET, ED_IZM
, KOLVO, SUMMA, CENA, NDS, SUMMA_NDS, KOEFF, DATE_UPD)
values('#Элемент_Ref#', '#Номенклатура#', '#Номенклатура_Ref#', '#ХарактеристикаНоменклатуры#', '#ЕдиницаИзмерения#'
, #Количество#, #Сумма#, #Цена#, #NDS#, #СуммаНДС#, #Коэффициент#,SYSDATE)
[end]

[update parent]
    update C3_ZAKAZ_POSTAV set NOMENKLATURA=substr('#LIST#', 2,1023) 
    where REF='#Элемент_Ref#'
[end]