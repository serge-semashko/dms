gateway/receive_21_zakaz_tabl_u.cfg


[parameters]
request_name=S:заказ поставщику - табл.ч. - услуги
LOG=ON
[end]


[report]
$SET_PARAMETERS table=C3_ZAKAZ_TABL;

$GET_DATA [delete existing records]   ??!ERROR

$EXECUTE_LOOP item; #Услуги.items#; [receive item];    ??!ERROR
[end]

*** ARRAY: Услуги:
...* Услуги.1.Цена=10000000
...* Услуги.1.Сумма=10000000
...* Услуги.1.Количество=1
...* Услуги.1.СтавкаНДС=Без НДС
...* Услуги.1.Содержание=Электроэнергия
...* Услуги.1.Номенклатура=Электроэнергия
...* Услуги.1.Номенклатура_Ref=d4c98343-5a6a-11e2-9bcf-000e0ce597c9

[receive item]
$SET_PARAMETERS p1=Услуги.#item#.Сумма; p2=Услуги.#item#.Цена; p3=Услуги.#item#.Количество; 
$SET_PARAMETERS Сумма=^#p1#; Цена=^#p2#; Количество=^#p3#; 
$SET_PARAMETERS p1=Услуги.#item#.СтавкаНДС; p2=Услуги.#item#.Номенклатура; p3=Услуги.#item#.Номенклатура_Ref; 
$SET_PARAMETERS СтавкаНДС=^#p1#; Номенклатура=^#p2#; Номенклатура_Ref=^#p3#; 
$SET_PARAMETERS p1=Услуги.#item#.Содержание; 
$SET_PARAMETERS Содержание=^#p1#; NDS=null;
$SET_PARAMETERS NDS=0; ??СтавкаНДС=Без НДС 

$SET_PARAMETERS ERROR=Отсутствует Сумма; ??!Сумма

$GET_DATA [insert record]   ??Command=PutObject&!ERROR
[end]

[delete existing records]
delete from #table# where ZAKAZ_REF='#Элемент_Ref#'
[end]
 
[insert record]
select substr('#СтавкаНДС#', 1, length('#СтавкаНДС#')-1) as NDS from dual; ??СтавкаНДС&!СтавкаНДС=Без НДС

insert into #table# (ZAKAZ_REF, NOMENKLATURA, NOMENKLATURA_REF, SODERZHANIE
, KOLVO, SUMMA, CENA, NDS, DATE_UPD)
values('#Элемент_Ref#', '#Номенклатура#', '#Номенклатура_Ref#', '#Содержание#'
, #Количество#, #Сумма#, #Цена#, #NDS#, SYSDATE)
[end]
