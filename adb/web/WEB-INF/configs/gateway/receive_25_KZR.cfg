gateway/receive_25_KZR.cfg

[parameters]
request_name=S:Прием корректировки заявки
LOG=ON
[end]


[report]
$LOG1 <hr><b>===>>> receive_25_KZR.cfg</b><br>
$LOG5 object=#Object#;<br> 
$SET_PARAMETERS ERR_CODE=0; ERROR=; 
$SET_PARAMETERS ERROR=Отсутствует Элемент; ??!Элемент
$SET_PARAMETERS ERROR=#ERROR# Отсутствует Элемент Ref; ??!Элемент_Ref
$SET_PARAMETERS ERROR=#ERROR# Отсутствует ЗаявкаНаРасходованиеСредств; ??!ЗаявкаНаРасходованиеСредств

$SET_PARAMETERS ERROR=#ERROR# Отсутствует СуммаДокумента; ??!СуммаДокумента
$SET_PARAMETERS ERROR=#ERROR# Отсутствует РасшифровкаПлатежа; ??!РасшифровкаПлатежа


$GET_DATA [check existing record] ??!ERROR
$GET_DATA [create record] ??!DOC_EXISTS
$GET_DATA [update record] ??!ERROR
$CALL_SERVICE c=gateway/receive_25_KZR_tabl; ??!ERROR&РасшифровкаПлатежа.count>0

$SET_PARAMETERS DOC_ID=#Элемент_Ref#
$SET_PARAMETERS ResultCode=3; ERR_CODE=3; Result=#ERROR#; ??ERROR
[end]

============================================================================
============================================================================
============================================================================

[check existing record]
select 'Y' as DOC_EXISTS from C3_REQUESTS
where REF='#Элемент_Ref#'
[end]


[create record]
insert into C3_REQUESTS (doc, ref, DOC_TYPE, REQUEST, REQUEST_REF)
values ('#Элемент#', '#Элемент_Ref#', 'КЗР', '#ЗаявкаНаРасходованиеСредств#', '#ЗаявкаНаРасходованиеСредств_Ref#')
[end]
 

[update record]
update C3_REQUESTS set 
SCENARII='#Сценарий#'
, VID_OPER='#ВидОперации#'
, DATA_RASH=to_date('#ДатаРасхода#', 'DD.MM.YYYY HH24:MI:SS') ??ДатаРасхода
, CONTRAGENT='#Контрагент#'
, CONTRAGENT_REF='#Контрагент_Ref#'
, RESP='#Ответственный#'
, RESP_REF='#Ответственный_Ref#'
, COMMENTS='#Комментарий#'
, PRIKAZI='#Приказы#'
, STATUS='#Состояние#'
, DIV='#ЦФО#'
, DIV_REF='#ЦФО_Ref#'
, STATIA='#СтатьяОборотов#'
, STATIA_REF='#СтатьяОборотов_Ref#'

, CURR='#ВалютаДокумента#'
, SUMM_VAL=#СуммаДокумента#  ??СуммаДокумента
, RATE=#КурсДокумента# ??КурсДокумента
, SUMM_VOZVRAT=#СуммаВозврата# ??СуммаВозврата

, FORMA_OPL='#ФормаОплаты#'
, VID_VIDACHI='#ВидВыдачиДенежныхСредств#'
, KRATNOST='#КратностьДокумента#'
, DOC_OSN='#ДокументОснование#'
, DOC_OSN_REF='#ДокументОснование_Ref#'

, ADB_NR=#№_ADB#  ??№_ADB
, DATE_UPD=SYSDATE
where ref='#Элемент_Ref#'
[end]

