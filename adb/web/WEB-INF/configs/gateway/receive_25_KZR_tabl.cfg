gateway/receive_25_KZR_tabl.cfg


[parameters]
request_name=S:КЗР - табл.ч.
LOG=ON
[end]


[report]
$SET_PARAMETERS table=C3_REQUESTS_TABL;

$GET_DATA [delete existing records]   ??!ERROR

$EXECUTE_LOOP item; #РасшифровкаПлатежа.items#; [receive item];    ??!ERROR
[end]


[receive item]
$LOG item: #item#;<br>
$SET_PARAMETERS p1=РасшифровкаПлатежа.#item#.СуммаПлатежа; p2=РасшифровкаПлатежа.#item#.Сделка;  p3=РасшифровкаПлатежа.#item#.Сделка_Ref; 
$SET_PARAMETERS СуммаПлатежа=^#p1#; Сделка=^#p2#; Сделка_Ref=^#p3#; 

$SET_PARAMETERS p1=РасшифровкаПлатежа.#item#.Проект; p2=РасшифровкаПлатежа.#item#.Проект_Ref; p3=РасшифровкаПлатежа.#item#.КратностьВзаиморасчетов; 
$SET_PARAMETERS Проект=^#p1#; Проект_Ref=^#p2#; КратностьВзаиморасчетов=^#p3#; 

$SET_PARAMETERS p1=РасшифровкаПлатежа.#item#.СтатьяДвиженияДенежныхСредств; p2=РасшифровкаПлатежа.#item#.СтатьяДвиженияДенежныхСредств_Ref; 
$SET_PARAMETERS СтатьяДвиженияДенежныхСредств=^#p1#; СтатьяДвиженияДенежныхСредств_Ref=^#p2#;

$SET_PARAMETERS p1=РасшифровкаПлатежа.#item#.СуммаВзаиморасчетов; p2=РасшифровкаПлатежа.#item#.КурсВзаиморасчетов; p3=РасшифровкаПлатежа.#item#.Сторно; 
$SET_PARAMETERS СуммаВзаиморасчетов=^#p1#; КурсВзаиморасчетов=^#p2#; Сторно=^#p3#; 

$SET_PARAMETERS p1=РасшифровкаПлатежа.#item#.КорректируемыйДокумент; p2=РасшифровкаПлатежа.#item#.КорректируемыйДокумент_Ref; p3=РасшифровкаПлатежа.#item#.ЗаявкаНаРасходованиеСредств_Ref; 
$SET_PARAMETERS КорректируемыйДокумент=^#p1#; КорректируемыйДокумент_Ref=^#p2#; ЗаявкаНаРасходованиеСредств_Ref=^#p3#; 

$SET_PARAMETERS КурсВзаиморасчетов=1;  ??!КурсВзаиморасчетов
$SET_PARAMETERS ERROR=РасшифровкаПлатежа: Отсутствует СуммаПлатежа; ??!СуммаПлатежа

$GET_DATA [insert record]   ??Command=PutObject&!ERROR
[end]

[delete existing records]
delete from #table# where KZR_REF='#Элемент_Ref#'
[end]
 
[insert record]
insert into #table# (KZR, KZR_REF, REQ_REF, DOC_OSN, DOC_OSN_REF
, CORR_DOC, CORR_DOC_REF
, PROJECT, PROJECT_REF, ST_DV_DEN, ST_DV_DEN_REF
, CURR, CURR_CODE, RATE, SUMMA_RASCH, SUMM_VAL, KRATNOST
, IS_STORNO ??Сторно=Да
, DATE_UPD)
values('#Элемент#', '#Элемент_Ref#', '#ЗаявкаНаРасходованиеСредств_Ref#', '#Сделка#', '#Сделка_Ref#'
, '#КорректируемыйДокумент#', '#КорректируемыйДокумент_Ref#'
, '#Проект#', '#Проект_Ref#', '#СтатьяДвиженияДенежныхСредств#', '#СтатьяДвиженияДенежныхСредств_Ref#'
, '##', '##', #КурсВзаиморасчетов#, #СуммаВзаиморасчетов#, #СуммаПлатежа#, '#КратностьВзаиморасчетов#'
, 1  ??Сторно=Да
,SYSDATE)
[end]

, DOC_OSN_TYPE, DOC_OSN_NR, DOC_OSN_DAT
, SUMM_RUB, SUMM_USD, SUMM_EUR

...* РасшифровкаПлатежа.1.Проект=1100


...* РасшифровкаПлатежа.1.СуммаВзаиморасчетов=1461.44
...* РасшифровкаПлатежа.1.ДоговорКонтрагента=Основной договор
...* РасшифровкаПлатежа.1.ДоговорКонтрагента_Ref=1d398c99-4a7e-11e6-9460-0025907d24fa

