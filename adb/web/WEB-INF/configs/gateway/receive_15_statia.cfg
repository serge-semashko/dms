gateway/receive_15_statia.cfg


[parameters]
request_name=S:Прием статьи
LOG=ON
[end]


[report]
$LOG1 <hr><b>===>>> receive_15_statia.cfg</b><br>
$LOG5 object=#Object#;<br> 
$SET_PARAMETERS ERR_CODE=0; ERROR=; Элемент_Ref=#SrcObjectID#;
$SET_PARAMETERS ERROR=#ERROR# Отсутствует Элемент Ref; ??!Элемент_Ref
$SET_PARAMETERS ERROR=#ERROR# Отсутствует Наименование; ??!Наименование
$SET_PARAMETERS ERROR=#ERROR# Отсутствует Код; ??!Код


$GET_DATA [check existing record] ??!ERROR
$GET_DATA [create record] ??!DOC_EXISTS&!ERROR
$GET_DATA [update record] ??!ERROR
$GET_DATA [set aggr] 
    ??ЭтоГруппа=1

$SET_PARAMETERS DOC_ID=#Элемент_Ref#
$SET_PARAMETERS ResultCode=3; ERR_CODE=3; Result=#ERROR#; ??ERROR
[end]

============================================================================
============================================================================
============================================================================

[check existing record]
select 'Y' as DOC_EXISTS from C3_STATI
where REF='#Элемент_Ref#'
[end]


[create record]
insert into C3_STATI (ref, code, name, DATE_UPD)
values ('#Элемент_Ref#', #Код#, '#Наименование#', SYSDATE)
[end]
 

[update record]
update C3_STATI set code=#Код#
    , pid=#РодительКод#  ??РодительКод
    , pid=null  ??!РодительКод
    , name='#Наименование#'
    , name_full='#НаименованиеПолное#'
    , is_group=0 ??!ЭтоГруппа=1
    , is_group=1 ??ЭтоГруппа=1
    , is_deleted=0 ??ПометкаУдаления=Нет
    , is_deleted=1 ??!ПометкаУдаления=Нет
    , DATE_UPD=SYSDATE
where ref='#Элемент_Ref#'
[end]

[set aggr]
    update C3_STATI set aggr=to_number(substr(regexp_substr(name,'([[:digit:]]{2}\.)',1),1,2)) where is_group=1  ??ЭтоГруппа=1
    update C3_STATI s set aggr=(select aggr from C3_STATI p where p.code=s.pid) where is_group=0;  ??!ЭтоГруппа=1
[end]
