gateway/receive_8_fizlitco.cfg


[parameters]
request_name=S:Прием справочника проектов
LOG=ON
[end]


[report]
$LOG1 <hr><b>===>>> receive_9_project.cfg</b><br>
$LOG5 object=#Object#;<br> 
$SET_PARAMETERS ERR_CODE=0; ERROR=; Элемент_Ref=#SrcObjectID#;
$SET_PARAMETERS ERROR=Отсутствует Код; ??!Код
$SET_PARAMETERS ERROR=#ERROR# Отсутствует РодительКод; ??!РодительКод&!ЭтоГруппа=1

$GET_DATA [check existing record] ??!ERROR
$GET_DATA [create record] ??!ERROR&!DOC_EXISTS
$GET_DATA [update record] ??!ERROR
$GET_DATA [set budget]  ??!ERROR&!Наименование=БЮДЖЕТ

$SET_PARAMETERS DOC_ID=#Элемент_Ref#
$SET_PARAMETERS ResultCode=3; ERR_CODE=3; Result=#ERROR#; ??ERROR
[end]

============================================================================
============================================================================
============================================================================

[check existing record]
select 'Y' as DOC_EXISTS from C3_PROJECTS
where REF='#Элемент_Ref#'
[end]


[create record]
insert into C3_PROJECTS (ref)
values ('#Элемент_Ref#')
[end]
 

[update record]
update C3_PROJECTS set id='#Код#', pid='#РодительКод#', des='#Наименование#'
, is_group=1 ??ЭтоГруппа=1
, IS_BUDGET=1 ??Наименование=БЮДЖЕТ
, DATE_UPD=SYSDATE
where ref='#Элемент_Ref#'
[end]

[set budget]
update C3_PROJECTS set is_budget=(select max(is_budget) from c3_projects connect by prior pid=id start with id=#Код#)
where id=#Код#
[end]
