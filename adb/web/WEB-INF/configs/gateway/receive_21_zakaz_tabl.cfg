gateway/receive_21_zakaz_tabl.cfg


[parameters]
request_name=S:заказ поставщику - табл.ч.
LOG=ON
[end]


[report]
$SET_PARAMETERS table=C3_ZAKAZ_TABL;

$GET_DATA [delete existing records]   ??!ERROR

$EXECUTE_LOOP item; #Товары.items#; [receive item];    ??!ERROR
[end]


[receive item]
$SET_PARAMETERS p1=Товары.#item#.Сумма; p2=Товары.#item#.Цена; p3=Товары.#item#.Количество; 
$SET_PARAMETERS Сумма=^#p1#; Цена=^#p2#; Количество=^#p3#; 

$SET_PARAMETERS p1=Товары.#item#.СтавкаНДС; p2=Товары.#item#.Номенклатура; p3=Товары.#item#.Номенклатура_Ref; 
$SET_PARAMETERS СтавкаНДС=^#p1#; Номенклатура=^#p2#; Номенклатура_Ref=^#p3#; 

$SET_PARAMETERS p1=Товары.#item#.ХарактеристикаНоменклатуры; 
$SET_PARAMETERS ХарактеристикаНоменклатуры=^#p1#; 

$SET_PARAMETERS p1=Товары.#item#.Коэффициент; p2=Товары.#item#.СуммаНДС; p3=Товары.#item#.ЕдиницаИзмерения; 
$SET_PARAMETERS Коэффициент=^#p1#; СуммаНДС=^#p2#; ЕдиницаИзмерения=^#p3#; NDS=null;
$SET_PARAMETERS СуммаНДС=null;  ??!СуммаНДС
$SET_PARAMETERS NDS=0; СуммаНДС=0; ??СтавкаНДС=Без НДС; 

$SET_PARAMETERS ERROR=Отсутствует Сумма; ??!Сумма

$GET_DATA [insert record]   ??Command=PutObject&!ERROR
[end]

[delete existing records]
delete from #table# where ZAKAZ_REF='#Элемент_Ref#'
[end]
 
[insert record]
select substr('#СтавкаНДС#', 1, INSTR('#СтавкаНДС#','%')-1) as NDS from dual; ??СтавкаНДС&!СтавкаНДС=Без НДС

insert into #table# (ZAKAZ_REF, NOMENKLATURA, NOMENKLATURA_REF, NOMENKLATURA_DET, ED_IZM
, KOLVO, SUMMA, CENA, NDS, SUMMA_NDS, KOEFF, DATE_UPD)
values('#Элемент_Ref#', '#Номенклатура#', '#Номенклатура_Ref#', '#ХарактеристикаНоменклатуры#', '#ЕдиницаИзмерения#'
, #Количество#, #Сумма#, #Цена#, #NDS#, #СуммаНДС#, #Коэффициент#,SYSDATE)
[end]
