svod_c_16.cfg

[parameters]
title=NICA-свод
service=jinr.adb.ServiceNicaSvod ??logged=YES
service=dubna.walt.service.TableServiceSpecial ??logged=YES_ZZZ
PS_TOTAL=ps_total
makeTotalsForCols=,W0,P0,T0,W4,P4,P5,W5,P19,W19,PW,P_TOT,W_TOT,S_TOT,PLAN,
numDigits=1
NumSpecialCols=6
totRowLabel=Всего
wrapperTable=none
wrapperTableEnd=none
table_beg=none
table_end=none
debug=off
[end]

table_svod=nica_svod_c_#q_yr#


TITLE_COLSPAN=6; 
??!TITLE_COLSPAN|TITLE_COLSPAN=0

[report header]
<HTML><HEAD><TITLE>#title#</TITLE>

<META http-equiv=Content-Type content="text/html; charset=windows-1251">
<meta name="CACHE-CONTROL" CONTENT="NO-CACHE">
<meta http-equiv="pragma" content="no-cache">
<link rel="stylesheet" href="#cssPath#adb.css" type="text/css">
<SCRIPT language=JavaScript src="#jsPath#lib.js"></SCRIPT>
<script language="JavaScript" src="#jsPath#calendar.js"></script>
<SCRIPT language=JavaScript src="#jsPath#cal2.js"></SCRIPT>

$INCLUDE common.dat[head]
<link rel="stylesheet" href="#ServletPath#?c=tabs_css" type="text/css"> ??debug=onZZZ
<link rel="stylesheet" href="#cssPath#tabs.css" type="text/css"> ??!debug=on&ZZZ
$INCLUDE cp/main12.cfg[style]
<style>
.bd {height:13px; margin-top:2px; border:solid 1px black;}
.bd td {padding:0; margin:0; border:none;}
td.z {color:##a0a0a0}
img {height:12px; margin:0px; border:none 1px black;}
img.b {border-right:solid 1px black;}
img.w {height:12px; margin:0px; border:none 1px black; border-left:none;}
</style>

<body style="margin:0 20px 20px 20px;">
<form name="theForm" method="POST" enctype="multipart/form-data" onSubmit="return doIt();">
<input type=hidden name="c" value="#c#">
<input type=hidden name="type" value="#type#">
<input type=hidden name="s06" value="on"> ??s05
<input type=hidden name="s10" value="on"> ??s05
<input type=hidden name="s14" value="on"> ??s19
<input type=hidden name="s18" value="on"> ??s19
<input type=hidden name="s_other" value="on"> ??

<table border=0 cellpadding=0 cellspacing=0 width=98%>
<tr><td width=90%>
<div style="padding-top: 10px;">
<h3>Финансовые затраты по подсистемам NICA MPD (т.1065)<br></h3>
<h3><b>по данным 1C</b> с 01.01 по #LAST# <sup>1</sup>)</h3></div>
</td><td align=right><a class=info href="#ServletPath#">Главная</a>
</td></tr></table>

$INCLUDE cp/svod/labList.cfg[NOTE] ??

<script>
var frm = document.theForm;
function showDet()
{
	frm.c.value="nica/svod_det";
	frm.submit();
}
</script>

<center>

$INCLUDE [filters]
<br> 
<table class=svod border=0  cellspacing=0 cellpadding=0>
<tr><td class=h rowspan=3><b>Подсистема</b></td><td class=h colspan=#TITLE_COLSPAN#
><b>Статьи затрат</b></td><td class=h rowspan=2 colspan=3><b>Итого:</b></td>
<td class=h rowspan=3><b>План:
&nbsp;<sup>2</sup>) ??
</b><br><br>(по всем<br>статьям)</td>
<td class=h colspan=3 rowspan=1><b>Всего - % от плана:</b></td>
</tr>
<tr>
<td class=h colspan=2>4:&nbsp;МНТС</td> ??s04
<td class=h colspan=2>5,6,10:&nbsp;Оборудование</td> ??s05
<td class=h colspan=2>14,18,19:&nbsp;Строительство</td>  ??s19
<td class=h colspan=2>&nbsp;Другие</td>  ??s0
<td class=h rowspan=2>Опла-<br>чено</td><td class=h rowspan=2>+ожи-<br>дает</td><td class=h rowspan=2>&nbsp;</td> 
</tr>
<tr>
<td class=h>Оплачено</td><td class=h>Ожидает</td>  ??s04
<td class=h>Оплачено</td><td class=h>Ожидает</td>  ??s05
<td class=h>Оплачено</td><td class=h>Ожидает</td>  ??s19
<td class=h>Оплачено</td><td class=h>Ожидает</td>  ??s0
<td class=h>Всего</td>  ??s0_ZZZ
<td class=h>Оплачено</td><td class=h>Ожидает</td><td class=h>Всего</td>
</tr>
[end]


[item]
<tr><td class=rb style="text-align:left;">#PRJ#</td>
<td class="rb"><a href="#ServletPath#?c=c2/reqList&PROJECT_ID=#PRJ_ID#&payed=y&rpp=20&f_aggr=04&f_prik=NULL&f_subject=1065&f_bud=y" target=_blank>#P4#&nbsp;</a></td>  ??s04&!P4=0.0
<td class="rb z">0.0</td>  ??s04&P4=0.0

<td class="rb"><a href="#ServletPath#?c=c2/reqList&PROJECT_ID=#PRJ_ID#&payed=n&rpp=20&f_aggr=04&f_prik=NULL&f_subject=1065&f_bud=y" target=_blank>#W4#&nbsp;</a></td>  ??s04&!W4=0.0
<td class="rb z">0.0&nbsp;</td>  ??s04&W4=0.0


<td><a href="#ServletPath#?c=c2/reqList&PROJECT_ID=#PRJ_ID#&payed=y&rpp=20&f_aggr=5,6,10&f_prik=NULL&f_subject=1065&f_bud=y" target=_blank>#P5#&nbsp;</a></td>  ??s05&!P5=0.0
<td class=z>0.0</td>  ??s05&P5=0.0

<td class=rb><a href="#ServletPath#?c=c2/reqList&PROJECT_ID=#PRJ_ID#&payed=n&rpp=20&f_aggr=5,6,10&f_prik=NULL&f_subject=1065&f_bud=y" target=_blank>#W5#&nbsp;</a></td>  ??s05&!W5=0.0
<td class="rb z">0.0&nbsp;</td>  ??s05&W5=0.0

<td><a href="#ServletPath#?c=c2/reqList&PROJECT_ID=#PRJ_ID#&payed=y&rpp=20&f_aggr=14,18,19&f_prik=NULL&f_subject=1065&f_bud=y" target=_blank>#P19#&nbsp;</a></td>   ??s19&!P19=0.0
<td class=z>0.0&nbsp;</td>   ??s19&P19=0.0

<td class=rb><a href="#ServletPath#?c=c2/reqList&PROJECT_ID=#PRJ_ID#&payed=n&rpp=20&f_aggr=14,18,19&f_prik=NULL&f_subject=1065&f_bud=y" target=_blank>#W19#&nbsp;</a></td>  ??s19&!W19=0.0
<td class="rb z">0.0&nbsp;</td>  ??s19&W19=0.0

<td><a href="#ServletPath#?c=c2/reqList&PROJECT_ID=#PRJ_ID#&payed=y&rpp=20&f_aggr=7,8,9,11,12,13,15,16,17&f_prik=NULL&f_subject=1065&f_bud=y" target=_blank>#P0#&nbsp;</a></td>   ??s0&!P0=0.0
<td class=z>0.0&nbsp;</td>   ??s0&P0=0.0
<td class=rb><a href="#ServletPath#?c=c2/reqList&PROJECT_ID=#PRJ_ID#&payed=n&rpp=20&f_aggr=7,8,9,11,12,13,15,16,17&f_prik=NULL&f_subject=1065&f_bud=y" target=_blank>#W0#&nbsp;</a></td>  ??s0&!W0=0.0
<td class="rb z">0.0&nbsp;</td>  ??s0&W0=0.0

<td><a href="#ServletPath#?c=c2/reqList&PROJECT_ID=#PRJ_ID#&rpp=20&f_aggr_not=4,5,6,10,14,18,19&f_prik=NULL&f_subject=1065&f_bud=y" target=_blank>#T0#&nbsp;</a></td>   ??s0&!T0=0.0&ZZZ
<td class=z>0.0&nbsp;</td>   ??s0&T0=0.0&ZZZ

<td>#P_TOT#&nbsp;</td>
<td>#W_TOT#&nbsp;</td>
<td>#S_TOT#&nbsp;</td>

<td class=rb>#PLAN#&nbsp;</td>
$INCLUDE [PS] ??PLAN
<td class=rb colspan=3>&nbsp;</td> ??!PLAN
</tr>
$SET_PARAMETERS TOT_SIZE=;
[end]


[ZZZ_link-Total] param: p_key;
<a target=_blank href="#ServletPath#?c=c2/reqList&PROJECT_ID=#PRJ_ID#&payed=#p_key#&f_prik=NULL&rpp=20&f_aggr=
04  ??s04
,05,06,10  ??s05
,14,18,19  ??s19
,07,08,09,11,12,13,14,15,16,17  ??s0
">
[end]



[PS]
<td style="border-right:none; background-color:##D0E8FF">#PS#%</td><td style="border-right:none;  background-color:##D0FFE8">#PS2#%</td>
$INCLUDE [chart]  ??CURR=USD
[end]



[chart]
<td class=rb style="text-align:left;">
$INCLUDE [less] ??W_SIZE>-1
$INCLUDE [more] ??W_SIZE<0
#P_SIZE#:#TOT_SIZE#:#W_SIZE#/#B_SIZE#:#R_SIZE#:#Y_SIZE#/#G_SIZE#:#G2_SIZE# ??
</td>
[end]


[less]
<table class=bd cellpadding=0 cellspacing=0 border=0 style="width:#P_SIZE#px;"><tr>
<td><img src="#imgPath#bluedot.gif" width=#B_SIZE#><img src="#imgPath#greendot.gif" width=#G_SIZE#><img src="#imgPath#whitedot.gif" width=#W_SIZE#></td> ??G_SIZE>0&W_SIZE>0
<td><img src="#imgPath#bluedot.gif" width=#B_SIZE#><img src="#imgPath#whitedot.gif" width=#W_SIZE#></td> ??G_SIZE=0&W_SIZE>0
<td><img src="#imgPath#bluedot.gif" width=#B_SIZE#><img src="#imgPath#greendot.gif" width=#G_SIZE#></td>  ??G_SIZE>0&W_SIZE<1
<td><img src="#imgPath#bluedot.gif" width=#B_SIZE#></td>   ??G_SIZE=0&W_SIZE<1
</tr></table>
#P_SIZE#:#W_SIZE#/#B_SIZE#/#G_SIZE#:#G2_SIZE# ??
[end]

[more]
$GET_DATA [getRedSizez]
$SET_PARAMETERS R_SIZE=1; ??R_SIZE=0
$SET_PARAMETERS Y_SIZE=1; ??Y_SIZE=0&R_SIZE<1
<table class=bd cellpadding=0 cellspacing=0 border=0 style="width:#TOT_SIZE#px;"><tr>
<td><img src="#imgPath#bluedot.gif" class=b width=#B_SIZE#><img src="#imgPath#reddot.gif" width=#R_SIZE#><img src="#imgPath#orangedot.gif" width=#Y_SIZE#></td> ??R_SIZE>0&Y_SIZE>0
<td><img src="#imgPath#bluedot.gif" class=b width=#B_SIZE#><img src="#imgPath#reddot.gif" width=#R_SIZE#></td> ??R_SIZE>0&Y_SIZE<1
<td><img src="#imgPath#bluedot.gif" width=#B_SIZE#><img src="#imgPath#greendot.gif" class=b width=#G2_SIZE#><img src="#imgPath#orangedot.gif" width=#Y_SIZE#></td> ??R_SIZE<1&Y_SIZE>0
</tr></table>
#TOT_SIZE#/#R_SIZE#:#Y_SIZE# ??
[end]


P_SIZE - план
B_SIZE - оплачены в пределах плана
G_SIZE - зеленый - всего ожидает 
G2_SIZE - зеленый - ожидает в пределах плана
R_SIZE - красный - оплачено сверх плана
Y_SIZE - желтый - ожидает сверх плана
TOT_SIZE - общий размер

[report footer]
</table></form></center>
<sup>1</sup>) Представлены данные, зарегистрированные на тему 1065, исключая дополнительное финансирование по грантам ПП и программам сотрудничества.
</body></html>
[end]

<br><sup>2</sup>) Суммарный бюджет темы 1065 на 20#q_yr# год с учетом стимуляционных выплат ($1 200 тыс.) составляет  
<a target=_blank href="#ServletPath#?c=budget/list&NODEID=1010&PNODEID=1010&f_bc=873">
$16 200 тыс. </a>


[filters]
$SET_PARAMETERS s04=on; s05=on; s19=on; s0=on; ??!s04&!s05&!s19&!s0

$SET_PARAMETERS s_mnts=#s04#;
$SET_PARAMETERS s_mat=#s05##s06##s10#;
$SET_PARAMETERS s_sod=#s18##s19#;

<br>
<table border=0 class=svod cellspacing=0 cellpadding=0><tr>
<td class="rb total">Показать статьи: </td>
<td class="rb total" style="text-align:left;"><input type=checkbox onClick="frm.submit();"
checked ??s04
name=s04 >МНТС (4)</td>

<td class="rb total" style="text-align:left;"><input type=checkbox onClick="frm.submit();"
checked ??s05
name=s05>Оборудование (5,6,10)</td>

<td class="rb total" style="text-align:left;"><input type=checkbox onClick="frm.submit();"
checked ??s19
name=s19>Стоительство (14,18,19)</td>

<td class="rb total" style="text-align:left;"><input type=checkbox onClick="frm.submit();"
checked ??s0
name=s0>Другие</td>
</tr>

$SET_PARAMETERS CURR=USD;  ??!CURR
$SET_PARAMETERS SCALE=1000;
<tr>
<td class="rb total">Показать в валюте: </td>

<td colspan=4 class="rb total" style="text-align:left;">
<input type=radio name=CURR onClick="frm.submit();" value="USD"
checked ??CURR=USD
>в тыс.USD по курсу на дату оплаты

<input type=radio name=CURR onClick="frm.submit();" value="USD_BUD"
checked ??CURR=USD_BUD
>в тыс.USD по бюджетному курсу #USD_RUB#

<input type=radio name=CURR onClick="frm.submit();" value="RUB"
checked ??CURR=RUB
>в тыс. руб.
</td></tr> 
<tr><td colspan=5><a href="javascript:showDet();">детализировать статьи >></a>&nbsp;</td></tr> ??
</table>
$SET_PARAMETERS CURR=RUB; SCALE=#USD_RUB_1000#;  ??CURR=USD_BUD

$GET_DATA [getTableParams]	
$SET_PARAMETERS MAX_PLAN=100; ??!MAX_PLAN
[end]

============================================================================
====================================== SQLs ================================

[preSQLs]
select max(id) as "VER" from nica_versions; ??
select
 to_char(max(dat)-1, 'DD.MM.YYYY') 
 to_char(max(last), 'DD.MM.YYYY')  ??
as LAST from c2_protokol where tab='C2_Requests_#q_yr#' and err is null
;
select USD_RUB, USD_RUB*1000 as "USD_RUB_1000" from budget_rates where year=20#q_yr#
[end]

[getTableParams]
select length('#s0##s04##s05##s19#') as "TITLE_COLSPAN" from dual;
select #TITLE_COLSPAN#-1 as "TITLE_COLSPAN" from dual; ??s0_ZZZ
select #SCALE#*max(s) as "MAX_PLAN" from nica_plan where YR=#q_yr#; ??
select #SCALE#*max(s) as "MAX_PLAN" from nica_plan_#q_yr#;
select decode(S_0_#CURR#+S_0W_#CURR#+S_4_#CURR#+S_4W_#CURR#+S_5_#CURR#+S_5W_#CURR#+S_19_#CURR#+S_19W_#CURR#,0,'','Y') as "SHOW_0" 
from nica_svod_c_#q_yr#_#VER#  ??
from nica_svod_c_#q_yr#
where ROOT_ID=-1;
[end]

[p_summ]
0
+nvl(s.S_0_#CURR#,0) ??s0
+nvl(s.S_4_#CURR#,0) ??s04
+nvl(s.S_5_#CURR#,0) ??s05
+nvl(s.S_19_#CURR#,0) ??s19
[end]

[w_summ]
0
+nvl(s.S_0W_#CURR#,0) ??s0
+nvl(s.S_4W_#CURR#,0) ??s04
+nvl(s.S_5W_#CURR#,0) ??s05
+nvl(s.S_19W_#CURR#,0) ??s19
[end]

[SQL]
select i.code||': '||i.title as "PRJ"
, to_char(s.S_4_#CURR#/#SCALE#,'9999990.0') as "P4", to_char(s.S_4W_#CURR#/#SCALE#,'9999990.0') as "W4"  ??s04
, to_char(s.S_5_#CURR#/#SCALE#,'9999990.0') as "P5", to_char(s.S_5W_#CURR#/#SCALE#,'9999990.0') as "W5" ??s05
, to_char(s.S_19_#CURR#/#SCALE#,'9999990.0') as "P19", to_char(s.S_19W_#CURR#/#SCALE#,'9999990.0') as "W19" ??s19
, to_char(s.S_0_#CURR#/#SCALE#,'9999990.0') as "P0", to_char(s.S_0W_#CURR#/#SCALE#,'9999990.0') as "W0"  ??s0

, to_char((
$INCLUDE [p_summ]
)/#SCALE#,'999990.0') as "P_TOT"

, to_char((
$INCLUDE [w_summ]
)/#SCALE#,'9999990.0') as "W_TOT"

, to_char((
$INCLUDE [p_summ]
+
$INCLUDE [w_summ]
)/#SCALE#,'9999990.0') as "S_TOT"

, to_char(p.S_#CURR#*1000/#SCALE#,'9999990.0') as "PLAN" 
, to_char((nvl(s.S_0_#CURR#,0)+nvl(s.S_4_#CURR#,0)+nvl(s.S_5_#CURR#,0)+nvl(s.S_19_#CURR#,0))/(10*p.S_#CURR#),'9999990.0') as "PS"
, to_char((nvl(s.S_0_#CURR#,0)+nvl(s.S_0W_#CURR#,0)+nvl(s.S_4_#CURR#,0)+nvl(s.S_4W_#CURR#,0)+nvl(s.S_5_#CURR#,0)+nvl(s.S_19_#CURR#,0)+nvl(s.S_5W_#CURR#,0)+nvl(s.S_19W_#CURR#,0))/(10*p.S_#CURR#),'9999990.0') as "PS2"

, to_char(100*(nvl(s.S_0_#CURR#,0)+nvl(s.S_4_#CURR#,0)+nvl(s.S_5_#CURR#,0)+nvl(s.S_19_#CURR#,0))/#MAX_PLAN# + 1,'9999990') as "B_SIZE"
, to_char(100*(nvl(s.S_0W_#CURR#,0)+nvl(s.S_4W_#CURR#,0)+nvl(s.S_5W_#CURR#,0)+nvl(s.S_19W_#CURR#,0))/#MAX_PLAN#,'9999990') as "G_SIZE"
, to_char(100*(p.S_#CURR#*#SCALE#-nvl(s.S_0_#CURR#,0)-nvl(s.S_0W_#CURR#,0)-nvl(s.S_4_#CURR#,0)-nvl(s.S_4W_#CURR#,0)-nvl(s.S_5_#CURR#,0)-nvl(s.S_5W_#CURR#,0)-nvl(s.S_19_#CURR#,0)-nvl(s.S_19W_#CURR#,0))/#MAX_PLAN# - 0.5,'9999990') as "W_SIZE"
, to_char(100*#SCALE#*p.S_#CURR#/#MAX_PLAN#+1,'9990') as "P_SIZE"
,i.id as "PRJ_ID"

from nica_wbs i left join nica_svod_c_#q_yr# s on s.ROOT_ID=i.id
left join nica_plan p on (p.code=i.code and p.YR=#q_yr#) ??
left join nica_plan_#q_yr# p on p.code=i.code
where i.lev=1
and i.id in(select ID from nica_wbs connect by prior id=pid start with id in(#A_NICA#)) ??NICA_ONLY&A_NICA	
and s.ROOT_ID>0 ??!SHOW_0&ZZZ
and i.code=12 ??
order by to_number(i.code) 
[end]

P_SIZE - план
B_SIZE - оплачены в пределах плана
G_SIZE - зеленый - всего ожидает 
G2_SIZE - зеленый - ожидает в пределах плана
R_SIZE - красный - оплачено сверх плана
Y_SIZE - желтый - ожидает сверх плана
TOT_SIZE - общий размер

[getRedSizez]
select #B_SIZE#-#P_SIZE# as R_SIZE from dual
;
select #B_SIZE#+#G_SIZE#-#P_SIZE# as Y_SIZE from dual ??R_SIZE<1
;
select #P_SIZE#-#B_SIZE# as G2_SIZE from dual ??R_SIZE<1
;
select #G_SIZE# as Y_SIZE from dual ??R_SIZE>0
;
select #P_SIZE# as B_SIZE from dual ??B_SIZE>#P_SIZE#
;
select #P_SIZE#+#R_SIZE#+#Y_SIZE# as TOT_SIZE from dual ??R_SIZE>0
;
select #P_SIZE#+#Y_SIZE# as TOT_SIZE from dual ??R_SIZE<1
; 
[end]

[correctTotal_ZZZ]
select to_char(#S_TOT#-#P4#,'9999990.0') as "S_TOT" 
, to_char(#W_TOT#-#P4#,'9999990.0') as "W_TOT" from dual;
[end]



[getTotalPS]
select to_char(sum(p.s_#CURR#)*1000/#SCALE#,'9999990.0') as  "TOT_PLAN" 
from nica_plan_#q_yr# p
 nica_plan p where YR=#q_yr# ??
;
select to_char(sum(S_0_#CURR#+S_4_#CURR#+S_5_#CURR#+S_19_#CURR#)/#SCALE#,'9999990.0') as "TOT_PAYED"
, to_char(sum(S_0W_#CURR#+S_4W_#CURR#+S_5W_#CURR#+S_19W_#CURR#)/#SCALE#,'9999990.0') as "TOT_W"
from nica_svod_c_#q_yr# 
;
select to_char(100*0#TOT_PAYED#/#TOT_PLAN#,'9999990.0') as "TOT_PS_P"
, to_char(100*(0#TOT_PAYED#+0#TOT_W#)/#TOT_PLAN#,'9999990.0') as "TOT_PS"
from dual
;
select to_char(100*(0#TOT_PAYED#)/#TOT_PLAN# + 1,'9999990') as "B_SIZE"
, to_char(100*(0#TOT_W#)/#TOT_PLAN#,'9999990') as "G_SIZE"
, to_char(100*(#TOT_PLAN#-0#TOT_PAYED#-0#TOT_W#)/#TOT_PLAN#,'9999990') as "W_SIZE"
, to_char(100,'9990') as "P_SIZE"
, to_char(100*(0#TOT_PAYED#+0#TOT_W#-#TOT_PLAN#)/#TOT_PLAN#,'9999990') as "R_SIZE"
from dual
;
[end]

[ps_total]
$SET_PARAMETERS TOT_PLAN=100; ??!TOT_PLAN
$GET_DATA [getTotalPS] 
#TOT_PS_P#%</td>
<td class=total>#TOT_PS#%</td>
$INCLUDE [chart]  ??CURR=USD
[end]

<td>
$INCLUDE [less] ??W_SIZE>-1
$INCLUDE [more] ??W_SIZE<0

