[parameters]
title=Регистрация
star=<font color=red size=+1><b>*</b></font>
$INCLUDE common.dat[colors]
[end]

[report]
$INCLUDE common.dat[head]
<body BACKGROUND="#imgPath#b_n.gif">
<center>
<form name="theForm" method="POST" enctype="multipart/form-data" onSubmit="return doIt();">
<input type=hidden name="c" value="#c#">
<input type=hidden name="cop" value="">

<table bgcolor=gray border=1 cellSpacing=0 cellPadding=0>
<tr><td width=100%>
<table cellSpacing=0 cellPadding=2 width="100%" border=0>

<tr bgcolor=white><td colspan=2 align=center>
<strong>Регистрация нового пользователя</strong>
<p>
Чтобы иметь возможность заносить информацию на наш сайт,<br>
Вам необходимо <b>зарегистрироваться.</b> <p>
Благодаря регистрации в последствии Вы сможете самостоятельно<br>
<b>изменять введенную Вами информацию.</b>
<p>
Если Вы <b>уже зарегистрированы</b> на нашем сайте,
то кликните на ссылке: <br>
<a href="javascript:login();">"Вход для зарегистрированных пользователей"</a>
<p>
На данный момент нам необходим только минимум информации о Вас.
<br>Обязательным является только заполнение полей, помеченных "#star#":
</td></tr>
<tr bgcolor=gray><td colspan=2></td>

#LabelTD# Ваш статус: #DataTD#
<input type="radio" name="type" value="1"> Предприятие
<input type="radio" name="type" value="2"> Предприниматель
<input type="radio" name="type" value="3"> Частное лицо
</TD>

#LabelTD#Наименование предприятия:#DataTD#<input size=50 name="org" value="#org#"></td>
#LabelTD#Адрес:#DataTD#<input size=50 name="org" value="#org#"></td>
#LabelTD#Контактное лицо:#DataTD#<input size=30 name="contact" value="#contact#"> #star#</td>
#LabelTD#Телефон(ы):#DataTD#<input size=30 name="phone" value="#phone#"> #star#</td>
#LabelTD#e-mail: #DataTD#<input size=30 name="email" value="#email#"></td>
#LabelTD#Имя для входа в наш сайт:#DataTD#<input size=8 name="u" value="#u#">#star#</td>
#LabelTD#пароль:#DataTD#<input type=password size=8 name="p" value="#p#">#star#
 подтверждение пароля: <input type=password size=8 name="pw2" value="#pw2#">#star#</td>

<tr bgcolor=gray><td colspan=2></td></tr>
<tr bgcolor=white><td align=center colspan=2>
<input type=submit value="Зарегистрироваться">
&nbsp; &nbsp; &nbsp;
<input type=button value="   Отмена   " onClick="cancel()">

</td></tr></table>
</td></tr></table></form>

<script>
var frm=document.theForm;
frm.type[0].checked=true;
frm.type[#type#-1].checked=true;  ??type

function login()
{ frm.c.value="login";
  frm.cop.value="l";  ??u&p
  window.resizeTo(450, 300);
  frm.submit();
}

login(); ??NUM_USERS=0
alert ("Пользователь '#u#' уже существует \n\r Выберите, пожалуйста, другое имя"); frm.u.focus(); ??NUM_USERS&!NUM_USERS=0

function trim(s)
{ while(s.substring(0,1) == " ")
    s = s.substring(1);
  return s;
}

function clearnFields()
{ frm.contact.value = trim(frm.contact.value);
  frm.phone.value = trim(frm.phone.value);
  frm.u.value = trim(frm.u.value);
  frm.p.value = trim(frm.p.value);
}

function doIt()
{ clearnFields();
  var s = "";
  if (frm.contact.value == "")     s = ", 'Контактное лицо'";
  if (frm.phone.value == "")    s += ", 'Телефон(ы)'";
  if (frm.u.value == "") s += ", 'Имя для входа...'";
  if (frm.p.value == "")      s += ", 'Пароль'";
  if (s.length > 0)
  { s = s.substring(1);
    alert ("Вам необходимо заполнить поля: \r\n" + s);
    return false;
  }
  if (frm.p.value != frm.pw2.value )
  { alert ("Пароль не подтвержден! \r\n Повторите ввод пароля");
    frm.p.value = "";
    frm.pw2.value = "";
    return false;
  }
  frm.cop.value="s";
}

function cancel()
{ window.close();
}

</script></body></html>
[end]

[preSQLs]
$INCLUDE [insert script]  ??cop=s
[end]

[insert script]
select count(*) as NUM_USERS from users where username='#u#';
$INCLUDE [store SQL]  ??NUM_USERS=0
[end]

[store SQL]
select max(id)+1 as NEWID from users;
insert into users (id,type,org,contact,phone,email,username,pw,user_group)
values (#NEWID#, #type#,'#org#','#contact#','#phone#','#email#','#u#','#p#', 'user')
[end]