[parameters]

title=Движение денежных средств

debug=on ??

makeTotalsForCols=,VH_SAL,POST,RASH,ISH_SAL, ??
makeSubtotals=y ??
totRowLabel=Итого
keepLog=false

tableCfg=this
thsnDelimiter=&nbsp;
numDigits=1
NumSpecialCols=1

table_beg=none
table_end=none
wrapperTable=none
wrapperTableEnd=none
$INCLUDE common.dat[colors]
[end]


[report]
$INCLUDE [logged report]   ??M_CP>1&logged
<script>window.location.href="#loginURL#?back_url=#ServerPath##ServletPath#";</script> ??!logged
[end]


[logged report]
<HTML><HEAD><TITLE>#title#</TITLE>
<META http-equiv=Content-Type content="text/html; charset=windows-1251">
$INCLUDE c2/i_head.dat[head]
$GET_DATA [getDates] ??!startdate|!enddate
<body bgcolor=F4FFFA>
<style> 
a {font-size: 9pt;}
table.tlist tr td {padding:2px 0px 2px 5px; background-color:white;}
table.tlist tr td.a_left {text-align:left;}
table.tlist tr td.tot {font-size: 9pt; font-weight:bold;}
td.a_right {text-align:right;}
table.tlist tr td.b_title {text-align:center; font-weight:bold; }
table.tlist tr td.div_head { font-size:11pt; font-weight:bold; }

table.tlist tr td.s2 {padding:2px 0px 2px 20px;}
table.tlist tr td.s3 {padding:2px 0px 2px 40px;}
.tb {border-top:solid 1px ##808080;}
.bb {border-bottom:solid 1px ##808080;}
.rb {border-right:solid 1px ##808080;}
.lb {border-left:solid 1px ##808080;}
.totalLabel {border-left:solid 1px ##808080; border-top:solid 1px ##808080; font-weight:bold;}
.total {border-top:solid 1px ##808080; font-weight:bold;}
fieldset {border:solid 1px ##a0a0a0;} 
.control {cursor:pointer;}
</style>

<center>
$SET_PARAMETERS scale=1000;

<table border=0 cellpadding=0 cellspacing=0 style="margin:20px; width:98%"><tr><td width=90%>
<h3>1C - Оперативные данные о ДС, 20#q_yr# год<br>
<small>(без производственных подразделений)</small></td>
<td align=right nowrap=true></td><td align=right nowrap=true>
<a class=info href="/adb/adb">Главная</a></td></tr></table>
<form name="theForm" method="POST" enctype="multipart/form-data">
<input type=hidden name="c" value="#c#">
<input type=hidden name="b" value=""> ??
<input type=hidden name="bg" value=""> ??
<input type=hidden name="p" value="">
<input type=hidden name="acc" value="">
<input type=hidden name="val" value=""> ??
<input type=hidden name="scale" value="#scale#">



<table border=0  bgcolor=##E8F0F8 style="border:solid 1px black;">

<tr><td nowrap=true colspan=2 valign=top>
<FIELDSET><LEGEND><b><i>Отобрать данные:</i></b></LEGEND>
<table border=0>

<tr><td class="a_right">Подразделение:</td><td><select name="f_div">
<option value="">все</option>
<option value="ОИЯИ">ОИЯИ</option>
<option value="DIV">Подразделения</option>
<option value="ЛНФ"> - ЛНФ</option>
<option value="ЛФВЭ"> - ЛФВЭ</option>
<option value="НЦеПИ"> - НЦеПИ</option>
<option value="ОКС"> - ОКС</option>
<option value="ЛЯР, НХП ЦПФ"> - ЛЯР, НХП ЦПФ</option>
</select></td></tr>

<tr><td class="a_right">Банк:</td><td><select name="f_bank">
<option value="">все</option>
<option value="МДМ"> МДМ</option>
<option value="Интерком"> Интеркомерц</option>
<option value="ВТБ"> ВТБ</option>
<option value="прочие"> прочие</option> ??
<option value="Депозиты"> Депозиты</option> ??
</select></td></tr>

<tr><td class="a_right">Валюта:</td><td><select name="f_curr">
<option value="">все</option>
<option value="rub"> - рубли</option>
<option value="val">валюта</option>
<option value="USD"> - USD</option>
<option value="EUR"> - EUR</option> 
</select></td></tr>

<tr><td colspan=2 style="padding-top:10px;">
Даты:
$INCLUDE common.dat[dat] param: fd_name=startdate; fd_val=#startdate#; yr1=-1; yr2=0; class=xp;
&nbsp;&nbsp;
$INCLUDE common.dat[dat] param: fd_name=enddate; fd_val=#enddate#; yr1=-1; yr2=0; class=xp;
&nbsp; &nbsp;

</td></tr></table>
</FIELDSET></td>

<td valign=top>
<FIELDSET><LEGEND><b><i>Сумма:</i></b></LEGEND>
<table border=1 bgcolor=##E8F0F8> ??

<input type=radio name=s_curr value='' onClick="doIt();"
checked ??!s_curr
>в валюте счета

<input type=radio name=s_curr value='rub' onClick="doIt();"
checked ??s_curr=rub
>в тыс.руб

<input type=radio name=s_curr value='usd' onClick="doIt();"
checked ??s_curr=usd
disabled
>в тыс.долларов<br>
<input type=checkbox name=showAcc onClick="doIt();"
checked ??showAcc
>
</fieldset>

<center><br><input type="submit" value="Выполнить"><br>&nbsp;</center>
</tr></table>

$INCLUDE [script]  
$CALL_SERVICE c=cp/b/cf_st_14; p=d; ??f_det=stat

$INCLUDE [bank table] ??!f_det
</form></center>

</body></HTML>
[end]


[bank table]
<table class="tlist" border=0 cellspacing=0 cellpadding=0 style="margin:20px;">
<tr>
<th>Банк, наименование счета</th>
<th>Валюта</th> ??s_curr=rub|showAcc
<th>Ед.изм.</th>
<th>Остаток на<br>#startdate#</th>
<th>Поступление</th>
<th>Расход</th> 
<th>Остаток на<br>#enddate#</th>
</tr>

$INCLUDE [JINR] ??!f_div|f_div=ОИЯИ
<tr><td class="div_head a_left" colspan=7>Счета подразделений:</th><tr> ??!f_div|f_div=DIV
$INCLUDE [LNF] ??!f_div|f_div=ЛНФ|f_div=DIV
$INCLUDE [LFVE] ??!f_div|f_div=ЛФВЭ|f_div=DIV
$INCLUDE [NCPI] ??!f_div|f_div=НЦеПИ|f_div=DIV
$INCLUDE [OKS] ??!f_div|f_div=ОКС|f_div=DIV
$INCLUDE [LAR] ??!f_div|f_div=ЛЯР, НХП ЦПФ|f_div=DIV

$CALL_SERVICE c=cp/b/ba_div; bg=; div=DIV; ??!f_div
$CALL_SERVICE c=cp/b/ba_div; bg=; div=#f_div#; ??f_div&!f_div=ОИЯИ

</TABLE>
<iframe width=900 height=0 name="wf" id="wf" scrolling="auto" frameborder="0" style="border:none 1px ##607080;"></iframe>  
[end]


[JINR]
<tr><td class="div_head a_left" colspan=7>ОИЯИ:</th><tr>
$CALL_SERVICE c=cp/b/ba_bank_div; bg=МДМ; div=ОИЯИ; ??!f_bank|f_bank=МДМ
$CALL_SERVICE c=cp/b/ba_bank_div; bg=Интеркоммерц, г.Дубна; div=ОИЯИ;   ??!f_bank|f_bank=Интерком
$CALL_SERVICE c=cp/b/ba_bank_div; bg=ВТБ, г.Москва; div=ОИЯИ;     ??!f_bank|f_bank=ВТБ
$CALL_SERVICE c=cp/b/ba_div; bg=; div=ОИЯИ; 

$CALL_SERVICE c=cp/b/ba_deposits; bg=; div=ОИЯИ; ??!f_curr|f_curr=rub
$CALL_SERVICE c=cp/b/ba_credits; bg=; div=ОИЯИ; ??!f_curr=EUR
[end]



[LNF]
<tr><td class="div_head a_left tb" colspan=7>ЛНФ:</th><tr>  ??!f_bank|f_bank=МДМ
$CALL_SERVICE c=cp/b/ba_bank_div; bg=МДМ; div=ЛНФ;  ??!f_bank|f_bank=МДМ
[end]

[LFVE]
<tr><td class="div_head a_left tb" colspan=7>ЛФВЭ:</th><tr>  ??!f_bank|f_bank=МДМ
$CALL_SERVICE c=cp/b/ba_bank_div; bg=МДМ; div=ЛФВЭ;  ??!f_bank|f_bank=МДМ

<tr><td class="div_head a_left tb" colspan=7>ЛФВЭ-2:</th><tr> ??!f_bank|f_bank=МДМ
$CALL_SERVICE c=cp/b/ba_bank_div; bg=МДМ; div=ЛФВЭ-2; n=1; ??!f_bank|f_bank=МДМ
$CALL_SERVICE c=cp/b/ba_bank_div; bg=МДМ; div=ЛФВЭ-2; n=2; ??!f_bank|f_bank=МДМ
$CALL_SERVICE c=cp/b/ba_bank_div; bg=МДМ; div=ЛФВЭ-2; n=3; ??!f_bank|f_bank=МДМ
$CALL_SERVICE c=cp/b/ba_bank_div; bg=МДМ; div=ЛФВЭ-2; ??!f_bank|f_bank=МДМ
[end]

[NCPI]
<tr><td class="div_head a_left tb" colspan=7>НЦеПИ:</th><tr> ??!f_bank|f_bank=МДМ
$CALL_SERVICE c=cp/b/ba_bank_div; bg=МДМ; div=НЦеПИ; ??!f_bank|f_bank=МДМ
[end]

[OKS]
<tr><td class="div_head a_left tb" colspan=7>ОКС:</th><tr>  ??!f_bank|f_bank=МДМ|f_bank=Интерком
$CALL_SERVICE c=cp/b/ba_bank_div; bg=МДМ; div=ОКС; n=1; ??!f_bank|f_bank=МДМ
$CALL_SERVICE c=cp/b/ba_bank_div; bg=МДМ; div=ОКС; n=2; ??!f_bank|f_bank=МДМ
$CALL_SERVICE c=cp/b/ba_bank_div; bg=Интерком; div=ОКС;   ??!f_bank|f_bank=Интерком
[end]

[LAR]
<tr><td class="div_head a_left tb" colspan=7>ЛЯР, НХП ЦПФ:</th><tr> ??!f_bank|f_bank=МДМ|f_bank=Интерком
$CALL_SERVICE c=cp/b/ba_bank_div; bg=МДМ; div=ЛЯР, НХП ЦПФ; n=1; ??!f_bank|f_bank=МДМ
$CALL_SERVICE c=cp/b/ba_bank_div; bg=МДМ; div=ЛЯР, НХП ЦПФ; n=2; ??!f_bank|f_bank=МДМ
$CALL_SERVICE c=cp/b/ba_bank_div; bg=Интерком, Дубна; div=ЛЯР, НХП ЦПФ; n=3;   ??!f_bank|f_bank=Интерком
$CALL_SERVICE c=cp/b/ba_bank_div; bg=Интерком, Москва; div=ЛЯР, НХП ЦПФ;   ??!f_bank|f_bank=Интерком
[end]


[script]
<script> 
var frm=document.theForm;
window.focus();
function doIt(){
	frm.submit();
}

selectOptionByVal(document.theForm.f_bank,"#f_bank#"); ??f_bank
selectOptionByVal(document.theForm.f_div,"#f_div#"); ??f_div
selectOptionByVal(document.theForm.f_curr,"#f_curr#"); ??f_curr

function getDet(acc,p) {
	frm.c.value="cp/b/ba_acc_det";
	frm.target="dd" + (new Date()).getTime();
	frm.acc.value=acc;
	frm.p.value=p;
	frm.submit();
	frm.c.value="#c#";
	frm.target="";
}

</script> 
[end]


function showAccs(bg) {
	frm.bg.value=bg;
	frm.c.value="cp/b/cfbb";
	frm.target="wf";
	frm.submit();
	$("##d_showdet_" + bg).hide();
	$("##d_hidedet_" + bg).show();
	alert(bg); ??
	frm.c.value="#c#";
	frm.target="";
}

function hideAccs(bg) {
$("tr.det_" + bg).remove();
	$("##d_hidedet_" + bg).hide();
	$("##d_showdet_" + bg).show();
}

function addRows(txt, grp)
{
 $('<tr><td>new td</td></tr>').insertAfter($("##b_МДМ_det").closest('tr')); ??
 window.parent. ??
 $(txt).insertBefore($("##b_" + grp + "_det").closest('tr')); 

}

function getResult(div_id, res)
{
	setElement(div_id,res.innerHTML);
}

var setElement = function(div_id, txt)
{ 
	document.getElementById(div_id).innerHTML=txt; ??
	$("##"+div_id).html(txt); 
}


function getStat(st){
	openWindow("c=cp/b/cf_det_#q_yr#&f_val=#f_val#&s_curr=#s_curr#&st=" + st + "&startdate=#startdate#&enddate=#enddate#&tpq=" + escape("#tpq#"), "st_det", 1100,800);
}






================================ SQLs ================================

[getDates]
select 1 as "A"
, to_char(max(dat)-2, 'DD.MM.YYYY') as "startdate" ??!startdate
, to_char(max(dat)-1, 'DD.MM.YYYY') as "enddate" ??!enddate
from prov2_#q_yr# p  
where 
p.acc like '51%' or p.acc like '52%' or p.acc like '55%' 
[end]

