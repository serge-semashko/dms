[parameters]
service=dubna.walt.service.RecordEditorU

=== «адаем ключевое поле дл€ разных таблиц: ??
=== например, дл€ таблицы "i_aggr" ключевое поле - CODE, дл€ "DOCS_PAYED" - DOC_ID ===  ??
=== (это мои таблицы) ??

keyFieldName=CODE    ??table=i_aggr
keyFieldName=DOC_ID  ??table=DOCS_PAYED

=== по умолчанию (дл€ других таблиц) ключевое поле ID:    === ??
keyFieldName=ID
[end]

=== ѕолучаем новое значение ключевого пол€ дл€ новой записи
 (почему-то у мен€ правильно работает даже дл€ текстовых полей, содержащих числа)
 "try:" в начале запроса разрешает продолжение выполнени€ в случае,
 если в этом запросе будет ошибка. —ообщение об ошибке помещаетс€ в параметр "getPreDataError"
 и выводитс€ в начале [report header]

[preSQLs]
try: select max(#keyFieldName#) + 1 as KEY_FIELD from #table# ??keyFieldName&cop=new
[end]


[get SQL]
=== SQL дл€ чтени€ и редактировани€ существующей записи === ??

select * from #table# where ROWID='#rowid#' ??rowid&!rowid=0

=== SQL дл€ заведени€ новой записи === ??
=== (нужен только дл€ определени€ имен, типов и размеров полей таблицы) ??

SELECT * from #table# where rownum=1 		??!rowid|rowid=0
[end]


[report header]
<HTML><HEAD><TITLE>Record editor</TITLE>
<META http-equiv=Content-Type content="text/html; charset=windows-1251">
<link rel="stylesheet" href="/bp.css" type="text/css">
</HEAD>

<body BACKGROUND="#imgPath#b_n.gif">

<form name="theForm" method="POST" enctype="multipart/form-data">
<input type=hidden name="c" value="#c#">
<input type=hidden name="table" value="#table#">
<input type=hidden name="rowid" value="#rowid#">
<input type=hidden name=cop value="">

<table bgcolor=FFFFC0 cellpadding=5><tr><td>#getPreDataError#</td></tr></table>  ??getPreDataError

<table border=1 bgcolor=whitesmoke cellspacing=0>
<tr><td colspan=2 align=center>
“аблица: <b>#table#</b>;
rowid: #rowid#; ??rowid&!rowid=0
<i><b>«анесение новой записи</b></i> ??rowid=0
следующее #keyFieldName#=#ID# ??
</td></tr>
<tr><td>

<table border=0 cellpadding=2>
[end]

=== Ўаблон дл€ вывода одного пол€ записи
[field]
<tr><td align=right valign=top>
<b>#field#:</b> 
<br><small><i>#type#</i>
</td><td>
<input name=#field# size=#size# value='#value#'> ??!long
<textarea name=#field# rows=#numRows# cols=60>#value#</textarea> ??long
</td></tr>
[end]


[report footer]
</td></tr></table>

<td valign=top align=center><br>

&nbsp;<input type=button value="—охранить" onClick="saveIt();">&nbsp;<br><br>
<input type=button value="  ”далить  " onClick="delIt();">&nbsp;<br><br> ??!cop=new
<input type=button value="  «акрыть  " onClick="window.close();">

</td></tr></table>
</form>

<script>
var frm=document.theForm;

setKeyField();	??keyFieldName&cop=new

function setKeyField()
{ 
  === ¬ставл€ем новое значение ключевого пол€ в форму === ??
  try 
  { frm.#keyFieldName#.value = "#KEY_FIELD#";
  } catch (e) {}
}

function delIt()
{ if (confirm("«апись будет удалена"))
  { frm.cop.value="D";
    frm.submit();
  }
}

function saveIt()
{ 
  frm.cop.value="U"; ??!cop=new
  frm.cop.value="I"; ??cop=new
  frm.submit();
}
window.focus();

function closeIt()
{ try 
  { window.opener.refrSelf(); 
  } catch (e) {}
  window.close();
}
closeIt(); ??cop&!cop=new
</script>
</body></html>
[end]

