receive_7_sotrudnik.cfg

[parameters]
request_name=S:Прием сотрудника
LOG=ON
[end]

 
[report]
$LOG <hr><b>receive_7_sotrudnik.cfg</b><br>object=#Object#;<br> 
$SET_PARAMETERS ERR_CODE=0; ERROR=; 
$SET_PARAMETERS ERROR=Отсутствует ТабельныйНомер; ??!ТабельныйНомер
$SET_PARAMETERS ERROR=Отсутствует КодФизическогоЛица; ??!КодФизическогоЛица
$SET_PARAMETERS ERROR=Отсутствует ФИО; ??!ФИО

$INCLUDE [setDefaults]
$GET_DATA [check existing record]   ??!ERROR
$INCLUDE [receive]  ??Command=PutObject&!ERROR
$SET_PARAMETERS REC_ID=#ТабельныйНомер#;
[end]

[setDefaults]
$SET_PARAMETERS table=gway.СотрудникиОрганизации;

[end]

[receive]
$GET_DATA [insert record]           ??!REC_EXISTS
$GET_DATA [update record]    
[end]

============================================================================
============================================================================
============================================================================

[check existing record]
select 'Y' as REC_EXISTS from #table#
where ТабельныйНомер='#ТабельныйНомер#'
[end]


[insert record]
insert into #table# (ТабельныйНомер, КодФизическогоЛица, ФИО)
values('#ТабельныйНомер#', '#КодФизическогоЛица#', '#ФИО#')
[end]
 

[update record]
select case when '#Оклад#' not like('%,%') then convert(int,stuff('#Оклад#',len('#Оклад#')-3,1,'')) else 0 end  as ОКЛАД_  ??Оклад
;
update #table# set 
 КодФизическогоЛица='#КодФизическогоЛица#', КодУсловийРаботы='#КодУсловийРаботы#', УсловияРаботы='#УсловияРаботы#'
, ДатаУсловияРаботы=CONVERT(DATETIME, '#ДатаУсловияРаботы#',104) ??ДатаУсловияРаботы
, ДатаУсловияРаботы=null ??!ДатаУсловияРаботы
, КодИсточникаКомплектования='#КодИсточникаКомплектования#', ИсточникКомплектования='#ИсточникКомплектования#', КОДДолжности='#КОДДолжности#', Должность='#Должность#'
, ДатаДолжности=CONVERT(DATETIME, '#ДатаДолжности#',104) ??ДатаДолжности
, ДатаДолжности=null ??!ДатаДолжности

, ТИП_ДЕЯТ ??
, ТипДеятельности='#ТипДеятельности#'  

, ОКЛАД=#ОКЛАД_# ??ОКЛАД_
, ДатаОклада = CONVERT(DATETIME,'#ДатаОклада#',104)  ??ДатаОклада
, ДатаОклада = null  ??!ДатаОклада

, Разряд='#Разряд#', КодУсловияТруда='#КодУсловияТруда#', УсловияТруда='#УсловияТруда#'
, ДатаУсловийТруда = CONVERT(DATETIME,'#ДатаУсловийТруда#',104) ??ДатаУсловийТруда
, ДатаУсловийТруда = null ??!ДатаУсловийТруда
, КодТарифнойСетки='#КодТарифнойСетки#', ТарифнаяСетка='#ТарифнаяСетка#'
, ПРОД_РД ??нет в данных
, ГрафикРаботы='#ГрафикРаботы#'
, ДатаГрафика=CONVERT(DATETIME,'#ДатаГрафика#',104) ??ДатаГрафика
, ДатаГрафика=null ??!ДатаГрафика

, КодПодразделения='#КодПодразделения#', Подразделение='#Подразделение#'
, ДатаПодразделения=CONVERT(DATETIME,'#ДатаПодразделения#',104) ??ДатаПодразделения
, ДатаПодразделения=null ??!ДатаПодразделения
, ДатаНачалаРаботы=CONVERT(DATETIME,'#ДатаНачалаРаботы#',104) ??ДатаНачалаРаботы
, ДатаНачалаРаботы=null ??!ДатаНачалаРаботы
, ДатаОкончанияРаботы=CONVERT(DATETIME,'#ДатаОкончанияРаботы#',104) ??ДатаОкончанияРаботы
, ДатаОкончанияРаботы=null ??!ДатаОкончанияРаботы
, Пол='#Пол#' 

, ДатаРождения=CONVERT(DATETIME,'#ДатаРождения#',104) ??ДатаРождения
, ДатаРождения=null ??!ДатаРождения

, КодГражданства='#КодГражданства#', Гражданство='#Гражданство#'
, ДатаУвольнения=CONVERT(DATETIME,'#ДатаУвольнения#',104) ??ДатаУвольнения
, ДатаУвольнения=null ??!ДатаУвольнения
, ПричинаУвольнения='#ПричинаУвольнения#'
, КодШтата='#КодШтата#', Штат='#Штат#'
, Страна='#Страна#', ПФР='#ПФР#', ИНН='#ИНН#'
, СрокПолномочий=CONVERT(DATETIME,'#СрокПолномочий#', 104) ??СрокПолномочий
, СрокПолномочий=null ??!СрокПолномочий

, DATE_UPD=GETDATE()

where ТабельныйНомер='#ТабельныйНомер#'
[end]
