receive_89_persondan.cfg

[parameters]
request_name=S:Прием Персональные данные
LOG=ON
[end]


[report]
$SET_PARAMETERS table=gway.ПерсональныеДанные; REC_EXISTS=;

$GET_DATA [check existing record]  
$GET_DATA [insert record]           ??!REC_EXISTS&!ERROR
$GET_DATA [update record]           ??!ERROR

[end]


============================================================================
============================================================================
============================================================================

[check existing record]
select 'Y' as REC_EXISTS from #table#
where Код='#Код#' 
[end]

 
[insert record]
insert into #table# (Код,id) values ('#Код#', '#SrcObjectID#')
[end]


[update record]
update #table# set КодСемейногоПоложения='#ПерсональныеДанные.1.СемейногоПоложенияКод#', СемейноеПоложение='#ПерсональныеДанные.1.СемейноеПоложениеНаименование#', Адрес='#ПерсональныеДанные.1.Адрес#'
, КоличествоДетей='#ПерсональныеДанные.1.КоличествоДетей#' 
, ПаспортСерия='#ПерсональныеДанные.1.ПаспортСерия#', ПаспортНомер='#ПерсональныеДанные.1.ПаспортНомер#'
, ДатаПаспорта=CONVERT(DATETIME,'#ПерсональныеДанные.1.ПаспортаДата#',104)??ПерсональныеДанные.1.ПаспортаДата
, ДатаПаспорта=null ??!ПерсональныеДанные.1.ПаспортаДата
, ПаспорКемВыдан='#ПерсональныеДанные.1.ПаспорКемВыдан#'
, КодТипаПенсии='#ПерсональныеДанные.1.ТипаПенсииКод#', ТипПенсии='#ПерсональныеДанные.1.ТипПенсииНаименование#', УчастникВойны='#ПерсональныеДанные.1.УчастникВойны#'
, ИмеетСудимость='#ПерсональныеДанные.1.ИмеетСудимость#', АдресПоПрописке='#ПерсональныеДанные.1.АдресПоПрописке#'
, ДатаРождения= CONVERT(DATETIME,'#ПерсональныеДанные.1.ДатаРождения#',104)??ПерсональныеДанные.1.ДатаРождения
,  ДатаРождения=null ??!ПерсональныеДанные.1.ДатаРождения
, Пол='#ПерсональныеДанные.1.Пол#'
, МестоРождения='#ПерсональныеДанные.1.МестоРождения#'
, ИНН='#ПерсональныеДанные.1.ИНН#'
, ПФР='#ПерсональныеДанные.1.СтраховойНомерПФР#'
, ГражданствоКод='#ПерсональныеДанные.1.ГражданствоКод#'
, Гражданство='#ПерсональныеДанные.1.ГражданствоНаименование#'
, id= '#SrcObjectID#'
, DATE_UPD=GETDATE()
where Код='#Код#'

[end]


insert into #table# (Код, КодСемейногоПоложения, СемейноеПоложение, Адрес
, КоличествоДетей, ПаспортСерия, ПаспортНомер, ДатаПаспорта, ПаспорКемВыдан
, КодТипаПенсии, ТипПенсии, УчастникВойны, ИмеетСудимость, АдресПоПрописке, ДатаРождения, Пол, МестоРождения, 
ИНН, ПФР, ГражданствоКод, Гражданство, id, DATE_UPD)

values('#Код#', '#ПерсональныеДанные.1.СемейногоПоложенияКод#', '#ПерсональныеДанные.1.СемейноеПоложениеНаименование#', '#ПерсональныеДанные.1.Адрес#'
, '#ПерсональныеДанные.1.КоличествоДетей#', '#ПерсональныеДанные.1.ПаспортСерия#', '#ПерсональныеДанные.1.ПаспортНомер#'
,CONVERT(DATETIME,'#ПерсональныеДанные.1.ПаспортаДата#',104)??ПерсональныеДанные.1.ПаспортаДата
, null ??!ПерсональныеДанные.1.ПаспортаДата
, '#ПерсональныеДанные.1.ПаспорКемВыдан#'
, '#ПерсональныеДанные.1.ТипаПенсииКод#', '#ПерсональныеДанные.1.ТипПенсииНаименование#', '#ПерсональныеДанные.1.УчастникВойны#'
, '#ПерсональныеДанные.1.ИмеетСудимость#', '#ПерсональныеДанные.1.АдресПоПрописке#'
,  CONVERT(DATETIME,'#ПерсональныеДанные.1.ДатаРождения#',104)??ПерсональныеДанные.1.ДатаРождения
,  null ??!ПерсональныеДанные.1.ДатаРождения
, '#ПерсональныеДанные.1.Пол#'
, '#ПерсональныеДанные.1.МестоРождения#'
, '#ПерсональныеДанные.1.ИНН#'
, '#ПерсональныеДанные.1.СтраховойНомерПФР#'
, '#ПерсональныеДанные.1.ГражданствоКод#'
, '#ПерсональныеДанные.1.Гражданство#'
,  '#SrcObjectID#'
, GETDATE())

[end]
 
