receive_93_dateprik;.cfg

[parameters]
request_name=S:Даты Кадровых Изменений
LOG=ON
[end]


[report]
$SET_PARAMETERS table=gway.ДатыКадровыхИзменений;

$GET_DATA receive.cfg[delete existing records]   ??!ERROR

$EXECUTE_LOOP item; #РаботникиОрганизации.items#; [receive kadrdoc];    ??!ERROR
[end]


[receive kadrdoc]
$SET_PARAMETERS p1=РаботникиОрганизации.#item#.Сотрудник; p2=РаботникиОрганизации.#item#.Сотрудник_Ref; p3=РаботникиОрганизации.#item#.ДатаНачала;p4=РаботникиОрганизации.#item#.ДатаПриема;
$SET_PARAMETERS Сотрудник=^#p1#; Сотрудник_Ref=^#p2#; ДатаНачала=^#p3#; ДатаПриема=^#p4#;

$SET_PARAMETERS  p1=РаботникиОрганизации.#item#.ПодразделениеОрганизации; p2=РаботникиОрганизации.#item#.ПодразделениеОрганизации_Ref;  p3=РаботникиОрганизации.#item#.Сторно;
$SET_PARAMETERS  ПодразделениеОрганизации=^#p1#; ПодразделениеОрганизации_Ref=^#p2#; Сторно=^#p3#;

$SET_PARAMETERS  p1=РаботникиОрганизации.#item#.Должность; p2=РаботникиОрганизации.#item#.Должность_Ref
$SET_PARAMETERS  Должность=^#p1#; Должность_Ref=^#p2#;

$SET_PARAMETERS p1=РаботникиОрганизации.#item#.ЗанимаемыхСтавок; p2=РаботникиОрганизации.#item#.ГрафикРаботы; p3=РаботникиОрганизации.#item#.ГрафикРаботы_Ref;
$SET_PARAMETERS ЗанимаемыхСтавок=^#p1#; ГрафикРаботы=^#p2#; ГрафикРаботы_Ref=^#p3#;


$GET_DATA [insert record]   ??Command=PutObject&!ERROR
[end]


 
[insert record]
insert into #table# (Сотрудник, Сотрудник_ИД, Дата, Подразделение, Подразделение_ИД, Должность, Должность_ИД, 
                     ГрафикРаботы, ГрафикРаботы_ИД, ЗанимаемыхСтавок, Сторно, id, DATE_UPD)
values('#Сотрудник#', '#Сотрудник_Ref#'
, CONVERT(DATETIME,'#ДатаНачала#',104)  ??ДатаНачала
, CONVERT(DATETIME,'#ДатаПриема#',104)  ??ДатаПриема
, null ??!ДатаНачала&??!ДатаПриема
, '#ПодразделениеОрганизации#', '#ПодразделениеОрганизации_Ref#', '#Должность#', '#Должность_Ref#'
, '#ГрафикРаботы#' , '#ГрафикРаботы_Ref#' , '#ЗанимаемыхСтавок#',  '#Сторно#'
, '#SrcObjectID#'
, GETDATE())
[end]
 
