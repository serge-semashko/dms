receive_44_persondan.cfg

[parameters]
request_name=S:Прием Персональные данные
LOG=ON
[end]


[report]
$LOG <hr><b>receive_44_persondan.cfg</b><br>object=#Object#;<br> 
$SET_PARAMETERS ERR_CODE=0; ERROR=; 

$SET_PARAMETERS ERROR=Отсутствует Код; ??!КодСотрудника


$INCLUDE [setDefaults]
$GET_DATA [check existing record]   ??!ERROR
$INCLUDE [receive]  ??Command=PutObject&!ERROR

$SET_PARAMETERS REC_ID=#Код#; 
[end]

[setDefaults]
$SET_PARAMETERS table=gway.ПерсональныеДанные;

[end]

[receive]
$GET_DATA [insert record]           ??!REC_EXISTS
$GET_DATA [update record]           ??REC_EXISTS
[end]

============================================================================
============================================================================
============================================================================

[check existing record]
select 'Y' as REC_EXISTS from #table#
where Код='#КодСотрудника#' 
[end]

 
[insert record]
insert into #table# (Код, КодСемейногоПоложения, СемейноеПоложение, Адрес
, КоличествоДетей, ПаспортСерия, ПаспортНомер, ДатаПаспорта, ПаспорКемВыдан
, КодТипаПенсии, ТипПенсии, УчастникВойны, ИмеетСудимость, АдресПоПрописке)
              values('#КодСотрудника#', '#КодСемейногоПоложения#', '#СемейноеПоложение#', '#Адрес#'
, '#КоличествоДетей#', '#ПаспортСерия#', '#ПаспортНомер#'
,CONVERT(DATETIME,'#ДатаПаспорта#',104), '#ПаспорКемВыдан#'
, '#КодТипаПенсии#', '#ТипПенсии#', '#УчастникВойны#', '#ИмеетСудимость#', '#АдресПоПрописке#')


[end]
 


[update record]
update #table# set КодСемейногоПоложения='#КодСемейногоПоложения#', СемейноеПоложение='#СемейноеПоложение#', Адрес='#Адрес#'
, КоличествоДетей='#КоличествоДетей#' 
, ПаспортСерия='#ПаспортСерия#', ПаспортНомер='#ПаспортНомер#'
, ДатаПаспорта=CONVERT(DATETIME,'#ДатаПаспорта#',104)??ДатаПаспорта
, ДатаПаспорта=null ??!ДатаПаспорта
, ПаспорКемВыдан='#ПаспорКемВыдан#'
, КодТипаПенсии='#КодТипаПенсии#', ТипПенсии='#ТипПенсии#', УчастникВойны='#УчастникВойны#'
, ИмеетСудимость='#ИмеетСудимость#', АдресПоПрописке='#АдресПоПрописке#'
, DATE_UPD=GETDATE()
where Код='#КодСотрудника#'


[end]

